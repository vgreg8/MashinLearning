<!DOCTYPE html>

<html class="no-js" lang="ru-RU">

	<head>

		<meta http-equiv="content-type" content="text/html" charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" >

		<link rel="profile" href="http://gmpg.org/xfn/11">

		<meta name='robots' content='index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1' />
	<style>img:is([sizes="auto" i], [sizes^="auto," i]) { contain-intrinsic-size: 3000px 1500px }</style>
	
<script>
MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};

</script>

	<!-- This site is optimized with the Yoast SEO plugin v24.4 - https://yoast.com/wordpress/plugins/seo/ -->
	<title>Стохастический градиентный спуск. Часть 2 | Обучение модели</title>
	<meta name="description" content="Во второй части мы рассмотрим влияние размера шага на сходимость SGD, а также изучим метод наискорейшего спуска." />
	<link rel="canonical" href="index.html" />
	<meta property="og:locale" content="ru_RU" />
	<meta property="og:type" content="article" />
	<meta property="og:title" content="Стохастический градиентный спуск. Часть 2 | Обучение модели" />
	<meta property="og:description" content="Во второй части мы рассмотрим влияние размера шага на сходимость SGD, а также изучим метод наискорейшего спуска." />
	<meta property="og:url" content="https://www.dmitrymakarov.ru/learning/sgd-02/" />
	<meta property="og:site_name" content="Машинное обучение" />
	<meta property="article:modified_time" content="2025-02-02T14:15:31+00:00" />
	<meta property="og:image" content="https://www.dmitrymakarov.ru/wp-content/uploads/2024/10/sgd_quad_loss.png" />
	<meta property="og:image:width" content="575" />
	<meta property="og:image:height" content="456" />
	<meta property="og:image:type" content="image/png" />
	<meta name="twitter:card" content="summary_large_image" />
	<meta name="twitter:label1" content="Примерное время для чтения" />
	<meta name="twitter:data1" content="12 минут" />
	<script type="application/ld+json" class="yoast-schema-graph">{"@context":"https://schema.org","@graph":[{"@type":"WebPage","@id":"https://www.dmitrymakarov.ru/learning/sgd-02/","url":"https://www.dmitrymakarov.ru/learning/sgd-02/","name":"Стохастический градиентный спуск. Часть 2 | Обучение модели","isPartOf":{"@id":"https://www.dmitrymakarov.ru/#website"},"primaryImageOfPage":{"@id":"https://www.dmitrymakarov.ru/learning/sgd-02/#primaryimage"},"image":{"@id":"https://www.dmitrymakarov.ru/learning/sgd-02/#primaryimage"},"thumbnailUrl":"https://www.dmitrymakarov.ru/wp-content/uploads/2024/10/sgd_quad_loss.png","datePublished":"2024-10-09T07:06:44+00:00","dateModified":"2025-02-02T14:15:31+00:00","description":"Во второй части мы рассмотрим влияние размера шага на сходимость SGD, а также изучим метод наискорейшего спуска.","breadcrumb":{"@id":"https://www.dmitrymakarov.ru/learning/sgd-02/#breadcrumb"},"inLanguage":"ru-RU","potentialAction":[{"@type":"ReadAction","target":["https://www.dmitrymakarov.ru/learning/sgd-02/"]}]},{"@type":"ImageObject","inLanguage":"ru-RU","@id":"https://www.dmitrymakarov.ru/learning/sgd-02/#primaryimage","url":"https://www.dmitrymakarov.ru/wp-content/uploads/2024/10/sgd_quad_loss.png","contentUrl":"https://www.dmitrymakarov.ru/wp-content/uploads/2024/10/sgd_quad_loss.png","width":575,"height":456},{"@type":"BreadcrumbList","@id":"https://www.dmitrymakarov.ru/learning/sgd-02/#breadcrumb","itemListElement":[{"@type":"ListItem","position":1,"name":"Главная страница","item":"https://www.dmitrymakarov.ru/"},{"@type":"ListItem","position":2,"name":"Обучение модели","item":"https://www.dmitrymakarov.ru/learning/"},{"@type":"ListItem","position":3,"name":"Стохастический градиентный спуск. Часть 2"}]},{"@type":"WebSite","@id":"https://www.dmitrymakarov.ru/#website","url":"https://www.dmitrymakarov.ru/","name":"Машинное обучение","description":"","publisher":{"@id":"https://www.dmitrymakarov.ru/#/schema/person/3fc221e2d391cc5cfd9d31c9c251c2a4"},"potentialAction":[{"@type":"SearchAction","target":{"@type":"EntryPoint","urlTemplate":"https://www.dmitrymakarov.ru/?s={search_term_string}"},"query-input":{"@type":"PropertyValueSpecification","valueRequired":true,"valueName":"search_term_string"}}],"inLanguage":"ru-RU"},{"@type":["Person","Organization"],"@id":"https://www.dmitrymakarov.ru/#/schema/person/3fc221e2d391cc5cfd9d31c9c251c2a4","name":"DmitryMakarov","image":{"@type":"ImageObject","inLanguage":"ru-RU","@id":"https://www.dmitrymakarov.ru/#/schema/person/image/","url":"https://secure.gravatar.com/avatar/2c5f922d990c667feffc00f99517cc0e?s=96&d=mm&r=g","contentUrl":"https://secure.gravatar.com/avatar/2c5f922d990c667feffc00f99517cc0e?s=96&d=mm&r=g","caption":"DmitryMakarov"},"logo":{"@id":"https://www.dmitrymakarov.ru/#/schema/person/image/"}}]}</script>
	<!-- / Yoast SEO plugin. -->


<link rel='dns-prefetch' href='https://cdn.jsdelivr.net/' />
<link rel="alternate" type="application/rss+xml" title="Машинное обучение &raquo; Лента" href="../../feed/index.html" />
<link rel="alternate" type="application/rss+xml" title="Машинное обучение &raquo; Лента комментариев" href="../../comments/feed/index.html" />
<script type="text/javascript">
/* <![CDATA[ */
window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/15.0.3\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/15.0.3\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/www.dmitrymakarov.ru\/wp-includes\/js\/wp-emoji-release.min.js?ver=6.7.1"}};
/*! This file is auto-generated */
!function(i,n){var o,s,e;function c(e){try{var t={supportTests:e,timestamp:(new Date).valueOf()};sessionStorage.setItem(o,JSON.stringify(t))}catch(e){}}function p(e,t,n){e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillText(t,0,0);var t=new Uint32Array(e.getImageData(0,0,e.canvas.width,e.canvas.height).data),r=(e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillText(n,0,0),new Uint32Array(e.getImageData(0,0,e.canvas.width,e.canvas.height).data));return t.every(function(e,t){return e===r[t]})}function u(e,t,n){switch(t){case"flag":return n(e,"\ud83c\udff3\ufe0f\u200d\u26a7\ufe0f","\ud83c\udff3\ufe0f\u200b\u26a7\ufe0f")?!1:!n(e,"\ud83c\uddfa\ud83c\uddf3","\ud83c\uddfa\u200b\ud83c\uddf3")&&!n(e,"\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc65\udb40\udc6e\udb40\udc67\udb40\udc7f","\ud83c\udff4\u200b\udb40\udc67\u200b\udb40\udc62\u200b\udb40\udc65\u200b\udb40\udc6e\u200b\udb40\udc67\u200b\udb40\udc7f");case"emoji":return!n(e,"\ud83d\udc26\u200d\u2b1b","\ud83d\udc26\u200b\u2b1b")}return!1}function f(e,t,n){var r="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope?new OffscreenCanvas(300,150):i.createElement("canvas"),a=r.getContext("2d",{willReadFrequently:!0}),o=(a.textBaseline="top",a.font="600 32px Arial",{});return e.forEach(function(e){o[e]=t(a,e,n)}),o}function t(e){var t=i.createElement("script");t.src=e,t.defer=!0,i.head.appendChild(t)}"undefined"!=typeof Promise&&(o="wpEmojiSettingsSupports",s=["flag","emoji"],n.supports={everything:!0,everythingExceptFlag:!0},e=new Promise(function(e){i.addEventListener("DOMContentLoaded",e,{once:!0})}),new Promise(function(t){var n=function(){try{var e=JSON.parse(sessionStorage.getItem(o));if("object"==typeof e&&"number"==typeof e.timestamp&&(new Date).valueOf()<e.timestamp+604800&&"object"==typeof e.supportTests)return e.supportTests}catch(e){}return null}();if(!n){if("undefined"!=typeof Worker&&"undefined"!=typeof OffscreenCanvas&&"undefined"!=typeof URL&&URL.createObjectURL&&"undefined"!=typeof Blob)try{var e="postMessage("+f.toString()+"("+[JSON.stringify(s),u.toString(),p.toString()].join(",")+"));",r=new Blob([e],{type:"text/javascript"}),a=new Worker(URL.createObjectURL(r),{name:"wpTestEmojiSupports"});return void(a.onmessage=function(e){c(n=e.data),a.terminate(),t(n)})}catch(e){}c(n=f(s,u,p))}t(n)}).then(function(e){for(var t in e)n.supports[t]=e[t],n.supports.everything=n.supports.everything&&n.supports[t],"flag"!==t&&(n.supports.everythingExceptFlag=n.supports.everythingExceptFlag&&n.supports[t]);n.supports.everythingExceptFlag=n.supports.everythingExceptFlag&&!n.supports.flag,n.DOMReady=!1,n.readyCallback=function(){n.DOMReady=!0}}).then(function(){return e}).then(function(){var e;n.supports.everything||(n.readyCallback(),(e=n.source||{}).concatemoji?t(e.concatemoji):e.wpemoji&&e.twemoji&&(t(e.twemoji),t(e.wpemoji)))}))}((window,document),window._wpemojiSettings);
/* ]]> */
</script>
<link rel='stylesheet' id='urvanov_syntax_highlighter-css' href='../../wp-content/plugins/urvanov-syntax-highlighter/css/min/urvanov_syntax_highlighter.min.css@ver=2.8.38.css' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-theme-familiar-my-copy-css' href='../../wp-content/uploads/urvanov-syntax-highlighter/themes/familiar-my-copy/familiar-my-copy.css@ver=2.8.38.css' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-font-consolas-css' href='../../wp-content/plugins/urvanov-syntax-highlighter/fonts/consolas.css@ver=2.8.38.css' type='text/css' media='all' />
<style id='wp-emoji-styles-inline-css' type='text/css'>

	img.wp-smiley, img.emoji {
		display: inline !important;
		border: none !important;
		box-shadow: none !important;
		height: 1em !important;
		width: 1em !important;
		margin: 0 0.07em !important;
		vertical-align: -0.1em !important;
		background: none !important;
		padding: 0 !important;
	}
</style>
<link rel='stylesheet' id='wp-block-library-css' href='../../wp-includes/css/dist/block-library/style.min.css@ver=6.7.1.css' type='text/css' media='all' />
<style id='filebird-block-filebird-gallery-style-inline-css' type='text/css'>
ul.filebird-block-filebird-gallery{margin:auto!important;padding:0!important;width:100%}ul.filebird-block-filebird-gallery.layout-grid{display:grid;grid-gap:20px;align-items:stretch;grid-template-columns:repeat(var(--columns),1fr);justify-items:stretch}ul.filebird-block-filebird-gallery.layout-grid li img{border:1px solid #ccc;box-shadow:2px 2px 6px 0 rgba(0,0,0,.3);height:100%;max-width:100%;-o-object-fit:cover;object-fit:cover;width:100%}ul.filebird-block-filebird-gallery.layout-masonry{-moz-column-count:var(--columns);-moz-column-gap:var(--space);column-gap:var(--space);-moz-column-width:var(--min-width);columns:var(--min-width) var(--columns);display:block;overflow:auto}ul.filebird-block-filebird-gallery.layout-masonry li{margin-bottom:var(--space)}ul.filebird-block-filebird-gallery li{list-style:none}ul.filebird-block-filebird-gallery li figure{height:100%;margin:0;padding:0;position:relative;width:100%}ul.filebird-block-filebird-gallery li figure figcaption{background:linear-gradient(0deg,rgba(0,0,0,.7),rgba(0,0,0,.3) 70%,transparent);bottom:0;box-sizing:border-box;color:#fff;font-size:.8em;margin:0;max-height:100%;overflow:auto;padding:3em .77em .7em;position:absolute;text-align:center;width:100%;z-index:2}ul.filebird-block-filebird-gallery li figure figcaption a{color:inherit}

</style>
<style id='classic-theme-styles-inline-css' type='text/css'>
/*! This file is auto-generated */
.wp-block-button__link{color:#fff;background-color:#32373c;border-radius:9999px;box-shadow:none;text-decoration:none;padding:calc(.667em + 2px) calc(1.333em + 2px);font-size:1.125em}.wp-block-file__button{background:#32373c;color:#fff;text-decoration:none}
</style>
<style id='global-styles-inline-css' type='text/css'>
:root{--wp--preset--aspect-ratio--square: 1;--wp--preset--aspect-ratio--4-3: 4/3;--wp--preset--aspect-ratio--3-4: 3/4;--wp--preset--aspect-ratio--3-2: 3/2;--wp--preset--aspect-ratio--2-3: 2/3;--wp--preset--aspect-ratio--16-9: 16/9;--wp--preset--aspect-ratio--9-16: 9/16;--wp--preset--color--black: #121212;--wp--preset--color--cyan-bluish-gray: #abb8c3;--wp--preset--color--white: #fff;--wp--preset--color--pale-pink: #f78da7;--wp--preset--color--vivid-red: #cf2e2e;--wp--preset--color--luminous-vivid-orange: #ff6900;--wp--preset--color--luminous-vivid-amber: #fcb900;--wp--preset--color--light-green-cyan: #7bdcb5;--wp--preset--color--vivid-green-cyan: #00d084;--wp--preset--color--pale-cyan-blue: #8ed1fc;--wp--preset--color--vivid-cyan-blue: #0693e3;--wp--preset--color--vivid-purple: #9b51e0;--wp--preset--color--dark-gray: #333;--wp--preset--color--medium-gray: #555;--wp--preset--color--light-gray: #777;--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple: linear-gradient(135deg,rgba(6,147,227,1) 0%,rgb(155,81,224) 100%);--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan: linear-gradient(135deg,rgb(122,220,180) 0%,rgb(0,208,130) 100%);--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange: linear-gradient(135deg,rgba(252,185,0,1) 0%,rgba(255,105,0,1) 100%);--wp--preset--gradient--luminous-vivid-orange-to-vivid-red: linear-gradient(135deg,rgba(255,105,0,1) 0%,rgb(207,46,46) 100%);--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray: linear-gradient(135deg,rgb(238,238,238) 0%,rgb(169,184,195) 100%);--wp--preset--gradient--cool-to-warm-spectrum: linear-gradient(135deg,rgb(74,234,220) 0%,rgb(151,120,209) 20%,rgb(207,42,186) 40%,rgb(238,44,130) 60%,rgb(251,105,98) 80%,rgb(254,248,76) 100%);--wp--preset--gradient--blush-light-purple: linear-gradient(135deg,rgb(255,206,236) 0%,rgb(152,150,240) 100%);--wp--preset--gradient--blush-bordeaux: linear-gradient(135deg,rgb(254,205,165) 0%,rgb(254,45,45) 50%,rgb(107,0,62) 100%);--wp--preset--gradient--luminous-dusk: linear-gradient(135deg,rgb(255,203,112) 0%,rgb(199,81,192) 50%,rgb(65,88,208) 100%);--wp--preset--gradient--pale-ocean: linear-gradient(135deg,rgb(255,245,203) 0%,rgb(182,227,212) 50%,rgb(51,167,181) 100%);--wp--preset--gradient--electric-grass: linear-gradient(135deg,rgb(202,248,128) 0%,rgb(113,206,126) 100%);--wp--preset--gradient--midnight: linear-gradient(135deg,rgb(2,3,129) 0%,rgb(40,116,252) 100%);--wp--preset--font-size--small: 16px;--wp--preset--font-size--medium: 20px;--wp--preset--font-size--large: 24px;--wp--preset--font-size--x-large: 42px;--wp--preset--font-size--normal: 18px;--wp--preset--font-size--larger: 28px;--wp--preset--spacing--20: 0.44rem;--wp--preset--spacing--30: 0.67rem;--wp--preset--spacing--40: 1rem;--wp--preset--spacing--50: 1.5rem;--wp--preset--spacing--60: 2.25rem;--wp--preset--spacing--70: 3.38rem;--wp--preset--spacing--80: 5.06rem;--wp--preset--shadow--natural: 6px 6px 9px rgba(0, 0, 0, 0.2);--wp--preset--shadow--deep: 12px 12px 50px rgba(0, 0, 0, 0.4);--wp--preset--shadow--sharp: 6px 6px 0px rgba(0, 0, 0, 0.2);--wp--preset--shadow--outlined: 6px 6px 0px -3px rgba(255, 255, 255, 1), 6px 6px rgba(0, 0, 0, 1);--wp--preset--shadow--crisp: 6px 6px 0px rgba(0, 0, 0, 1);}:where(.is-layout-flex){gap: 0.5em;}:where(.is-layout-grid){gap: 0.5em;}body .is-layout-flex{display: flex;}.is-layout-flex{flex-wrap: wrap;align-items: center;}.is-layout-flex > :is(*, div){margin: 0;}body .is-layout-grid{display: grid;}.is-layout-grid > :is(*, div){margin: 0;}:where(.wp-block-columns.is-layout-flex){gap: 2em;}:where(.wp-block-columns.is-layout-grid){gap: 2em;}:where(.wp-block-post-template.is-layout-flex){gap: 1.25em;}:where(.wp-block-post-template.is-layout-grid){gap: 1.25em;}.has-black-color{color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-color{color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-color{color: var(--wp--preset--color--white) !important;}.has-pale-pink-color{color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-color{color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-color{color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-color{color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-color{color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-color{color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-color{color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-color{color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-color{color: var(--wp--preset--color--vivid-purple) !important;}.has-black-background-color{background-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-background-color{background-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-background-color{background-color: var(--wp--preset--color--white) !important;}.has-pale-pink-background-color{background-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-background-color{background-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-background-color{background-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-background-color{background-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-background-color{background-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-background-color{background-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-background-color{background-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-background-color{background-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-background-color{background-color: var(--wp--preset--color--vivid-purple) !important;}.has-black-border-color{border-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-border-color{border-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-border-color{border-color: var(--wp--preset--color--white) !important;}.has-pale-pink-border-color{border-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-border-color{border-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-border-color{border-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-border-color{border-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-border-color{border-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-border-color{border-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-border-color{border-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-border-color{border-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-border-color{border-color: var(--wp--preset--color--vivid-purple) !important;}.has-vivid-cyan-blue-to-vivid-purple-gradient-background{background: var(--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple) !important;}.has-light-green-cyan-to-vivid-green-cyan-gradient-background{background: var(--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan) !important;}.has-luminous-vivid-amber-to-luminous-vivid-orange-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange) !important;}.has-luminous-vivid-orange-to-vivid-red-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-orange-to-vivid-red) !important;}.has-very-light-gray-to-cyan-bluish-gray-gradient-background{background: var(--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray) !important;}.has-cool-to-warm-spectrum-gradient-background{background: var(--wp--preset--gradient--cool-to-warm-spectrum) !important;}.has-blush-light-purple-gradient-background{background: var(--wp--preset--gradient--blush-light-purple) !important;}.has-blush-bordeaux-gradient-background{background: var(--wp--preset--gradient--blush-bordeaux) !important;}.has-luminous-dusk-gradient-background{background: var(--wp--preset--gradient--luminous-dusk) !important;}.has-pale-ocean-gradient-background{background: var(--wp--preset--gradient--pale-ocean) !important;}.has-electric-grass-gradient-background{background: var(--wp--preset--gradient--electric-grass) !important;}.has-midnight-gradient-background{background: var(--wp--preset--gradient--midnight) !important;}.has-small-font-size{font-size: var(--wp--preset--font-size--small) !important;}.has-medium-font-size{font-size: var(--wp--preset--font-size--medium) !important;}.has-large-font-size{font-size: var(--wp--preset--font-size--large) !important;}.has-x-large-font-size{font-size: var(--wp--preset--font-size--x-large) !important;}
:where(.wp-block-post-template.is-layout-flex){gap: 1.25em;}:where(.wp-block-post-template.is-layout-grid){gap: 1.25em;}
:where(.wp-block-columns.is-layout-flex){gap: 2em;}:where(.wp-block-columns.is-layout-grid){gap: 2em;}
:root :where(.wp-block-pullquote){font-size: 1.5em;line-height: 1.6;}
</style>
<link rel='stylesheet' id='mcluhan-fonts-css' href='../../wp-content/themes/mcluhan/assets/css/fonts.css@ver=6.7.1.css' type='text/css' media='all' />
<link rel='stylesheet' id='fontawesome-css' href='../../wp-content/themes/mcluhan/assets/css/font-awesome.css@ver=6.7.1.css' type='text/css' media='all' />
<link rel='stylesheet' id='mcluhan-style-css' href='../../wp-content/themes/mcluhan/style.css@ver=2.1.1.css' type='text/css' media='all' />
<script type="text/javascript" src="../../wp-includes/js/jquery/jquery.min.js@ver=3.7.1" id="jquery-core-js"></script>
<script type="text/javascript" src="../../wp-includes/js/jquery/jquery-migrate.min.js@ver=3.4.1" id="jquery-migrate-js"></script>
<script type="text/javascript" id="urvanov_syntax_highlighter_js-js-extra">
/* <![CDATA[ */
var UrvanovSyntaxHighlighterSyntaxSettings = {"version":"2.8.38","is_admin":"0","ajaxurl":"https:\/\/www.dmitrymakarov.ru\/wp-admin\/admin-ajax.php","prefix":"urvanov-syntax-highlighter-","setting":"urvanov-syntax-highlighter-setting","selected":"urvanov-syntax-highlighter-setting-selected","changed":"urvanov-syntax-highlighter-setting-changed","special":"urvanov-syntax-highlighter-setting-special","orig_value":"data-orig-value","debug":""};
var UrvanovSyntaxHighlighterSyntaxStrings = {"copy":"Copied to the clipboard","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script type="text/javascript" src="../../wp-content/plugins/urvanov-syntax-highlighter/js/min/urvanov_syntax_highlighter.min.js@ver=2.8.38" id="urvanov_syntax_highlighter_js-js"></script>

			<!-- Customizer CSS -->

			<style type="text/css">

				body .site-header { background-color:#004235; }.social-menu.desktop { background-color:#004235; }.social-menu a:hover { color:#004235; }.social-menu a.active { color:#004235; }.mobile-menu-wrapper { background-color:#004235; }.social-menu.mobile { background-color:#004235; }.mobile-search.active { background-color:#004235; }
			</style>

			<!-- /Customizer CSS -->

					<script>jQuery( 'html' ).removeClass( 'no-js' ).addClass( 'js' );</script>
		<style type="text/css">.broken_link, a.broken_link {
	text-decoration: line-through;
}</style><style type="text/css" id="custom-background-css">
body.custom-background { background-color: #fff9ef; }
</style>
	<link rel="icon" href="../../wp-content/uploads/2021/08/cropped-wp-favicon-512-32x32.png" sizes="32x32" />
<link rel="icon" href="../../wp-content/uploads/2021/08/cropped-wp-favicon-512-192x192.png" sizes="192x192" />
<link rel="apple-touch-icon" href="../../wp-content/uploads/2021/08/cropped-wp-favicon-512-180x180.png" />
<meta name="msapplication-TileImage" content="https://www.dmitrymakarov.ru/wp-content/uploads/2021/08/cropped-wp-favicon-512-270x270.png" />

	</head>

	<body class="page-template page-template-full-width-page-template page-template-full-width-page-template-php page page-id-31705 page-child parent-pageid-5658 custom-background full-width-template">

		
		<a class="skip-link button" href="index.html#site-content">Перейти к содержимому</a>

		<header class="site-header group">

			
			<p class="site-title"><a href="../../index.html" class="site-name">Машинное обучение</a></p>

			
			<div class="nav-toggle">
				<div class="bar"></div>
				<div class="bar"></div>
			</div>

			<div class="menu-wrapper">

				<ul class="main-menu desktop">

									</ul>

			</div><!-- .menu-wrapper -->

			
				<div class="social-menu desktop">

					<ul class="social-menu-inner">

						<li class="social-search-wrapper"><a href="../../index.html@s=.html"></a></li>

						
					</ul><!-- .social-menu-inner -->

				</div><!-- .social-menu -->

			
		</header><!-- header -->

		<div class="mobile-menu-wrapper">

			<ul class="main-menu mobile">
									<li class="toggle-mobile-search-wrapper"><a href="index.html#" class="toggle-mobile-search">Поиск</a></li>
							</ul><!-- .main-menu.mobile -->

			
		</div><!-- .mobile-menu-wrapper -->

		
			<div class="mobile-search">

				<div class="untoggle-mobile-search"></div>

				
<form role="search" method="get" class="search-form" action="../../index.html">
	<label class="screen-reader-text" for="search-form-67aa621e84974">Поиск:</label>
	<input type="search" id="search-form-67aa621e84974" class="search-field" placeholder="Введите запрос" value="" name="s" autocomplete="off" />
	</button>
</form>

				<div class="mobile-results">

					<div class="results-wrapper"></div>

				</div>

			</div><!-- .mobile-search -->

			<div class="search-overlay">

				
<form role="search" method="get" class="search-form" action="../../index.html">
	<label class="screen-reader-text" for="search-form-67aa621e849f4">Поиск:</label>
	<input type="search" id="search-form-67aa621e849f4" class="search-field" placeholder="Введите запрос" value="" name="s" autocomplete="off" />
	</button>
</form>

			</div><!-- .search-overlay -->

		
		<main class="site-content" id="site-content">
		<article class="post-31705 page type-page status-publish hentry missing-thumbnail">

			
			<header class="entry-header section-inner">

				<h1 class="entry-title">Стохастический градиентный спуск. Часть 2</h1>
			</header><!-- .entry-header -->

			<div class="entry-content section-inner">

				
<p class="has-light-gray-color has-text-color"><a href="../../index.html">Материалы</a> > <a href="../index.html">Обучение модели</a></p>



<p>В <a href="../sgd/index.html">первой части</a> мы познакомились с алгоритмом SGD и использованием инерции. Во второй части занятия мы начнем изучать способы изменения размера шага в алгоритме стохастического градиентного спуска. Кроме того, мы рассмотрим еще один градиентный метод &#8212; метод наискорейшего спуска.</p>



<p>При этом прежде всего рассмотрим теоретическое обоснование того, зачем (в большинстве случаев) рекомендуется уменьшать размер шага в процессе обучения алгоритма SGD.</p>



<p class="has-text-align-center has-white-color has-text-color has-background" style="background-color:#004235"><a href="https://colab.research.google.com/drive/1tHFQ52Z-QnJu6R3RH4GubxO3aJzm-NKB?usp=sharing" target="_blank" rel="noreferrer noopener">Продолжим работать в том же блокноте</a>⧉</p>



<h2 class="wp-block-heading" id="0-sgd-i-razmer-shaga">SGD и размер шага</h2>



<p>В процессе full batch градиентного спуска значение градиента $ \nabla f (\theta) $ всегда указывает &#171;правильное&#187; направление обновления весов в сторону $\theta^*.$ Это обусловлено тем, что каждый раз мы рассчитываем градиент на <em>всем</em> наборе данных, и у нас <em>одна</em> функция потерь $f (\theta).$</p>



<p>При этом в стохастическом градиентном спуске, поскольку мы на каждом шаге рассчитываем градиент $ \nabla f_{i} (\theta)$ на разных данных, речь идет о <em>нескольких</em> функциях потерь $f_{i} (\theta),$ и градиент не всегда указывает в сторону $\theta^*.$</p>



<h3 class="wp-block-heading" id="1-prostoy-primer">Простой пример</h3>



<p>Рассмотрим задачу оптимизации с единственным параметром $\theta$ и набором данных, состоящим из трех наблюдений $(x_i, y_i).$</p>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.8.38 -->

		<div id="urvanov-syntax-highlighter-67aa621e7b7e8434580930" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b7e8434580930-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b7e8434580930-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b7e8434580930-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b7e8434580930-4">4</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b7e8434580930-5">5</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b7e8434580930-6">6</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b7e8434580930-1"><span class="crayon-c"># зададим пространство параметра</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b7e8434580930-2"><span class="crayon-v">theta</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">linspace</span><span class="crayon-sy">(</span><span class="crayon-o">-</span><span class="crayon-cn">30</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">30</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b7e8434580930-3">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b7e8434580930-4"><span class="crayon-c"># и данные</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b7e8434580930-5"><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-k ">array</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-cn">0.8</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0.7</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0.6</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b7e8434580930-6"><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-k ">array</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">6</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">7</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0004 seconds] -->
</div>



<p>Возьмем квадратичную функцию потерь. Для трех наблюдений она будет иметь вид</p>



<p>$$ f(\theta) = \frac{1}{3} \sum^3_{i=1} (\theta x_i-y_i)^2 $$</p>



<p>При этом отдельные функции потерь, рассчитываемые на основе каждого из наблюдений, будут заданы через</p>



<p>$$ f_1(\theta) = (\theta x_1-y_1)^2 $$</p>



<p>$$ f_2(\theta) = (\theta x_2-y_2)^2 $$</p>



<p>$$ f_3(\theta) = (\theta x_3-y_3)^2 $$</p>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.8.38 -->

		<div id="urvanov-syntax-highlighter-67aa621e7b7f2385086316" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b7f2385086316-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b7f2385086316-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b7f2385086316-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b7f2385086316-4">4</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b7f2385086316-5">5</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b7f2385086316-6">6</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b7f2385086316-7">7</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b7f2385086316-1"><span class="crayon-c"># объявим функцию потерь для всего набора данных и</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b7f2385086316-2"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">f</span><span class="crayon-sy">(</span><span class="crayon-v">theta</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b7f2385086316-3"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-k ">sum</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">theta</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-k ">len</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b7f2385086316-4">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b7f2385086316-5"><span class="crayon-c"># функцию для каждой пары (x_i, y_i)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b7f2385086316-6"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">f_i</span><span class="crayon-sy">(</span><span class="crayon-v">theta</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">x_i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y_i</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b7f2385086316-7"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">x_i</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">theta</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">y_i</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-cn">2</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0009 seconds] -->
</div>



<p>Найдем градиенты общей функции потерь и функций отдельных наблюдений.</p>



<p>$$ \nabla f(\theta) = 2 \sum_i x_i (x_i \theta-y_i) $$</p>



<p>$$ \nabla f_i(\theta) = 2x_i (x_i \theta-y_i) $$</p>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.8.38 -->

		<div id="urvanov-syntax-highlighter-67aa621e7b7f4447229743" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b7f4447229743-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b7f4447229743-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b7f4447229743-3">3</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b7f4447229743-1"><span class="crayon-c"># объявим градиент f_i в точке theta</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b7f4447229743-2"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">grad_i</span><span class="crayon-sy">(</span><span class="crayon-v">theta</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">x_i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y_i</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b7f4447229743-3"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">2</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">x_i</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">x_i</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">theta</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">y_i</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0003 seconds] -->
</div>



<p>Тогда минимумы этих функций можно найти через $ \nabla f(\theta) = 0$ и $ \nabla f_i(\theta) = 0.$ Получаем.</p>



<p>$$ \theta^* = \frac{ \sum_i x_i y_i }{ \sum_i x_i^2 }, \quad \theta^*_i = \frac{y_i}{x_i} $$</p>



<p>Найдем $\theta^*$ общей функции потерь и значение $f(\theta^*).$</p>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.8.38 -->

		<div id="urvanov-syntax-highlighter-67aa621e7b7f6574604885" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b7f6574604885-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b7f6574604885-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b7f6574604885-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b7f6574604885-4">4</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b7f6574604885-1"><span class="crayon-c"># найдем минимум общей функции потерь и</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b7f6574604885-2"><span class="crayon-c"># значение функции в этой точке</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b7f6574604885-3"><span class="crayon-v">theta_opt</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">dot</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">dot</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-k ">round</span><span class="crayon-sy">(</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b7f6574604885-4"><span class="crayon-v">theta_opt</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">f</span><span class="crayon-sy">(</span><span class="crayon-v">theta_opt</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-k ">round</span><span class="crayon-sy">(</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0004 seconds] -->
</div>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.8.38 -->

		<div id="urvanov-syntax-highlighter-67aa621e7b7f7818350230" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b7f7818350230-1">1</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b7f7818350230-1">(1.01, 15.41)</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0000 seconds] -->
</div>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.8.38 -->

		<div id="urvanov-syntax-highlighter-67aa621e7b7f8241723085" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b7f8241723085-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b7f8241723085-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b7f8241723085-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b7f8241723085-4">4</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b7f8241723085-5">5</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b7f8241723085-6">6</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b7f8241723085-1"><span class="crayon-c"># минимум и значение функции в минимуме можно найти и так</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b7f8241723085-2"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-v">scipy</span><span class="crayon-sy">.</span><span class="crayon-e">optimize </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-i">minimize</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b7f8241723085-3"><span class="crayon-c"># x0 = 5 - это начальное приближение, </span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b7f8241723085-4"><span class="crayon-c"># с которого оптимизатор начнет искать минимум</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b7f8241723085-5"><span class="crayon-v">min_</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">minimize</span><span class="crayon-sy">(</span><span class="crayon-v">f</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">x0</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">args</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b7f8241723085-6"><span class="crayon-v">min_</span><span class="crayon-sy">.</span><span class="crayon-v">x</span><span class="crayon-sy">.</span><span class="crayon-k ">round</span><span class="crayon-sy">(</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">min_</span><span class="crayon-sy">.</span><span class="crayon-v">fun</span><span class="crayon-sy">.</span><span class="crayon-k ">round</span><span class="crayon-sy">(</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0004 seconds] -->
</div>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.8.38 -->

		<div id="urvanov-syntax-highlighter-67aa621e7b7f9991989027" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b7f9991989027-1">1</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b7f9991989027-1">(array([1.01]), 15.41)</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0000 seconds] -->
</div>



<p>Также найдем значение каждой из трех $ \theta_i^*$ и выведем минимальное $ \min \theta_i^* $ и максимальное $ \max \theta_i^* $ значения этого перечня (для чего это нужно, станет понятно чуть позже).</p>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.8.38 -->

		<div id="urvanov-syntax-highlighter-67aa621e7b7fb312326963" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b7fb312326963-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b7fb312326963-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b7fb312326963-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b7fb312326963-4">4</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b7fb312326963-5">5</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b7fb312326963-6">6</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b7fb312326963-7">7</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b7fb312326963-8">8</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b7fb312326963-1"><span class="crayon-c"># найдем минимальные значения каждой из f_i</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b7fb312326963-2"><span class="crayon-v">min_i_list</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b7fb312326963-3"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-v">x_i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">y_i </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-k ">zip</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b7fb312326963-4"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">min_i_list</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">y_i</span><span class="crayon-o">/</span><span class="crayon-v">x_i</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-k ">round</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b7fb312326963-5">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b7fb312326963-6"><span class="crayon-c"># найдем минимальное и максимальное значения этих оптимумов</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b7fb312326963-7"><span class="crayon-v">min_i_opt</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">max_i_opt</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">min</span><span class="crayon-sy">(</span><span class="crayon-v">min_i_list</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-k ">max</span><span class="crayon-sy">(</span><span class="crayon-v">min_i_list</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b7fb312326963-8"><span class="crayon-v">min_i_opt</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">max_i_opt</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0004 seconds] -->
</div>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.8.38 -->

		<div id="urvanov-syntax-highlighter-67aa621e7b7fc264179443" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b7fc264179443-1">1</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b7fc264179443-1">(-7.5, 11.7)</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0000 seconds] -->
</div>



<p>Построим общую функцию потерь $f(\theta),$ функции $f_i (\theta),$ а также покажем общий минимум $\theta^*$ и минимальное и максимальное значения оптимумов $f_i (\theta).$</p>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.8.38 -->

		<div id="urvanov-syntax-highlighter-67aa621e7b7fd360331471" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b7fd360331471-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b7fd360331471-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b7fd360331471-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b7fd360331471-4">4</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b7fd360331471-5">5</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b7fd360331471-6">6</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b7fd360331471-7">7</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b7fd360331471-8">8</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b7fd360331471-9">9</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b7fd360331471-10">10</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b7fd360331471-11">11</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b7fd360331471-12">12</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b7fd360331471-13">13</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b7fd360331471-14">14</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b7fd360331471-15">15</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b7fd360331471-16">16</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b7fd360331471-17">17</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b7fd360331471-18">18</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b7fd360331471-19">19</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b7fd360331471-20">20</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b7fd360331471-21">21</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b7fd360331471-22">22</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b7fd360331471-23">23</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b7fd360331471-24">24</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b7fd360331471-25">25</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b7fd360331471-26">26</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b7fd360331471-27">27</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b7fd360331471-28">28</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b7fd360331471-29">29</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b7fd360331471-30">30</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b7fd360331471-31">31</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b7fd360331471-32">32</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b7fd360331471-33">33</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b7fd360331471-1"><span class="crayon-c"># построим общую функцию потерь</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b7fd360331471-2"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">theta</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">f</span><span class="crayon-sy">(</span><span class="crayon-v">theta_i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">theta_i </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">theta</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">c</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'C1'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b7fd360331471-3"><span class="crayon-c"># сделаем подпись и</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b7fd360331471-4"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">annotate</span><span class="crayon-sy">(</span><span class="crayon-i">r</span><span class="crayon-s">'$f (\theta)$'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-o">-</span><span class="crayon-cn">15</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">90</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">rotation</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">48</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">c</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'C1'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b7fd360331471-5"><span class="crayon-c"># покажем ее оптимум</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b7fd360331471-6"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">vlines</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">theta_opt</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ymin</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">f</span><span class="crayon-sy">(</span><span class="crayon-v">theta_opt</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ymax</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">220</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b7fd360331471-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-v">colors</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'C1'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">linestyles</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'dashed'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b7fd360331471-8"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">annotate</span><span class="crayon-sy">(</span><span class="crayon-i">r</span><span class="crayon-s">'$\theta^*$'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">200</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b7fd360331471-9">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b7fd360331471-10"><span class="crayon-c"># построим функции потерь отдельных наблюдений</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b7fd360331471-11"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">x_i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y_i</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-k ">enumerate</span><span class="crayon-sy">(</span><span class="crayon-k ">zip</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b7fd360331471-12"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">theta</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">f_i</span><span class="crayon-sy">(</span><span class="crayon-v">theta</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">x_i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y_i</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">c</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'C0'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b7fd360331471-13">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b7fd360331471-14"><span class="crayon-c"># сделаем подпись и покажем минимум первой функции</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b7fd360331471-15"><span class="crayon-c"># (он совпадает со значением минимального оптимума)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b7fd360331471-16"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">annotate</span><span class="crayon-sy">(</span><span class="crayon-i">r</span><span class="crayon-s">'$f_1 (\theta)$'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-o">-</span><span class="crayon-cn">25.5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">185</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">rotation</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">65</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">c</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'C0'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b7fd360331471-17"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">vlines</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">min_i_opt</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ymin</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ymax</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">220</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">colors</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'C0'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">linestyles</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'dashed'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b7fd360331471-18"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">annotate</span><span class="crayon-sy">(</span><span class="crayon-i">r</span><span class="crayon-s">'$\min \: \theta_i^*$'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-o">-</span><span class="crayon-cn">6.5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">200</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b7fd360331471-19">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b7fd360331471-20"><span class="crayon-c"># сделаем подпись ко второй функции</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b7fd360331471-21"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">annotate</span><span class="crayon-sy">(</span><span class="crayon-i">r</span><span class="crayon-s">'$f_2 (\theta)$'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">23</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">225</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">rotation</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">60</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">c</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'C0'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b7fd360331471-22">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b7fd360331471-23"><span class="crayon-c"># сделаем подпись и покажем минимум третьей функции</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b7fd360331471-24"><span class="crayon-c"># (он совпадает со значением максимального оптимума)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b7fd360331471-25"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">annotate</span><span class="crayon-sy">(</span><span class="crayon-i">r</span><span class="crayon-s">'$f_3 (\theta)$'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-o">-</span><span class="crayon-cn">15</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">230</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">rotation</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">60</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">c</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'C0'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b7fd360331471-26"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">vlines</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">max_i_opt</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ymin</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ymax</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">220</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">colors</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'C0'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">linestyles</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'dashed'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b7fd360331471-27"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">annotate</span><span class="crayon-sy">(</span><span class="crayon-i">r</span><span class="crayon-s">'$\max \: \theta_i^*$'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">12.5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">200</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b7fd360331471-28">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b7fd360331471-29"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">title</span><span class="crayon-sy">(</span><span class="crayon-s">'SGD quadratic loss'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b7fd360331471-30"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">xlabel</span><span class="crayon-sy">(</span><span class="crayon-i">r</span><span class="crayon-s">'$\theta$'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b7fd360331471-31"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">ylabel</span><span class="crayon-sy">(</span><span class="crayon-i">r</span><span class="crayon-s">'$f(\theta), f_i(\theta)$'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b7fd360331471-32"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">ylim</span><span class="crayon-sy">(</span><span class="crayon-o">-</span><span class="crayon-cn">20</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">500</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b7fd360331471-33"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0030 seconds] -->
</div>



<figure class="wp-block-image size-full"><img fetchpriority="high" decoding="async" width="575" height="456" src="../../wp-content/uploads/2024/10/sgd_quad_loss.png" alt="" class="wp-image-31839" srcset="../../wp-content/uploads/2024/10/sgd_quad_loss.png 575w, ../../wp-content/uploads/2024/10/sgd_quad_loss-300x238.png 300w" sizes="(max-width: 575px) 100vw, 575px" /></figure>



<p>На графике хорошо видно, что при стохастическом градиентном спуске мы рассчитываем градиенты относительно трех функций потерь отдельных наблюдений. Покажем несколько возможных градиентов на графике.</p>



<h3 class="wp-block-heading" id="2-kasatelnye-k-funktsii-poter">Касательные к функции потерь</h3>



<p>Возьмем три значения параметра $\theta&#8217;$ и построим касательные (градиенты) к функциям потерь $f_i (\theta)$ в этих точках. Пусть</p>



<ul class="wp-block-list">
<li>точки со значениями аргумента $ \theta&#8217;_1 = -20 $ и $\theta&#8217;_2 = -1 $ лежат на функции $f_1 (\theta);$ а</li>



<li>точка $ \theta&#8217;_3 = 25 $ лежит на функции $f_2(\theta).$</li>
</ul>



<p>Найдем значения соответствующих функций $f_i (\theta&#8217;)$ в этих точках.</p>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.8.38 -->

		<div id="urvanov-syntax-highlighter-67aa621e7b7fe758648630" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b7fe758648630-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b7fe758648630-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b7fe758648630-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b7fe758648630-4">4</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b7fe758648630-5">5</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b7fe758648630-6">6</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b7fe758648630-7">7</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b7fe758648630-8">8</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b7fe758648630-9">9</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b7fe758648630-10">10</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b7fe758648630-11">11</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b7fe758648630-12">12</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b7fe758648630-1"><span class="crayon-c"># так как первые две точки лежат на функции f_1,</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b7fe758648630-2"><span class="crayon-c"># мы используем данные первого наблюдения (X[0], y[0])</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b7fe758648630-3"><span class="crayon-v">theta_prime_1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">20</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b7fe758648630-4"><span class="crayon-v">f_prime_1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">f_i</span><span class="crayon-sy">(</span><span class="crayon-v">theta_prime_1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b7fe758648630-5">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b7fe758648630-6"><span class="crayon-v">theta_prime_2</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b7fe758648630-7"><span class="crayon-v">f_prime_2</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">f_i</span><span class="crayon-sy">(</span><span class="crayon-v">theta_prime_2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b7fe758648630-8">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b7fe758648630-9"><span class="crayon-c"># третья точка лежит на функции f_2, и</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b7fe758648630-10"><span class="crayon-c"># мы используем данные второго наблюдения (X[1], y[1])</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b7fe758648630-11"><span class="crayon-v">theta_prime_3</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">25</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b7fe758648630-12"><span class="crayon-v">f_prime_3</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">f_i</span><span class="crayon-sy">(</span><span class="crayon-v">theta_prime_3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0005 seconds] -->
</div>



<p>Зададим уравнение касательной.</p>



<p>$$ \text{tangent line} = \underbrace{ \nabla f_{i} (\theta&#8217;) }_{\text{slope}} (\theta-\theta&#8217;) + f_i(\theta&#8217;) $$</p>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.8.38 -->

		<div id="urvanov-syntax-highlighter-67aa621e7b800847557671" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b800847557671-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b800847557671-2">2</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b800847557671-1"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">line</span><span class="crayon-sy">(</span><span class="crayon-v">theta_prime</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">f_prime</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">theta</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">x_i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y_i</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b800847557671-2"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">grad_i</span><span class="crayon-sy">(</span><span class="crayon-v">theta_prime</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">x_i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y_i</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">theta</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">theta_prime</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">f_prime</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0005 seconds] -->
</div>



<p>Вновь построим аналогичный график, только на этот раз покажем касательные в точках $\theta&#8217;.$</p>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.8.38 -->

		<div id="urvanov-syntax-highlighter-67aa621e7b801947692640" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b801947692640-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b801947692640-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b801947692640-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b801947692640-4">4</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b801947692640-5">5</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b801947692640-6">6</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b801947692640-7">7</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b801947692640-8">8</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b801947692640-9">9</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b801947692640-10">10</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b801947692640-11">11</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b801947692640-12">12</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b801947692640-13">13</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b801947692640-14">14</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b801947692640-15">15</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b801947692640-16">16</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b801947692640-17">17</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b801947692640-18">18</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b801947692640-19">19</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b801947692640-20">20</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b801947692640-21">21</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b801947692640-22">22</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b801947692640-23">23</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b801947692640-24">24</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b801947692640-25">25</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b801947692640-26">26</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b801947692640-27">27</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b801947692640-28">28</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b801947692640-29">29</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b801947692640-30">30</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b801947692640-31">31</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b801947692640-32">32</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b801947692640-33">33</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b801947692640-34">34</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b801947692640-35">35</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b801947692640-36">36</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b801947692640-37">37</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b801947692640-38">38</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b801947692640-39">39</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b801947692640-40">40</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b801947692640-41">41</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b801947692640-42">42</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b801947692640-43">43</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b801947692640-44">44</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b801947692640-45">45</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b801947692640-46">46</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b801947692640-1"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">figure</span><span class="crayon-sy">(</span><span class="crayon-v">figsize</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-cn">10</span><span class="crayon-sy">,</span><span class="crayon-cn">8</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b801947692640-2">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b801947692640-3"><span class="crayon-c"># построим общую функцию потерь</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b801947692640-4"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">theta</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-e">f</span><span class="crayon-sy">(</span><span class="crayon-v">theta_i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">theta_i </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">theta</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">c</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'C1'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b801947692640-5"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">annotate</span><span class="crayon-sy">(</span><span class="crayon-i">r</span><span class="crayon-s">'$f (\theta)$'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-o">-</span><span class="crayon-cn">15</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">115</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">rotation</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">55</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">c</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'C1'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b801947692640-6">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b801947692640-7"><span class="crayon-c"># покажем истинный оптимум</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b801947692640-8"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">vlines</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">theta_opt</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ymin</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">f</span><span class="crayon-sy">(</span><span class="crayon-v">theta_opt</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ymax</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">260</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b801947692640-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-v">colors</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'C1'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">linestyles</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'dashed'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b801947692640-10"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">annotate</span><span class="crayon-sy">(</span><span class="crayon-i">r</span><span class="crayon-s">'$\theta^*$'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">200</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b801947692640-11">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b801947692640-12"><span class="crayon-c"># построим функции потерь отдельных наблюдений f_i</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b801947692640-13"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">x_i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y_i</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-k ">enumerate</span><span class="crayon-sy">(</span><span class="crayon-k ">zip</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b801947692640-14"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">theta</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">f_i</span><span class="crayon-sy">(</span><span class="crayon-v">theta</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">x_i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y_i</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">c</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'C0'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b801947692640-15">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b801947692640-16"><span class="crayon-c"># покажем минимальное и</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b801947692640-17"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">vlines</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">min_i_opt</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ymin</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ymax</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">260</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">colors</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'C0'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">linestyles</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'dashed'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b801947692640-18"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">annotate</span><span class="crayon-sy">(</span><span class="crayon-i">r</span><span class="crayon-s">'$\min \: \theta_i^*$'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-o">-</span><span class="crayon-cn">6.5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">200</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b801947692640-19"><span class="crayon-c"># максимальное значения оптимумов функций f_i</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b801947692640-20"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">vlines</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">max_i_opt</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ymin</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ymax</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">260</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">colors</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'C0'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">linestyles</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'dashed'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b801947692640-21"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">annotate</span><span class="crayon-sy">(</span><span class="crayon-i">r</span><span class="crayon-s">'$\max \: \theta_i^*$'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">12.5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">200</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b801947692640-22">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b801947692640-23"><span class="crayon-c"># сделаем подписи к f_i</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b801947692640-24"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">annotate</span><span class="crayon-sy">(</span><span class="crayon-i">r</span><span class="crayon-s">'$f_1 (\theta)$'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-o">-</span><span class="crayon-cn">25.5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">190</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">rotation</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">70</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">c</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'C0'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b801947692640-25"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">annotate</span><span class="crayon-sy">(</span><span class="crayon-i">r</span><span class="crayon-s">'$f_2 (\theta)$'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">20</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">150</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">rotation</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">60</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">c</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'C0'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b801947692640-26"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">annotate</span><span class="crayon-sy">(</span><span class="crayon-i">r</span><span class="crayon-s">'$f_3 (\theta)$'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-o">-</span><span class="crayon-cn">15</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">240</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">rotation</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">65</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">c</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'C0'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b801947692640-27">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b801947692640-28"><span class="crayon-c"># построим касательные</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b801947692640-29"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">theta</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">line</span><span class="crayon-sy">(</span><span class="crayon-v">theta_prime_1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">f_prime_1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">theta</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'--'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">color</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'C2'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b801947692640-30"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">scatter</span><span class="crayon-sy">(</span><span class="crayon-v">theta_prime_1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">f_prime_1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">color</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'C2'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">50</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b801947692640-31">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b801947692640-32"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">theta</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">line</span><span class="crayon-sy">(</span><span class="crayon-v">theta_prime_2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">f_prime_2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">theta</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'--'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">color</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'C3'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b801947692640-33"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">scatter</span><span class="crayon-sy">(</span><span class="crayon-v">theta_prime_2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">f_prime_2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">color</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'C3'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">50</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b801947692640-34">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b801947692640-35"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">theta</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">line</span><span class="crayon-sy">(</span><span class="crayon-v">theta_prime_3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">f_prime_3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">theta</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'--'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">color</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'C2'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b801947692640-36"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">scatter</span><span class="crayon-sy">(</span><span class="crayon-v">theta_prime_3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">f_prime_3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">color</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'C2'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">50</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b801947692640-37">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b801947692640-38"><span class="crayon-c"># покажем интервал между минимальным и максимальным оптимумом f_i</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b801947692640-39"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-v">min_i_opt</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">max_i_opt</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">45</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">45</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'-o'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">color</span><span class="crayon-o">=</span><span class="crayon-s">'k'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b801947692640-40"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">annotate</span><span class="crayon-sy">(</span><span class="crayon-i">r</span><span class="crayon-s">'$R$'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">min_i_opt</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">max_i_opt</span><span class="crayon-sy">)</span><span class="crayon-o">/</span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">65</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b801947692640-41">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b801947692640-42"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">title</span><span class="crayon-sy">(</span><span class="crayon-s">'SGD quadratic loss'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b801947692640-43"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">xlabel</span><span class="crayon-sy">(</span><span class="crayon-i">r</span><span class="crayon-s">'$\theta$'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b801947692640-44"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">ylabel</span><span class="crayon-sy">(</span><span class="crayon-i">r</span><span class="crayon-s">'$f(\theta), f_i(\theta)$'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b801947692640-45"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">ylim</span><span class="crayon-sy">(</span><span class="crayon-o">-</span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">400</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b801947692640-46"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0053 seconds] -->
</div>



<figure class="wp-block-image size-full"><img decoding="async" width="865" height="702" src="../../wp-content/uploads/2024/10/sgd_quad_loss_tangent.png" alt="функции потерь при оптимизации методом SGD" class="wp-image-31871" srcset="../../wp-content/uploads/2024/10/sgd_quad_loss_tangent.png 865w, ../../wp-content/uploads/2024/10/sgd_quad_loss_tangent-300x243.png 300w, ../../wp-content/uploads/2024/10/sgd_quad_loss_tangent-768x623.png 768w, ../../wp-content/uploads/2024/10/sgd_quad_loss_tangent-600x487.png 600w" sizes="(max-width: 865px) 100vw, 865px" /></figure>



<p>Как мы сказали ранее, стохастический градиентный спуск является несмещенной оценкой full batch градиента.</p>



<p>$$ \mathbb{E} [\nabla f_{i} (\theta)] = \nabla f(\theta) $$</p>



<p>Другими словами, в среднем градиенты отдельных функций должны привести нас к истинному минимуму $\theta^*.$ При этом, как видно на рисунке выше, в каждом отдельном случае градиенты $ \nabla f_{i} (\theta)$ могут указывать:</p>



<ul class="wp-block-list">
<li>как в сторону $\theta^*$ и, таким образом, снижать <em>общую</em> ошибку (рассчитываем &#171;зеленые&#187; градиенты, однако ошибку измеряем по &#171;оранжевой&#187; функции);</li>



<li>так и указывать в обратную от $\theta^*$ сторону и соответственно эту ошибку повышать (например, &#171;красный&#187; градиент).</li>
</ul>



<h3 class="wp-block-heading" id="3-region-of-confusion">Region of confusion</h3>



<p>Более того, удаленные от $\theta^*$ &#171;зеленые&#187; градиенты всегда указывают &#171;верное&#187; направление, но по мере приближения к истинному минимуму, могут ошибаться.</p>



<p class="has-background" style="background-color:#ffe8c4">Можно также сказать, что &#171;зеленые&#187; градиенты $ \nabla f_i(\theta) $ имеют <em>тот же знак</em>, что и градиенты общей функции потерь $\nabla f(\theta), $ а &#171;красные&#187; $ \nabla f_i(\theta) $ могут совпадать с ними по знаку или не совпадать.</p>



<p>Интервал, в котором направление градиентов может изменяться, называют <strong>region of confusion</strong>, $R.$ У него есть две особенности:</p>



<ul class="wp-block-list">
<li>границы этого интервала определены минимальным и максимальным значением оптимумов функций отдельных наблюдений $f_i(\theta)$ (именно для этого мы находили их выше);</li>



<li>истинный минимум $ \theta^* $ всегда находится внутри $R$ (ведь за его пределами &#171;зеленые&#187; градиенты всегда совпадают по знаку с общим градиентом).</li>
</ul>



<p>Более формально,</p>



<p>$$ \theta^* \in \biggl[ \min_i \theta_i^*, \; \max_i \theta_i^* \biggr] =: R $$</p>



<p>Это приводит к появлению двух фаз стохастического градиентного спуска:</p>



<ul class="wp-block-list">
<li>уровень ошибки быстро снижается до определенного уровня (&#171;зеленые градиенты&#187;); затем</li>



<li>начинаются хаотичные незатухающие колебания (&#171;красные градиенты&#187;).</li>
</ul>



<p>Приведем две иллюстрации. Вначале сравним расстояние до оптимума последних 500 итераций full batch и SGD алгоритмов, которые мы создали в первой части.</p>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.8.38 -->

		<div id="urvanov-syntax-highlighter-67aa621e7b803014851657" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b803014851657-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b803014851657-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b803014851657-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b803014851657-4">4</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b803014851657-5">5</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b803014851657-6">6</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b803014851657-7">7</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b803014851657-8">8</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b803014851657-9">9</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b803014851657-10">10</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b803014851657-11">11</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b803014851657-1"><span class="crayon-v">fig</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">figure</span><span class="crayon-sy">(</span><span class="crayon-v">figsize</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">8</span><span class="crayon-sy">,</span><span class="crayon-cn">4</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b803014851657-2"><span class="crayon-v">fig</span><span class="crayon-sy">.</span><span class="crayon-e">suptitle</span><span class="crayon-sy">(</span><span class="crayon-s">'Distance to optimum (last iterations)'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b803014851657-3"><span class="crayon-v">ax1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">fig</span><span class="crayon-sy">.</span><span class="crayon-e">add_subplot</span><span class="crayon-sy">(</span><span class="crayon-cn">121</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">title</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'Full Batch'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b803014851657-4"><span class="crayon-v">ax1</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">dist_fb</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">500</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b803014851657-5"><span class="crayon-v">ax1</span><span class="crayon-sy">.</span><span class="crayon-e">set_xlabel</span><span class="crayon-sy">(</span><span class="crayon-s">'iterations'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b803014851657-6"><span class="crayon-v">ax1</span><span class="crayon-sy">.</span><span class="crayon-e">set_ylabel</span><span class="crayon-sy">(</span><span class="crayon-s">'Euclidean distance'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b803014851657-7"><span class="crayon-v">ax2</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">fig</span><span class="crayon-sy">.</span><span class="crayon-e">add_subplot</span><span class="crayon-sy">(</span><span class="crayon-cn">122</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">title</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'SGD'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b803014851657-8"><span class="crayon-v">ax2</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">dist_sgd</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">500</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b803014851657-9"><span class="crayon-v">ax2</span><span class="crayon-sy">.</span><span class="crayon-e">set_xlabel</span><span class="crayon-sy">(</span><span class="crayon-s">'iterations'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b803014851657-10"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">tight_layout</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b803014851657-11"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0011 seconds] -->
</div>



<figure class="wp-block-image size-full"><img decoding="async" width="789" height="396" src="../../wp-content/uploads/2024/10/fb_sgd_last.png" alt="расстояние до оптимума: последние итерации full batch и SGD" class="wp-image-31873" srcset="../../wp-content/uploads/2024/10/fb_sgd_last.png 789w, ../../wp-content/uploads/2024/10/fb_sgd_last-300x151.png 300w, ../../wp-content/uploads/2024/10/fb_sgd_last-768x385.png 768w, ../../wp-content/uploads/2024/10/fb_sgd_last-600x301.png 600w" sizes="(max-width: 789px) 100vw, 789px" /></figure>



<p>Теперь сравним процесс обучения алгоритма с функцией двух параметров $f(\theta_1, \theta_2)$ для размера шага $\eta = 0{,}02$ и $\eta = 0{,}06.$</p>



<figure class="wp-block-image size-large"><img loading="lazy" decoding="async" width="1024" height="484" src="../../wp-content/uploads/2024/10/image-2-1024x484.png" alt="обучение методом стохастического градиентного спуска, размер шага 0,02" class="wp-image-31879" srcset="../../wp-content/uploads/2024/10/image-2-1024x484.png 1024w, ../../wp-content/uploads/2024/10/image-2-300x142.png 300w, ../../wp-content/uploads/2024/10/image-2-768x363.png 768w, ../../wp-content/uploads/2024/10/image-2-1536x726.png 1536w, ../../wp-content/uploads/2024/10/image-2-2048x968.png 2048w, ../../wp-content/uploads/2024/10/image-2-1200x567.png 1200w, ../../wp-content/uploads/2024/10/image-2-600x284.png 600w" sizes="auto, (max-width: 1024px) 100vw, 1024px" /></figure>



<figure class="wp-block-image size-large"><img loading="lazy" decoding="async" width="1024" height="421" src="../../wp-content/uploads/2024/10/image-3-1024x421.png" alt="обучение методом стохастического градиентного спуска, размер шага 0,06" class="wp-image-31880" srcset="../../wp-content/uploads/2024/10/image-3-1024x421.png 1024w, ../../wp-content/uploads/2024/10/image-3-300x123.png 300w, ../../wp-content/uploads/2024/10/image-3-768x315.png 768w, ../../wp-content/uploads/2024/10/image-3-1536x631.png 1536w, ../../wp-content/uploads/2024/10/image-3-2048x841.png 2048w, ../../wp-content/uploads/2024/10/image-3-1200x493.png 1200w, ../../wp-content/uploads/2024/10/image-3-600x246.png 600w" sizes="auto, (max-width: 1024px) 100vw, 1024px" /><figcaption class="wp-element-caption"><em>Иллюстрации созданы <a href="https://fa.bianp.net/teaching/2018/COMP-652/stochastic_gradient.html" target="_blank" rel="noreferrer noopener">здесь</a></em>⧉.</figcaption></figure>



<p>В этом примере мы также можем наблюдать две фазы SGD, однако речь идет уже не об интервале, а об окружности, диаметр которой описывает хаотические колебания второй фазы.</p>



<p>Заметим, что хотя SGD сохраняет незатухающие колебания, он подходит для решения практических задач, где нет необходимости достичь оптимума на обучающей выборке, но есть задача быстро снизить ошибку и показать хорошие результаты на тестовых данных.</p>



<h3 class="wp-block-heading" id="4-dispersiya-gradienta">Дисперсия градиента</h3>



<p>Однако, в случае когда колебания <em>слишком</em> велики, алгоритм SGD может быть неэффективен. Опишем колебания с помощью <strong>дисперсии</strong> стохастического градиента относительно full-batch градиента</p>



<p>$$ Var(\text{SGD}) = \frac{1}{n} \sum^n_{i=1} || \nabla f_{i} (\theta)-\nabla f (\theta) ||^2 $$</p>



<p>Можно сказать, что</p>



<ul class="wp-block-list">
<li>за пределами region of confusion дисперсия равна нулю; а</li>



<li>внутри этого интервала дисперсия больше нуля и увеличивается по мере приближения к $\theta^*.$</li>
</ul>



<p>При этом несложно заметить, что ширина интервала (диаметр окружности) пропорциональна размеру шага</p>



<p>$$ R \propto \eta, $$</p>



<p>а дисперсия внутри $R$ пропорциональна квадрату размера шага</p>



<p>$$ Var(\text{SGD}) \propto \eta^2 $$</p>



<p class="has-background" style="background-color:#ffe8c4">Как следствие, если мы хотим, чтобы стохастический градиентный спуск сходился к $\theta^*,$ нам необходимо постепенно уменьшать $\eta.$</p>



<p>Примечание. С точки зрения нотации изменяющийся размер шага мы будем обозначать как $\eta_k.$ Другими словами, формула SGD будет иметь вид</p>



<p>$$ \theta^{k+1} := \theta^{k}-\eta_k \cdot \nabla f_{i} (\theta^{k}), \quad k = 1, 2, 3, \ldots $$</p>



<h3 class="wp-block-heading" id="5-kriterii-skhodimosti">Критерии сходимости</h3>



<p>Формально сходимость стохастического градиентного спуска обеспечивается таким выбором последовательности $\eta,$ для которой выполняются следующие условия</p>



<p>$$ \sum_{k=1}^\infty (\eta_k) = \infty \quad \text{и} \quad \sum_{k=1}^\infty (\eta_k)^2 &lt; \infty $$</p>



<p>Первое условие (1) описывает изменение размера шага по мере увеличения $k.$ Нам важно, чтобы этот ряд расходился, поскольку так мы гарантированно &#171;дойдем&#187; до точки минимума. Согласно второму условию (2) дисперсия градиента должна стремиться к нулю.</p>



<p>Распространенным решением является последовательность $ \eta_k = \frac{1}{k} $. И действительно при</p>



<p>$$ \lim_{k \to \infty} \frac{1}{k} = 0 $$</p>



<p>выполняется</p>



<p>$$ \sum_{k=1}^\infty \left( \frac{1}{k} \right) = \infty,  \qquad \quad \sum_{k=1}^\infty \left( \frac{1}{k} \right)^2 = \frac{\pi^2}{6} $$</p>



<h2 class="wp-block-heading" id="6-raspisaniya">Расписания</h2>



<p>На практике речь идет о применении различных расписаний (schedules), которые позволяют постепенно снижать размер шага (learning rate decay). Рассмотрим некоторые виды таких расписаний.</p>



<h3 class="wp-block-heading" id="7-inverse-time-decay">Inverse time decay</h3>



<p>Размера шага можно уменьшать путем умножения на коэффициент, обратно пропорциональный эпохе.</p>



<p>$$ \eta_k = \frac{ \eta_{0} }{ 1 + r \cdot \text{epoch} }, $$</p>



<p>где $\eta_0$ &#8212; начальный размер шага, а $r$ &#8212; коэффициент затухания (decay rate).</p>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.8.38 -->

		<div id="urvanov-syntax-highlighter-67aa621e7b806086558063" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b806086558063-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b806086558063-2">2</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b806086558063-1"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">inv_time_decay</span><span class="crayon-sy">(</span><span class="crayon-v">epoch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lr</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">decay</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.05</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b806086558063-2"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">lr</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">decay</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">epoch</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0003 seconds] -->
</div>



<p>Заметим, что коэффициент затухания часто задают как отношение размера шага к количеству эпох.</p>



<p>$$ r = \frac{ \eta_0 }{ \text{epochs} } $$</p>



<p>Например,</p>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.8.38 -->

		<div id="urvanov-syntax-highlighter-67aa621e7b810315930803" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b810315930803-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b810315930803-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b810315930803-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b810315930803-4">4</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b810315930803-1"><span class="crayon-v">lr</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">50</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b810315930803-2">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b810315930803-3"><span class="crayon-v">decay</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">lr</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-e">epochs</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b810315930803-4"><span class="crayon-v">decay</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0002 seconds] -->
</div>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.8.38 -->

		<div id="urvanov-syntax-highlighter-67aa621e7b811769425139" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b811769425139-1">1</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b811769425139-1">0.002</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0000 seconds] -->
</div>



<h3 class="wp-block-heading" id="8-polynomial-decay">Polynomial decay</h3>



<p>Кроме этого, можно использовать полиномиальную функцию</p>



<p>$$ \eta_k = \eta_0 \cdot \left( 1-\frac{ \text{epoch} }{ \text{epochs} } \right)^{p}, $$</p>



<p>где $p$ указывает на степень полинома:</p>



<ul class="wp-block-list">
<li>чем меньше степень, тем медленнее происходит угасание размера шага;</li>



<li>одновременно при $\eta = 1$ очевидным образом происходит линейное уменьшение шага.</li>
</ul>



<p>Поскольку, следуя такому расписанию, на последнем шаге $\eta$ будет равна нулю (а нам бы этого не хотелось), формулу модифицируют следующим образом</p>



<p>$$ \eta_k = (\eta_{\text{start}}-\eta_{\text{end}}) \cdot \left( 1-\frac{ \text{epoch} }{ \text{epochs} } \right)^{p} + \eta_{\text{end}}, $$</p>



<p>где $\eta_{\text{start}}$ и $\eta_{\text{end}}$ представляют собой гиперпараметры, определяющие начальный и конечный размер шага, и $p$ &#8212; степень полинома.</p>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.8.38 -->

		<div id="urvanov-syntax-highlighter-67aa621e7b812596001416" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b812596001416-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b812596001416-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b812596001416-3">3</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b812596001416-1"><span class="crayon-c"># по умолчанию eta линейно уменьшается с 0,1 до 0,01 за 100 эпох</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b812596001416-2"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">polynomial_decay</span><span class="crayon-sy">(</span><span class="crayon-v">epoch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">start_lr</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">end_lr</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.01</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">power</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b812596001416-3"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">start_lr</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">end_lr</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">epoch</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">power</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">end_lr</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0004 seconds] -->
</div>



<h3 class="wp-block-heading" id="9-step-based-decay">Step-based decay</h3>



<p>Помимо этого, размер шага можно уменьшать каждые несколько эпох $(\text{epochs drop})$ в определенное количество раз $(\text{drop rate}).$</p>



<p>$$ \eta = \eta_0 \cdot \text{drop rate}^{\lfloor \frac{ \text{epoch} }{ \text{epochs drop} } \rfloor }, $$</p>



<p>где $\lfloor \; \rfloor $ &#8212; функция пола для получения наибольшего целого числа, меньшего или равного заданному. Посмотрим, как это работает с помощью Питона. Пропишем функцию.</p>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.8.38 -->

		<div id="urvanov-syntax-highlighter-67aa621e7b814556765061" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b814556765061-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b814556765061-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b814556765061-3">3</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b814556765061-1"><span class="crayon-c"># по умолчанию eta уменьшается в два раза на каждой пятой эпохе</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b814556765061-2"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">step_decay</span><span class="crayon-sy">(</span><span class="crayon-v">epoch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lr</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">drop_rate</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs_drop</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">5</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b814556765061-3"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">lr</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">drop_rate</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">floor</span><span class="crayon-sy">(</span><span class="crayon-v">epoch</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-v">epochs_drop</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0003 seconds] -->
</div>



<p>Теперь выведем размер шага для первых десяти эпох с параметрами по умолчанию (левая колонка ниже). Кроме того, выведем (правая колонка):</p>



<ul class="wp-block-list">
<li>отношение  до функции пола $\frac{ \text{epoch} }{ \text{epochs drop} };$</li>



<li>результат после функции пола, то есть степень, в которую будет возводиться $\text{drop rate};$ а также</li>



<li>коэффициент угасания $\text{drop rate}$ на каждой эпохе.</li>
</ul>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.8.38 -->

		<div id="urvanov-syntax-highlighter-67aa621e7b815750980361" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b815750980361-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b815750980361-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b815750980361-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b815750980361-4">4</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b815750980361-5">5</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b815750980361-1"><span class="crayon-v">drop_rate</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs_drop</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">5</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b815750980361-2">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b815750980361-3"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">epoch </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-k ">range</span><span class="crayon-sy">(</span><span class="crayon-cn">15</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b815750980361-4"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-k ">print</span><span class="crayon-sy">(</span><span class="crayon-e">step_decay</span><span class="crayon-sy">(</span><span class="crayon-v">epoch</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'\t'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epoch</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-v">epochs_drop</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">floor</span><span class="crayon-sy">(</span><span class="crayon-v">epoch</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-v">epochs_drop</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">\</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b815750980361-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">drop_rate</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">floor</span><span class="crayon-sy">(</span><span class="crayon-v">epoch</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-v">epochs_drop</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0004 seconds] -->
</div>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.8.38 -->

		<div id="urvanov-syntax-highlighter-67aa621e7b816864071433" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b816864071433-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b816864071433-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b816864071433-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b816864071433-4">4</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b816864071433-5">5</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b816864071433-6">6</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b816864071433-7">7</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b816864071433-8">8</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b816864071433-9">9</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b816864071433-10">10</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b816864071433-11">11</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b816864071433-12">12</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b816864071433-13">13</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b816864071433-14">14</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b816864071433-15">15</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b816864071433-1">0.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.0 0.0 1.0</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b816864071433-2">0.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.2 0.0 1.0</div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b816864071433-3">0.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.4 0.0 1.0</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b816864071433-4">0.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.6 0.0 1.0</div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b816864071433-5">0.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.8 0.0 1.0</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b816864071433-6">0.05&nbsp;&nbsp;&nbsp;&nbsp; 1.0 1.0 0.5</div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b816864071433-7">0.05&nbsp;&nbsp;&nbsp;&nbsp; 1.2 1.0 0.5</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b816864071433-8">0.05&nbsp;&nbsp;&nbsp;&nbsp; 1.4 1.0 0.5</div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b816864071433-9">0.05&nbsp;&nbsp;&nbsp;&nbsp; 1.6 1.0 0.5</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b816864071433-10">0.05&nbsp;&nbsp;&nbsp;&nbsp; 1.8 1.0 0.5</div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b816864071433-11">0.025&nbsp;&nbsp;&nbsp;&nbsp;2.0 2.0 0.25</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b816864071433-12">0.025&nbsp;&nbsp;&nbsp;&nbsp;2.2 2.0 0.25</div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b816864071433-13">0.025&nbsp;&nbsp;&nbsp;&nbsp;2.4 2.0 0.25</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b816864071433-14">0.025&nbsp;&nbsp;&nbsp;&nbsp;2.6 2.0 0.25</div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b816864071433-15">0.025&nbsp;&nbsp;&nbsp;&nbsp;2.8 2.0 0.25</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0000 seconds] -->
</div>



<p>Например, на эпохах с 10 по 14 (если считать с нуля) $\eta$ уменьшается в 4 раза и составляет $ 0{,}1 \cdot 0{,}25 = 0{,}025.$</p>



<h3 class="wp-block-heading" id="10-exponential-decay">Exponential decay</h3>



<p>Размер шага можно также уменьшать по экспоненте</p>



<p>$$ \eta_k = \eta_0 \cdot e^{-r \cdot {\text{epoch}}} $$</p>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.8.38 -->

		<div id="urvanov-syntax-highlighter-67aa621e7b818374071566" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b818374071566-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b818374071566-2">2</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b818374071566-1"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">exp_decay</span><span class="crayon-sy">(</span><span class="crayon-v">epoch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lr</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">decay</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.05</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b818374071566-2"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">lr</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">exp</span><span class="crayon-sy">(</span><span class="crayon-o">-</span><span class="crayon-v">decay</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">epoch</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0003 seconds] -->
</div>



<h3 class="wp-block-heading" id="11-sravnenie-raspisaniy">Сравнение расписаний</h3>



<p>Сравним расписания на графике.</p>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.8.38 -->

		<div id="urvanov-syntax-highlighter-67aa621e7b819135182768" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b819135182768-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b819135182768-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b819135182768-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b819135182768-4">4</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b819135182768-5">5</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b819135182768-6">6</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b819135182768-7">7</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b819135182768-8">8</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b819135182768-9">9</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b819135182768-10">10</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b819135182768-11">11</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b819135182768-12">12</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b819135182768-13">13</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b819135182768-14">14</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b819135182768-15">15</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b819135182768-16">16</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b819135182768-1"><span class="crayon-v">epoch</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">arange</span><span class="crayon-sy">(</span><span class="crayon-cn">101</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b819135182768-2">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b819135182768-3"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">figure</span><span class="crayon-sy">(</span><span class="crayon-v">figsize</span><span class="crayon-o">=</span><span class="crayon-sy">(</span><span class="crayon-cn">10</span><span class="crayon-sy">,</span><span class="crayon-cn">8</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b819135182768-4">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b819135182768-5"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">epoch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">inv_time_decay</span><span class="crayon-sy">(</span><span class="crayon-v">epoch</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">label</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'Inverse Time'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b819135182768-6"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">epoch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">polynomial_decay</span><span class="crayon-sy">(</span><span class="crayon-v">epoch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">power</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.5</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">label</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'Polynomial 0.5'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b819135182768-7"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">epoch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">polynomial_decay</span><span class="crayon-sy">(</span><span class="crayon-v">epoch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">power</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">label</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'Polynomial 1'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b819135182768-8"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">epoch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">polynomial_decay</span><span class="crayon-sy">(</span><span class="crayon-v">epoch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">power</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">label</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'Polynomial 2'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b819135182768-9"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">epoch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">step_decay</span><span class="crayon-sy">(</span><span class="crayon-v">epoch</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">label</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'Step-based 1/2'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b819135182768-10"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">epoch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">exp_decay</span><span class="crayon-sy">(</span><span class="crayon-v">epoch</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">label</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'Exponential'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b819135182768-11"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">legend</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b819135182768-12">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b819135182768-13"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">title</span><span class="crayon-sy">(</span><span class="crayon-s">'Learning rate schedules'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b819135182768-14"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">xlabel</span><span class="crayon-sy">(</span><span class="crayon-s">'epochs'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b819135182768-15"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">ylabel</span><span class="crayon-sy">(</span><span class="crayon-s">'learning rate'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b819135182768-16"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0011 seconds] -->
</div>



<figure class="wp-block-image size-full"><img loading="lazy" decoding="async" width="855" height="701" src="../../wp-content/uploads/2024/10/lr_schedules.png" alt="расписание изменения размера шага, сравнительная иллюстрация" class="wp-image-32010" srcset="../../wp-content/uploads/2024/10/lr_schedules.png 855w, ../../wp-content/uploads/2024/10/lr_schedules-300x246.png 300w, ../../wp-content/uploads/2024/10/lr_schedules-768x630.png 768w, ../../wp-content/uploads/2024/10/lr_schedules-600x492.png 600w" sizes="auto, (max-width: 855px) 100vw, 855px" /></figure>



<p>Опять же обратим внимание, что в полиномиальной функции:</p>



<ul class="wp-block-list">
<li>наиболее быстро снижается полином с наиболее высокой степенью; кроме этого</li>



<li>мы дошли ровно до конечной точки расписания с $ \eta_{\text{end}} = 0{,}01.$</li>
</ul>



<h3 class="wp-block-heading" id="12-sgd-s-raspisaniem">SGD с расписанием</h3>



<p>Модифицируем алгоритм стохастического градиентного спуска.</p>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.8.38 -->

		<div id="urvanov-syntax-highlighter-67aa621e7b81a087692767" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b81a087692767-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b81a087692767-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b81a087692767-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b81a087692767-4">4</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b81a087692767-5">5</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b81a087692767-6">6</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b81a087692767-7">7</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b81a087692767-8">8</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b81a087692767-9">9</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b81a087692767-10">10</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b81a087692767-11">11</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b81a087692767-12">12</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b81a087692767-13">13</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b81a087692767-14">14</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b81a087692767-15">15</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b81a087692767-16">16</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b81a087692767-17">17</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b81a087692767-18">18</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b81a087692767-19">19</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b81a087692767-20">20</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b81a087692767-21">21</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b81a087692767-22">22</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b81a087692767-23">23</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b81a087692767-24">24</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b81a087692767-25">25</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b81a087692767-26">26</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b81a087692767-27">27</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b81a087692767-28">28</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b81a087692767-29">29</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b81a087692767-30">30</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b81a087692767-31">31</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b81a087692767-32">32</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b81a087692767-33">33</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b81a087692767-34">34</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b81a087692767-35">35</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b81a087692767-36">36</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b81a087692767-37">37</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b81a087692767-38">38</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b81a087692767-39">39</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b81a087692767-40">40</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b81a087692767-1"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">fit_sgd_schedule</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">t_opt</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b81a087692767-2"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-v">epochs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">50</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lr</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.1</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b81a087692767-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-v">schedule</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">None</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b81a087692767-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-v">decay</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">None</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b81a087692767-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-v">epochs_drop</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">None</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b81a087692767-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-v">end_lr</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.01</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b81a087692767-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-v">power</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b81a087692767-8">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b81a087692767-9"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-sy">.</span><span class="crayon-k ">copy</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-k ">copy</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b81a087692767-10"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">thetas</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">zeros</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b81a087692767-11">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b81a087692767-12"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c"># зададим eta_0</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b81a087692767-13"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">initial_lr</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">lr</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b81a087692767-14">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b81a087692767-15"><span class="crayon-e">&nbsp;&nbsp;</span><span class="crayon-v">dist_to_opt</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b81a087692767-16">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b81a087692767-17"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">epoch </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-k ">range</span><span class="crayon-sy">(</span><span class="crayon-v">epochs</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b81a087692767-18"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">batches</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">create_batches</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b81a087692767-19"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-v">x_b</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">y_b </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">batches</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b81a087692767-20">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b81a087692767-21"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">n</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">x_b</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b81a087692767-22">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b81a087692767-23"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">dist_to_opt</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-v">linalg</span><span class="crayon-sy">.</span><span class="crayon-e">norm</span><span class="crayon-sy">(</span><span class="crayon-v">thetas</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">t_opt</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b81a087692767-24">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b81a087692767-25"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">grad</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">gradient</span><span class="crayon-sy">(</span><span class="crayon-v">x_b</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y_b</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">thetas</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b81a087692767-26"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">thetas</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">thetas</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">lr</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-e">grad</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b81a087692767-27">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b81a087692767-28"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">schedule</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">'inv_time_decay'</span><span class="crayon-o">:</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b81a087692767-29"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">lr</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">initial_lr</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">decay</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">epoch</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b81a087692767-30">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b81a087692767-31"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">elif</span><span class="crayon-h"> </span><span class="crayon-v">schedule</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">'polynomial_decay'</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b81a087692767-32"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">lr</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">initial_lr</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">end_lr</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">epoch</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">power</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-e">end_lr</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b81a087692767-33"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b81a087692767-34"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">elif</span><span class="crayon-h"> </span><span class="crayon-v">schedule</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">'step_decay'</span><span class="crayon-o">:</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b81a087692767-35"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">lr</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">initial_lr</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">decay</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">floor</span><span class="crayon-sy">(</span><span class="crayon-v">epoch</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-v">epochs_drop</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b81a087692767-36">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b81a087692767-37"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">elif</span><span class="crayon-h"> </span><span class="crayon-v">schedule</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">'exp_decay'</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b81a087692767-38"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">lr</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">initial_lr</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">exp</span><span class="crayon-sy">(</span><span class="crayon-o">-</span><span class="crayon-v">decay</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">epoch</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b81a087692767-39">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b81a087692767-40"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">dist_to_opt</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0020 seconds] -->
</div>



<p>Применим алгоритм к синтетическим данным.</p>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.8.38 -->

		<div id="urvanov-syntax-highlighter-67aa621e7b81c753385852" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b81c753385852-1">1</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b81c753385852-1"><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">synth_reg_data</span><span class="crayon-sy">(</span><span class="crayon-v">t_true</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
</div>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.8.38 -->

		<div id="urvanov-syntax-highlighter-67aa621e7b81e833531438" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b81e833531438-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b81e833531438-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b81e833531438-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b81e833531438-4">4</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b81e833531438-1"><span class="crayon-v">dist_schedule</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">fit_sgd_schedule</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">t_true</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">batch_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b81e833531438-2"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-v">epochs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lr</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.1</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b81e833531438-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-v">schedule</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'exp_decay'</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b81e833531438-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-v">decay</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.05</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0003 seconds] -->
</div>



<p>Сравним обычный SGD (или как еще говорят vanilla SGD) с алгоритмом, который постепенно уменьшает размер шага по экспоненте.</p>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.8.38 -->

		<div id="urvanov-syntax-highlighter-67aa621e7b81f897235295" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b81f897235295-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b81f897235295-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b81f897235295-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b81f897235295-4">4</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b81f897235295-5">5</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b81f897235295-6">6</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b81f897235295-7">7</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b81f897235295-8">8</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b81f897235295-1"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">dist_sgd</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-cn">500</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">label</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'vanilla SGD'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b81f897235295-2"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">dist_schedule</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-cn">500</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">label</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'scheduled SGD'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b81f897235295-3"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">legend</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b81f897235295-4">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b81f897235295-5"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">title</span><span class="crayon-sy">(</span><span class="crayon-s">'Distance to optimum'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b81f897235295-6"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">xlabel</span><span class="crayon-sy">(</span><span class="crayon-s">'iterations'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b81f897235295-7"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">ylabel</span><span class="crayon-sy">(</span><span class="crayon-s">'Euclidean distance'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b81f897235295-8"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0004 seconds] -->
</div>



<figure class="wp-block-image size-full"><img loading="lazy" decoding="async" width="554" height="455" src="../../wp-content/uploads/2024/10/vanilla_scheduled_first.png" alt="расстояние до оптимума: vanilla SGD и SGD с расписанием" class="wp-image-32011" srcset="../../wp-content/uploads/2024/10/vanilla_scheduled_first.png 554w, ../../wp-content/uploads/2024/10/vanilla_scheduled_first-300x246.png 300w" sizes="auto, (max-width: 554px) 100vw, 554px" /></figure>



<p>Разница на одних и тех же данных весьма существенная. Сделаем два замечания:</p>



<ul class="wp-block-list">
<li>во-первых, обратим внимание, что мы увеличили первоначальный размер шага, это оправданно, так как $\eta$ будет довольно быстро снижаться;</li>



<li>кроме того, заметим, что ничто не мешает объединять инерцию и уменьшение размера шага в одном алгоритме, выше мы не сделали этого ради упрощения кода.</li>
</ul>



<p>Дополним изложение сравнением расстояния до оптимума на последних итерациях.</p>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.8.38 -->

		<div id="urvanov-syntax-highlighter-67aa621e7b820986673535" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b820986673535-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b820986673535-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b820986673535-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b820986673535-4">4</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b820986673535-5">5</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b820986673535-6">6</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b820986673535-7">7</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b820986673535-8">8</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b820986673535-9">9</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b820986673535-10">10</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b820986673535-11">11</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b820986673535-12">12</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b820986673535-13">13</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b820986673535-1"><span class="crayon-v">fig</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">figure</span><span class="crayon-sy">(</span><span class="crayon-v">figsize</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">8</span><span class="crayon-sy">,</span><span class="crayon-cn">4</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b820986673535-2"><span class="crayon-v">fig</span><span class="crayon-sy">.</span><span class="crayon-e">suptitle</span><span class="crayon-sy">(</span><span class="crayon-s">'Distance to optimum (last iterations)'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b820986673535-3"><span class="crayon-v">ax1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">fig</span><span class="crayon-sy">.</span><span class="crayon-e">add_subplot</span><span class="crayon-sy">(</span><span class="crayon-cn">121</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">title</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'Vanilla SGD'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b820986673535-4"><span class="crayon-v">ax1</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">dist_sgd</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">500</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b820986673535-5"><span class="crayon-v">ax1</span><span class="crayon-sy">.</span><span class="crayon-e">set_xlabel</span><span class="crayon-sy">(</span><span class="crayon-s">'iterations'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b820986673535-6"><span class="crayon-v">ax1</span><span class="crayon-sy">.</span><span class="crayon-e">set_ylabel</span><span class="crayon-sy">(</span><span class="crayon-s">'Euclidean distance'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b820986673535-7"><span class="crayon-v">ax1</span><span class="crayon-sy">.</span><span class="crayon-e">set_ylim</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0.003</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b820986673535-8"><span class="crayon-v">ax2</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">fig</span><span class="crayon-sy">.</span><span class="crayon-e">add_subplot</span><span class="crayon-sy">(</span><span class="crayon-cn">122</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">title</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'Scheduled SGD'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b820986673535-9"><span class="crayon-v">ax2</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">dist_schedule</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">500</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b820986673535-10"><span class="crayon-v">ax2</span><span class="crayon-sy">.</span><span class="crayon-e">set_xlabel</span><span class="crayon-sy">(</span><span class="crayon-s">'iterations'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b820986673535-11"><span class="crayon-v">ax2</span><span class="crayon-sy">.</span><span class="crayon-e">set_ylim</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0.003</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b820986673535-12"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">tight_layout</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b820986673535-13"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0010 seconds] -->
</div>



<figure class="wp-block-image size-full"><img loading="lazy" decoding="async" width="789" height="396" src="../../wp-content/uploads/2024/10/vanilla_scheduled_last.png" alt="расстояние до оптимума: последние итерации vanilla SGD и SGD с расписанием" class="wp-image-32012" srcset="../../wp-content/uploads/2024/10/vanilla_scheduled_last.png 789w, ../../wp-content/uploads/2024/10/vanilla_scheduled_last-300x151.png 300w, ../../wp-content/uploads/2024/10/vanilla_scheduled_last-768x385.png 768w, ../../wp-content/uploads/2024/10/vanilla_scheduled_last-600x301.png 600w" sizes="auto, (max-width: 789px) 100vw, 789px" /></figure>



<p>Мы видим, что на заключительных итерациях колебания стали существенно меньше.</p>



<h3 class="wp-block-heading" id="13-warmup-i-warm-restarts">Warmup и warm restarts</h3>



<p>Размер шага можно не только уменьшать, но и также</p>



<ul class="wp-block-list">
<li>линейно увеличивать в начале обучения, и тогда говорят о &#171;разогреве&#187; коэффициента скорости обучения (learning rate linear warmup); или</li>



<li>периодически &#171;восстанавливать&#187; до первоначального уровня после определенного количества эпох, а затем снова начинать уменьшение (warm restarts).</li>
</ul>



<p>Во втором случае restart называется &#171;теплым&#187; (warm), поскольку при восстановлении размера шага веса не &#171;сбрасываются&#187; до нулевого или случайного значения, как это бывает при начале обучения и соответственно &#171;холодном&#187; старте (cold start).</p>



<p>Проиллюстрируем эти подходы.</p>



<h4 class="wp-block-heading" id="14-learing-rate-warmup">Learing rate warmup</h4>



<p>Приведем формулу линейного увеличения шага.</p>



<p>$$ \eta_k = (\eta_{\text{target}}-\eta_{\text{init}}) \cdot \frac{ \text{epoch} }{ \text{warmup epochs} }, $$</p>



<p>где $\eta_{\text{init}}$ и $\eta_{\text{target}}$ &#8212; размеры шага в начале и в конце фазы &#171;разогрева&#187;.</p>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.8.38 -->

		<div id="urvanov-syntax-highlighter-67aa621e7b822519739214" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b822519739214-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b822519739214-2">2</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b822519739214-1"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">warmup</span><span class="crayon-sy">(</span><span class="crayon-v">epoch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">init_lr</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">target_lr</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">warmup_epochs</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b822519739214-2"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">target_lr</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">init_lr</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">epoch</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-v">warmup_epochs</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0006 seconds] -->
</div>



<p>Покажем изменение $\eta$ с warmup на обучении длинною 120 эпох.</p>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.8.38 -->

		<div id="urvanov-syntax-highlighter-67aa621e7b824707012322" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b824707012322-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b824707012322-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b824707012322-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b824707012322-4">4</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b824707012322-5">5</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b824707012322-6">6</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b824707012322-7">7</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b824707012322-8">8</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b824707012322-9">9</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b824707012322-10">10</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b824707012322-11">11</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b824707012322-12">12</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b824707012322-13">13</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b824707012322-14">14</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b824707012322-15">15</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b824707012322-1"><span class="crayon-c"># создадим расписание с warmup</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b824707012322-2"><span class="crayon-v">lr_schedule</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b824707012322-3">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b824707012322-4"><span class="crayon-c"># warmup будет длиться 20 эпох, убывание - 100</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b824707012322-5"><span class="crayon-v">warmup_epochs</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">20</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">100</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b824707012322-6">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b824707012322-7"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">epoch </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-k ">range</span><span class="crayon-sy">(</span><span class="crayon-v">warmup_epochs</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b824707012322-8"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c"># вначале eta будет возрастать от 0 до 0,1 в течение 20 эпох</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b824707012322-9"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">lr_schedule</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-e">warmup</span><span class="crayon-sy">(</span><span class="crayon-v">epoch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0.1</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b824707012322-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">warmup_epochs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">warmup_epochs</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b824707012322-11">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b824707012322-12"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">epoch </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-k ">range</span><span class="crayon-sy">(</span><span class="crayon-v">epochs</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b824707012322-13"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c"># затем eta будет убывать по экспоненте</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b824707012322-14"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c"># с уровня 0,1 со скоростью 0,05</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b824707012322-15"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">lr_schedule</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-e">exp_decay</span><span class="crayon-sy">(</span><span class="crayon-v">epoch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0.1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0.05</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0011 seconds] -->
</div>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.8.38 -->

		<div id="urvanov-syntax-highlighter-67aa621e7b825889070565" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b825889070565-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b825889070565-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b825889070565-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b825889070565-4">4</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b825889070565-5">5</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b825889070565-1"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">lr_schedule</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b825889070565-2"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">title</span><span class="crayon-sy">(</span><span class="crayon-s">'Learning rate warmup'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b825889070565-3"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">xlabel</span><span class="crayon-sy">(</span><span class="crayon-s">'epochs'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b825889070565-4"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">ylabel</span><span class="crayon-sy">(</span><span class="crayon-s">'learning rate'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b825889070565-5"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0002 seconds] -->
</div>



<figure class="wp-block-image size-full"><img loading="lazy" decoding="async" width="576" height="455" src="../../wp-content/uploads/2024/10/warmup.png" alt="warmup размера шага" class="wp-image-32041" srcset="../../wp-content/uploads/2024/10/warmup.png 576w, ../../wp-content/uploads/2024/10/warmup-300x237.png 300w" sizes="auto, (max-width: 576px) 100vw, 576px" /></figure>



<h4 class="wp-block-heading" id="15-warm-restarts-i-cosine-decay">Warm restarts и cosine decay</h4>



<p>Warm restarts можно обеспечить, если заставить $\eta$ следовать косинусоиде. В этом случае говорят о cosine decay. Авторы метода предлагают следующее правило изменения размера шага</p>



<p>$$ \eta_k = \eta_{\min} + \underbrace { \frac{1}{2} \biggl( \eta_{\max}-\eta_{\min} \biggl) }_{\text{amplitude} } \cdot \underbrace { \left( 1 + \cos \left( \frac{ \text{epoch} }{ \text{epochs} } \cdot \pi \right) \right) }_{\text{decay} }, $$</p>



<p>где $\eta_{\min}$ и $ \eta_{\max} $ задают минимальный и максимальный размер шага. Заметим, что когда текущая epoch сравнивается с их общим количеством, то</p>



<p>$$ \cos \pi = -1 \longrightarrow \eta_k = \eta_{\min} $$</p>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.8.38 -->

		<div id="urvanov-syntax-highlighter-67aa621e7b827708001070" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b827708001070-1">1</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b827708001070-1"><span class="crayon-v">epoch</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">arange</span><span class="crayon-sy">(</span><span class="crayon-cn">501</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0003 seconds] -->
</div>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.8.38 -->

		<div id="urvanov-syntax-highlighter-67aa621e7b828542616508" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b828542616508-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b828542616508-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b828542616508-3">3</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b828542616508-1"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">cosine_decay_1</span><span class="crayon-sy">(</span><span class="crayon-v">epoch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lr_min</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.01</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">lr_max</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b828542616508-2"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">cos_decay</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">cos</span><span class="crayon-sy">(</span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-v">pi</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">epoch</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b828542616508-3"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">lr_min</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">0.5</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">lr_max</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">lr_min</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">cos_decay</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0006 seconds] -->
</div>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.8.38 -->

		<div id="urvanov-syntax-highlighter-67aa621e7b829750054553" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b829750054553-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b829750054553-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b829750054553-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b829750054553-4">4</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b829750054553-5">5</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b829750054553-1"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">epoch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">cosine_decay_1</span><span class="crayon-sy">(</span><span class="crayon-v">epoch</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b829750054553-2"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">title</span><span class="crayon-sy">(</span><span class="crayon-s">'Cosine decay (warm restarts)'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b829750054553-3"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">xlabel</span><span class="crayon-sy">(</span><span class="crayon-s">'epochs'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b829750054553-4"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">ylabel</span><span class="crayon-sy">(</span><span class="crayon-s">'learning rate'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b829750054553-5"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0002 seconds] -->
</div>



<figure class="wp-block-image size-full"><img loading="lazy" decoding="async" width="576" height="455" src="../../wp-content/uploads/2024/10/cosine.png" alt="cosine decay размера шага, вариант 1" class="wp-image-32088" srcset="../../wp-content/uploads/2024/10/cosine.png 576w, ../../wp-content/uploads/2024/10/cosine-300x237.png 300w" sizes="auto, (max-width: 576px) 100vw, 576px" /></figure>



<p>Одновременно, эту же формулу можно записать и так</p>



<p>$$ \eta_k = \eta_{0} \cdot \left( (1-\alpha) \cdot \left( 1 + \cos \left( \frac{ \text{epoch} }{ \text{epochs} } \cdot \pi \right) \right) + \alpha \right) $$</p>



<p>В этом случае снижение размера шага происходит от $\eta_{0}$ до $(\alpha \cdot \eta_{0}).$</p>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.8.38 -->

		<div id="urvanov-syntax-highlighter-67aa621e7b82b084363018" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b82b084363018-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b82b084363018-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b82b084363018-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b82b084363018-4">4</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b82b084363018-1"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">cosine_decay_2</span><span class="crayon-sy">(</span><span class="crayon-v">epoch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">initial_lr</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">alpha</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b82b084363018-2"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">cosine_decay</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.5</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">cos</span><span class="crayon-sy">(</span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-v">pi</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">epoch</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-v">epochs</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b82b084363018-3"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">decayed</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">alpha</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">cosine_decay</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-e">alpha</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b82b084363018-4"><span class="crayon-e">&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">initial_lr</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">decayed</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0011 seconds] -->
</div>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.8.38 -->

		<div id="urvanov-syntax-highlighter-67aa621e7b82c547625033" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b82c547625033-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b82c547625033-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b82c547625033-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b82c547625033-4">4</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b82c547625033-5">5</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b82c547625033-1"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">epoch</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">cosine_decay_2</span><span class="crayon-sy">(</span><span class="crayon-v">epoch</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b82c547625033-2"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">title</span><span class="crayon-sy">(</span><span class="crayon-s">'Cosine decay (warm restarts)'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b82c547625033-3"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">xlabel</span><span class="crayon-sy">(</span><span class="crayon-s">'epochs'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b82c547625033-4"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">ylabel</span><span class="crayon-sy">(</span><span class="crayon-s">'learning rate'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b82c547625033-5"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0003 seconds] -->
</div>



<figure class="wp-block-image size-full"><img loading="lazy" decoding="async" width="576" height="455" src="../../wp-content/uploads/2024/10/cosine.png" alt="cosine decay размера шага, вариант 2" class="wp-image-32088" srcset="../../wp-content/uploads/2024/10/cosine.png 576w, ../../wp-content/uploads/2024/10/cosine-300x237.png 300w" sizes="auto, (max-width: 576px) 100vw, 576px" /></figure>



<p>Как мы видим размер шага снижается с $\eta_{0} = 0{,}1$ до $\alpha \cdot \eta_{0} = 0{,}1 \cdot 0{,}1 = 0{,}01.$</p>



<h2 class="wp-block-heading" id="16-metod-naiskoreyshego-spuska">Метод наискорейшего спуска</h2>



<p>До сих пор мы так или иначе развивали идею стохастического градиентного спуска. Сделаем небольшое отступление и рассмотрим еще один метод оптимизации с изменяемым размером шага, который называется <strong>методом наискорейшего спуска</strong> (steepest descent method).</p>



<h3 class="wp-block-heading" id="17-bazovyy-algoritm">Базовый алгоритм</h3>



<p>Вначале выполним подготовительную работу. Возьмем те же данные, целевую функцию и ее градиент.</p>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.8.38 -->

		<div id="urvanov-syntax-highlighter-67aa621e7b82d140610498" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b82d140610498-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b82d140610498-2">2</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b82d140610498-1"><span class="crayon-v">t_true</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-k ">array</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-cn">3.2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">2.7</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1.6</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b82d140610498-2"><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">synth_reg_data</span><span class="crayon-sy">(</span><span class="crayon-v">t_true</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0004 seconds] -->
</div>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.8.38 -->

		<div id="urvanov-syntax-highlighter-67aa621e7b82e651869671" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b82e651869671-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b82e651869671-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b82e651869671-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b82e651869671-4">4</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b82e651869671-5">5</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b82e651869671-1"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">objective</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">thetas</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b82e651869671-2"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-k ">sum</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">dot</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">thetas</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">2</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-k ">len</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b82e651869671-3">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b82e651869671-4"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">gradient</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">thetas</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b82e651869671-5"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">dot</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">.</span><span class="crayon-v">T</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">dot</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">thetas</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-k ">len</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0007 seconds] -->
</div>



<p>Создадим алгоритм full batch градиентного спуска. Другими словами, будем выполнять обновление весов в направлении антиградиента (направлении наискорейшего спуска).</p>



<p>При этом внесем в этот хорошо знакомый алгоритм одно изменение. Прекратим обучение не только по достижении максимального количества шагов (max_iter), но и если градиент будет ниже околонулевого порога (tol), то есть алгоритм практически приблизится к оптимуму.</p>



<p>Кроме того, запишем количество затраченных шагов, чтобы, если сработает второе условие, понять как быстро алгоритм достиг почти нулевого градиента.</p>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.8.38 -->

		<div id="urvanov-syntax-highlighter-67aa621e7b830773190454" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b830773190454-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b830773190454-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b830773190454-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b830773190454-4">4</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b830773190454-5">5</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b830773190454-6">6</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b830773190454-7">7</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b830773190454-8">8</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b830773190454-9">9</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b830773190454-10">10</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b830773190454-11">11</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b830773190454-12">12</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b830773190454-13">13</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b830773190454-14">14</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b830773190454-15">15</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b830773190454-16">16</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b830773190454-17">17</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b830773190454-18">18</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b830773190454-19">19</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b830773190454-20">20</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b830773190454-21">21</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b830773190454-22">22</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b830773190454-1"><span class="crayon-c"># пропишем начальный размер шага, порог для градиента и</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b830773190454-2"><span class="crayon-c"># максимальное количество шагов</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b830773190454-3"><span class="crayon-v">eta</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">tol</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">max_iter</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.01</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1e</span><span class="crayon-o">-</span><span class="crayon-cn">8</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">10000</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b830773190454-4">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b830773190454-5"><span class="crayon-c"># зададим начальные параметры</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b830773190454-6"><span class="crayon-v">theta</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">zeros</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b830773190454-7"><span class="crayon-c"># и значение градиента при таких параметрах</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b830773190454-8"><span class="crayon-v">grad_theta</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">gradient</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">theta</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b830773190454-9">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b830773190454-10"><span class="crayon-v">step_count</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b830773190454-11">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b830773190454-12"><span class="crayon-c"># пока не сработает одно из условий</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b830773190454-13"><span class="crayon-c"># (напомню any() выдает True, если хотя бы один из параметров</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b830773190454-14"><span class="crayon-c"># ниже порогового значения)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b830773190454-15"><span class="crayon-st">while</span><span class="crayon-h"> </span><span class="crayon-k ">any</span><span class="crayon-sy">(</span><span class="crayon-k ">abs</span><span class="crayon-sy">(</span><span class="crayon-v">grad_theta</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-v">tol</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">and</span><span class="crayon-h"> </span><span class="crayon-v">step_count</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-h"> </span><span class="crayon-v">max_iter</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b830773190454-16">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b830773190454-17"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c"># обновим веса и</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b830773190454-18"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">theta</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">theta</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">eta</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">grad</span><span class="crayon-sy">_</span>theta</div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b830773190454-19"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c"># рассчитаем градиент в новой точке</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b830773190454-20"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">grad_theta</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">gradient</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">theta</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b830773190454-21"><span class="crayon-h">&nbsp;&nbsp;</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b830773190454-22"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">step_count</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0007 seconds] -->
</div>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.8.38 -->

		<div id="urvanov-syntax-highlighter-67aa621e7b831151366774" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b831151366774-1">1</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b831151366774-1"><span class="crayon-v">theta</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">step_count</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
</div>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.8.38 -->

		<div id="urvanov-syntax-highlighter-67aa621e7b832202447929" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b832202447929-1">1</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b832202447929-1">(array([ 3.19981975,&nbsp;&nbsp;2.00017025, -2.70026591,&nbsp;&nbsp;1.59961898]), 1960)</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
</div>



<p>Как мы видим, алгоритм нашел оптимальные параметры и затратил на это 1960 шагов. Возникает вопрос, как решить эту же задачу за меньшее количество итераций.</p>



<h3 class="wp-block-heading" id="18-optimalnyy-razmer-shaga">Оптимальный размер шага</h3>



<h4 class="wp-block-heading" id="19-odnomernaya-optimizatsiya">Одномерная оптимизация</h4>



<p>Вполне очевидно, что уменьшить количество шагов можно за счет увеличения размера каждого отдельного шага. Для этого на каждом шаге &#171;большого&#187; алгоритма необходимо решить дополнительную задачу одномерной оптимизации относительно $\eta.$</p>



<p>$$ \min_{\eta} f(\theta^k + \eta \nabla \theta^k), $$</p>



<p>где $ \theta^k $ и $ \nabla \theta^k $ &#8212; значения весов и градиента на текущем шаге $k.$</p>



<h4 class="wp-block-heading" id="20-usloviya-volfe">Условия Вольфе</h4>



<p>Одновременно необходимо задать условия выбора оптимального параметра $\eta.$ И действительно,</p>



<ul class="wp-block-list">
<li>если выбрать слишком большой шаг, алгоритм не сойдется к оптимуму;</li>



<li>если размер шага будет недостаточным, алгоритм может не успеть дойти до минимума.</li>
</ul>



<p>Таким образом, нам требуются два критерия:</p>



<ol class="wp-block-list">
<li>уверенности, что значение функции уменьшится в новой точке $\theta_{k+1}$ (критерий достаточного убывания, sufficient decrease condition); а также</li>



<li>знания того, что размер шага не слишком мал (критерий кривизны, curvature condition).</li>
</ol>



<p>Первый критерий называют <strong>условием Армихо</strong> (Armijo condition), а вместе эти критерии называют <strong>условиями Вольфе</strong> (Wolfe conditions). Более формально,</p>



<p>$$ f(\theta_k + \eta_k \cdot p_k) \leq f(\theta_k) + c_1 \eta_k (\nabla f_k^T \cdot p_k), $$</p>



<p>$$ \nabla f (\theta_k + \eta_k p_k)^T \cdot p_k \geq c_2 (\nabla f_k^T \cdot p_k) $$</p>



<p>где $p_k$ (в данном случае) направление антиградиента, то есть $p_k = -\nabla f (\theta_k).$ При этом константы $c_1$ и $c_2$ выбираются таким образом, чтобы $0 &lt; c_1 &lt; c_2 &lt; 1.$ Подробное рассмотрение этих правил выходит за рамки сегодняшнего занятия.</p>



<h4 class="wp-block-heading" id="21-obratnyy-lineynyy-poisk">Обратный линейный поиск</h4>



<p>Подобрать оптимальный размер шага можно с помощью <strong>обратного линейного поиска</strong> (backtracking line search), при котором мы, как правило, начинаем с $\eta = 1$ и затем уменьшаем размер шага (например, в два раза) до тех пор, пока не будет выполнен критерий Армихо.</p>



<p>Интересно, что в этом случае достаточно указать только первый критерий, поскольку так как мы идем от большего размера шага к меньшему, то в любом случае выберем наибольшее возможное $\eta$ и, таким образом, обеспечим выполнение и второго критерия Вольфе.</p>



<p>Такой поиск оптимального $\eta$ называется приближенным линейным поиском (inexact line search), поскольку дает не точную, а достаточную оценку оптимального размера шага $\eta$ на каждой итерации &#171;большого&#187; алгоритма.</p>



<p>Реализуем эту идею на Питоне и попробуем найти оптимальные параметры $\theta$ за меньшее количество шагов.</p>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.8.38 -->

		<div id="urvanov-syntax-highlighter-67aa621e7b834176996556" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b834176996556-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b834176996556-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b834176996556-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b834176996556-4">4</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b834176996556-5">5</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b834176996556-6">6</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b834176996556-7">7</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b834176996556-8">8</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b834176996556-9">9</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b834176996556-10">10</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b834176996556-11">11</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b834176996556-12">12</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b834176996556-13">13</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b834176996556-14">14</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b834176996556-15">15</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b834176996556-16">16</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b834176996556-17">17</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b834176996556-18">18</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b834176996556-19">19</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b834176996556-20">20</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b834176996556-21">21</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b834176996556-1"><span class="crayon-c"># пропишем алгоритм обратного линейного поиска</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b834176996556-2"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">line_search</span><span class="crayon-sy">(</span><span class="crayon-v">eta</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">theta</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">grad_theta</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">c1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1e</span><span class="crayon-o">-</span><span class="crayon-cn">4</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b834176996556-3">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b834176996556-4"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c"># найдем значение целевой функции на шаге k</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b834176996556-5"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">objective_theta</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">objective</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">theta</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b834176996556-6">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b834176996556-7"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c"># найдем значение целевой функции на шаге k+1</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b834176996556-8"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">objective_theta_new</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">objective</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">theta</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">eta</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">grad_theta</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b834176996556-9">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b834176996556-10"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c"># найдем квадрат длины вектора (скалярное произведение)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b834176996556-11"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">grad_sq</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">dot</span><span class="crayon-sy">(</span><span class="crayon-v">grad_theta</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">grad_theta</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b834176996556-12">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b834176996556-13"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c"># зададим условие, обратное условию Армихо</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b834176996556-14"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">not_armijo</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">objective_theta_new</span><span class="crayon-h"> </span><span class="crayon-o">&gt;=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">objective_theta</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">c1</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">eta</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">grad_sq</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b834176996556-15">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b834176996556-16"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c"># пока истинно обратное условие,</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b834176996556-17"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c"># будем уменьшать eta в два раза</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b834176996556-18"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-st">while</span><span class="crayon-h"> </span><span class="crayon-v">not_armijo</span><span class="crayon-o">:</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b834176996556-19"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">eta</span><span class="crayon-h"> </span><span class="crayon-o">*=</span><span class="crayon-h"> </span><span class="crayon-cn">0.5</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b834176996556-20">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b834176996556-21"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">eta</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0012 seconds] -->
</div>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.8.38 -->

		<div id="urvanov-syntax-highlighter-67aa621e7b837898164975" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b837898164975-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b837898164975-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b837898164975-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b837898164975-4">4</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b837898164975-5">5</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b837898164975-6">6</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b837898164975-7">7</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b837898164975-8">8</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b837898164975-9">9</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b837898164975-10">10</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b837898164975-11">11</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b837898164975-12">12</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b837898164975-13">13</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b837898164975-14">14</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b837898164975-15">15</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b837898164975-16">16</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b837898164975-17">17</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b837898164975-18">18</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b837898164975-19">19</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b837898164975-20">20</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b837898164975-21">21</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b837898164975-22">22</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b837898164975-23">23</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-67aa621e7b837898164975-24">24</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b837898164975-25">25</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b837898164975-1"><span class="crayon-c"># зададим порог значения градиента и</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b837898164975-2"><span class="crayon-c"># максимальное количество итераций</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b837898164975-3"><span class="crayon-v">tol</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">max_iter</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1e</span><span class="crayon-o">-</span><span class="crayon-cn">8</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">10000</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b837898164975-4">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b837898164975-5"><span class="crayon-c"># зададим начальные значения параметров и</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b837898164975-6"><span class="crayon-v">theta</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">zeros</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b837898164975-7"><span class="crayon-c"># начальный градиент</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b837898164975-8"><span class="crayon-v">grad_theta</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">gradient</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">theta</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b837898164975-9">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b837898164975-10"><span class="crayon-v">step_count</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b837898164975-11">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b837898164975-12"><span class="crayon-c"># пока не сработает одно из условий</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b837898164975-13"><span class="crayon-st">while</span><span class="crayon-h"> </span><span class="crayon-k ">any</span><span class="crayon-sy">(</span><span class="crayon-k ">abs</span><span class="crayon-sy">(</span><span class="crayon-v">grad_theta</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-v">tol</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">and</span><span class="crayon-h"> </span><span class="crayon-v">step_count</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-h"> </span><span class="crayon-v">max_iter</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b837898164975-14">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b837898164975-15"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c"># будем искать оптимальное значение eta,</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b837898164975-16"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c"># начиная с единицы</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b837898164975-17"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">eta_0</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b837898164975-18"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">eta</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">line_search</span><span class="crayon-sy">(</span><span class="crayon-v">eta_0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">theta</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">grad_theta</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b837898164975-19">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b837898164975-20"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c"># обновлять веса и</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b837898164975-21"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">theta</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">theta</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">eta</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">grad</span><span class="crayon-sy">_</span>theta</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b837898164975-22"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c"># обновлять градиент</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b837898164975-23"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">grad_theta</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">gradient</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">theta</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-67aa621e7b837898164975-24">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b837898164975-25"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">step_count</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0015 seconds] -->
</div>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.8.38 -->

		<div id="urvanov-syntax-highlighter-67aa621e7b838205319067" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b838205319067-1">1</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b838205319067-1"><span class="crayon-v">theta</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">step_count</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
</div>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.8.38 -->

		<div id="urvanov-syntax-highlighter-67aa621e7b839923510017" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-67aa621e7b839923510017-1">1</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-67aa621e7b839923510017-1">(array([ 3.19981975,&nbsp;&nbsp;2.00017025, -2.70026592,&nbsp;&nbsp;1.59961898]), 8)</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0000 seconds] -->
</div>



<p>Метод наискорейшего спуска решил задачу за восемь шагов.</p>



<h2 class="wp-block-heading" id="22-eshche-nemnogo-terminologii">Еще немного терминологии</h2>



<h3 class="wp-block-heading" id="23-klassifikatsiya-metodov-optimizatsii">Классификация методов оптимизации</h3>



<p>Итерационные методы оптимизации в зависимости от того, какая информация требуется для перехода от шага $k$ к шагу $k+1,$ можно разделить на:</p>



<ul class="wp-block-list">
<li>методы <strong>нулевого порядка</strong> (zero-order) или прямые методы, при которых требуется знать лишь значение целевой функции $f(\theta);$</li>



<li>методы <strong>первого порядка</strong> (first-order), которые используют первую производную $f^{\prime}(\theta)$ (для одномерной функции) или градиент $\nabla f(\theta) $ (для многомерной);</li>



<li>методы <strong>второго порядка</strong> (second-order), для которых необходимо знание второй производной $f^{\prime\prime}(\theta)$ или матрицы Гессе $\mathbf{H} f(\theta)$ (Гессиана функции, Hessian).</li>
</ul>



<p>До сих пор мы подробно изучали методы первого порядка. В частности,</p>



<ul class="wp-block-list">
<li><a href="../gradient/index.html">метод градиентного спуска</a> (в том числе SGD);</li>



<li><a href="../reg/index.html">метод координатного спуска</a>; а также</li>



<li>метод наискорейшего спуска.</li>
</ul>



<p>Кроме этого скажем, что по характеру задачи методы делятся на:</p>



<ul class="wp-block-list">
<li>детерминированные (например, full batch градиентный спуск); и</li>



<li>стохастические (SGD).</li>
</ul>



<h3 class="wp-block-heading" id="24-orakul-v-optimizatsii">Оракул в оптимизации</h3>



<p>При выполнении задачи численной оптимизации мы не имеем полного представления о целевой функции. Одновременно на каждой итерации метод может получать некоторую информацию о функции в точке $\theta_k.$ В частности, метод первого порядка может узнать значение функции и значение градиента.</p>



<p>Говорят, что в этом случае метод обращается к <strong>оракулу</strong> (oracle), абстрактной сущности, которая дает <em>локальную</em> информацию о функции в точке.</p>



<p>Например, можно говорить о классе стохастических оракулов первого порядка $\mathcal{O}$, в котором каждый оракул $ \varphi $ определяется через</p>



<p>$$ \varphi (\theta, f) = (\hat{f}(\theta), \hat{g}(\theta)), $$</p>



<p>где $ \hat{f}(\theta) $ и $ \hat{g}(\theta) $ представляют собой случайные величины и являются несмещенной оценкой значения функции и значения градиента в точке $\theta$ соответственно</p>



<p>$$ \mathbb{E} [ \hat{f}(\theta) ] = f(\theta), \quad \mathbb{E} [ \hat{g}(\theta) ] = g(\theta) $$</p>



<h2 class="wp-block-heading" id="25-promezhutochnyy-itog">Промежуточный итог</h2>



<p>Во второй части занятия мы рассмотрели теоретическое обоснование уменьшения размера шага в методе стохастического градиентного спуска, а также изучили как на практике коэффициент скорости обучения может изменяться с помощью расписания.</p>



<p>Кроме этого, мы рассмотрели еще один градиентный метод &#8212; метод наискорейшего спуска, ввели классификацию методов оптимизации и понятие оракула.</p>



<h2 class="wp-block-heading" id="26-spisok-literatury">Список литературы</h2>



<ul class="wp-block-list">
<li><a href="https://arxiv.org/pdf/1608.03983" target="_blank" rel="noreferrer noopener">Stochastic Gradient Descent with Warm Restarts</a>⧉, Loshchilov &amp; Hutter, 2017</li>



<li><a href="https://arxiv.org/pdf/1908.03265" target="_blank" rel="noreferrer noopener">On the Variance of the Adaptive Learning Rate and Beyond</a>⧉, Liu, 2021</li>
</ul>

			</div> <!-- .content -->

			
		</div> <!-- .post -->

					<footer class="site-footer section-inner">

				<p class="copyright">&copy; 2025 <a href="../../index.html" class="site-name"><!--Машинное обучение--></a></p>

			</footer> <!-- footer -->

		</main>
		
		<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js?ver=6.7.1" id="mathjax-js"></script>
<script type="text/javascript" src="../../wp-includes/js/imagesloaded.min.js@ver=5.0.0" id="imagesloaded-js"></script>
<script type="text/javascript" src="../../wp-includes/js/masonry.min.js@ver=4.2.2" id="masonry-js"></script>
<script type="text/javascript" id="mcluhan_global-js-extra">
/* <![CDATA[ */
var mcluhan_ajaxpagination = {"ajaxurl":"https:\/\/www.dmitrymakarov.ru\/wp-admin\/admin-ajax.php","query_vars":"{\"page\":\"\",\"pagename\":\"learning\\\/sgd-02\"}"};
/* ]]> */
</script>
<script type="text/javascript" src="../../wp-content/themes/mcluhan/assets/js/global.js@ver=2.1.1" id="mcluhan_global-js"></script>
			
	</body>
</html>
