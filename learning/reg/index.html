<!DOCTYPE html>

<html class="no-js" lang="ru-RU">

	<head>

		<meta http-equiv="content-type" content="text/html" charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" >

		<link rel="profile" href="http://gmpg.org/xfn/11">

		<meta name='robots' content='index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1' />

<script>
MathJax = {
  tex: {
    inlineMath: [['$','$'],['\\(','\\)']], 
    processEscapes: true
  },
  options: {
    ignoreHtmlClass: 'tex2jax_ignore|editor-rich-text'
  }
};

</script>

	<!-- This site is optimized with the Yoast SEO plugin v26.8 - https://yoast.com/product/yoast-seo-wordpress/ -->
	<title>Регуляризация модели</title>
	<meta name="description" content="Сегодня мы рассмотрим понятия разброса и смещения. Кроме этого, мы изучим регуляризацию и познакомимся с бэггингом для снижения разброса." />
	<link rel="canonical" href="index.html" />
	<meta property="og:locale" content="ru_RU" />
	<meta property="og:type" content="article" />
	<meta property="og:title" content="Регуляризация модели" />
	<meta property="og:description" content="Сегодня мы рассмотрим понятия разброса и смещения. Кроме этого, мы изучим регуляризацию и познакомимся с бэггингом для снижения разброса." />
	<meta property="og:url" content="https://www.dmitrymakarov.ru/learning/reg/" />
	<meta property="og:site_name" content="Дмитрий Макаров" />
	<meta property="article:modified_time" content="2025-09-04T06:53:01+00:00" />
	<meta property="og:image" content="https://www.dmitrymakarov.ru/wp-content/uploads/2021/07/under-over-fitting.jpg" />
	<meta property="og:image:width" content="2424" />
	<meta property="og:image:height" content="845" />
	<meta property="og:image:type" content="image/jpeg" />
	<meta name="twitter:card" content="summary_large_image" />
	<meta name="twitter:label1" content="Примерное время для чтения" />
	<meta name="twitter:data1" content="1 минута" />
	<script type="application/ld+json" class="yoast-schema-graph">{"@context":"https://schema.org","@graph":[{"@type":"WebPage","@id":"https://www.dmitrymakarov.ru/learning/reg/","url":"https://www.dmitrymakarov.ru/learning/reg/","name":"Регуляризация модели","isPartOf":{"@id":"https://www.dmitrymakarov.ru/#website"},"primaryImageOfPage":{"@id":"https://www.dmitrymakarov.ru/learning/reg/#primaryimage"},"image":{"@id":"https://www.dmitrymakarov.ru/learning/reg/#primaryimage"},"thumbnailUrl":"https://www.dmitrymakarov.ru/wp-content/uploads/2021/07/under-over-fitting-1024x357.jpg","datePublished":"2022-04-20T11:07:16+00:00","dateModified":"2025-09-04T06:53:01+00:00","description":"Сегодня мы рассмотрим понятия разброса и смещения. Кроме этого, мы изучим регуляризацию и познакомимся с бэггингом для снижения разброса.","breadcrumb":{"@id":"https://www.dmitrymakarov.ru/learning/reg/#breadcrumb"},"inLanguage":"ru-RU","potentialAction":[{"@type":"ReadAction","target":["https://www.dmitrymakarov.ru/learning/reg/"]}]},{"@type":"ImageObject","inLanguage":"ru-RU","@id":"https://www.dmitrymakarov.ru/learning/reg/#primaryimage","url":"https://www.dmitrymakarov.ru/wp-content/uploads/2021/07/under-over-fitting.jpg","contentUrl":"https://www.dmitrymakarov.ru/wp-content/uploads/2021/07/under-over-fitting.jpg","width":2424,"height":845},{"@type":"BreadcrumbList","@id":"https://www.dmitrymakarov.ru/learning/reg/#breadcrumb","itemListElement":[{"@type":"ListItem","position":1,"name":"Главная страница","item":"https://www.dmitrymakarov.ru/"},{"@type":"ListItem","position":2,"name":"Обучение модели","item":"https://www.dmitrymakarov.ru/learning/"},{"@type":"ListItem","position":3,"name":"Регуляризация модели"}]},{"@type":"WebSite","@id":"https://www.dmitrymakarov.ru/#website","url":"https://www.dmitrymakarov.ru/","name":"Машинное обучение","description":"","publisher":{"@id":"https://www.dmitrymakarov.ru/#/schema/person/3fc221e2d391cc5cfd9d31c9c251c2a4"},"potentialAction":[{"@type":"SearchAction","target":{"@type":"EntryPoint","urlTemplate":"https://www.dmitrymakarov.ru/?s={search_term_string}"},"query-input":{"@type":"PropertyValueSpecification","valueRequired":true,"valueName":"search_term_string"}}],"inLanguage":"ru-RU"},{"@type":["Person","Organization"],"@id":"https://www.dmitrymakarov.ru/#/schema/person/3fc221e2d391cc5cfd9d31c9c251c2a4","name":"DmitryMakarov","image":{"@type":"ImageObject","inLanguage":"ru-RU","@id":"https://www.dmitrymakarov.ru/#/schema/person/image/","url":"https://secure.gravatar.com/avatar/17fb646123c8fccd118e1f2da611da3de8d8e72250637fb08b246e33d4c95395?s=96&d=mm&r=g","contentUrl":"https://secure.gravatar.com/avatar/17fb646123c8fccd118e1f2da611da3de8d8e72250637fb08b246e33d4c95395?s=96&d=mm&r=g","caption":"DmitryMakarov"},"logo":{"@id":"https://www.dmitrymakarov.ru/#/schema/person/image/"}}]}</script>
	<!-- / Yoast SEO plugin. -->


<link rel='dns-prefetch' href='https://cdn.jsdelivr.net/' />
<link rel="alternate" type="application/rss+xml" title="Дмитрий Макаров &raquo; Лента" href="../../feed/index.html" />
<link rel="alternate" type="application/rss+xml" title="Дмитрий Макаров &raquo; Лента комментариев" href="../../comments/feed/index.html" />
<style id='wp-img-auto-sizes-contain-inline-css' type='text/css'>
img:is([sizes=auto i],[sizes^="auto," i]){contain-intrinsic-size:3000px 1500px}
/*# sourceURL=wp-img-auto-sizes-contain-inline-css */
</style>

<link rel='stylesheet' id='urvanov_syntax_highlighter-css' href='../../wp-content/plugins/urvanov-syntax-highlighter/css/min/urvanov_syntax_highlighter.min.css@ver=2.9.0.css' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-theme-familiar-my-copy-css' href='../../wp-content/uploads/urvanov-syntax-highlighter/themes/familiar-my-copy/familiar-my-copy.css@ver=2.9.0.css' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-font-consolas-css' href='../../wp-content/plugins/urvanov-syntax-highlighter/fonts/consolas.css@ver=2.9.0.css' type='text/css' media='all' />
<style id='wp-emoji-styles-inline-css' type='text/css'>

	img.wp-smiley, img.emoji {
		display: inline !important;
		border: none !important;
		box-shadow: none !important;
		height: 1em !important;
		width: 1em !important;
		margin: 0 0.07em !important;
		vertical-align: -0.1em !important;
		background: none !important;
		padding: 0 !important;
	}
/*# sourceURL=wp-emoji-styles-inline-css */
</style>
<link rel='stylesheet' id='wp-block-library-css' href='../../wp-includes/css/dist/block-library/style.min.css@ver=6.9.css' type='text/css' media='all' />
<style id='wp-block-file-inline-css' type='text/css'>
.wp-block-file{box-sizing:border-box}.wp-block-file:not(.wp-element-button){font-size:.8em}.wp-block-file.aligncenter{text-align:center}.wp-block-file.alignright{text-align:right}.wp-block-file *+.wp-block-file__button{margin-left:.75em}:where(.wp-block-file){margin-bottom:1.5em}.wp-block-file__embed{margin-bottom:1em}:where(.wp-block-file__button){border-radius:2em;display:inline-block;padding:.5em 1em}:where(.wp-block-file__button):where(a):active,:where(.wp-block-file__button):where(a):focus,:where(.wp-block-file__button):where(a):hover,:where(.wp-block-file__button):where(a):visited{box-shadow:none;color:#fff;opacity:.85;text-decoration:none}
/*# sourceURL=https://www.dmitrymakarov.ru/wp-includes/blocks/file/style.min.css */
</style>
<style id='wp-block-heading-inline-css' type='text/css'>
h1:where(.wp-block-heading).has-background,h2:where(.wp-block-heading).has-background,h3:where(.wp-block-heading).has-background,h4:where(.wp-block-heading).has-background,h5:where(.wp-block-heading).has-background,h6:where(.wp-block-heading).has-background{padding:1.25em 2.375em}h1.has-text-align-left[style*=writing-mode]:where([style*=vertical-lr]),h1.has-text-align-right[style*=writing-mode]:where([style*=vertical-rl]),h2.has-text-align-left[style*=writing-mode]:where([style*=vertical-lr]),h2.has-text-align-right[style*=writing-mode]:where([style*=vertical-rl]),h3.has-text-align-left[style*=writing-mode]:where([style*=vertical-lr]),h3.has-text-align-right[style*=writing-mode]:where([style*=vertical-rl]),h4.has-text-align-left[style*=writing-mode]:where([style*=vertical-lr]),h4.has-text-align-right[style*=writing-mode]:where([style*=vertical-rl]),h5.has-text-align-left[style*=writing-mode]:where([style*=vertical-lr]),h5.has-text-align-right[style*=writing-mode]:where([style*=vertical-rl]),h6.has-text-align-left[style*=writing-mode]:where([style*=vertical-lr]),h6.has-text-align-right[style*=writing-mode]:where([style*=vertical-rl]){rotate:180deg}
/*# sourceURL=https://www.dmitrymakarov.ru/wp-includes/blocks/heading/style.min.css */
</style>
<style id='wp-block-image-inline-css' type='text/css'>
.wp-block-image>a,.wp-block-image>figure>a{display:inline-block}.wp-block-image img{box-sizing:border-box;height:auto;max-width:100%;vertical-align:bottom}@media not (prefers-reduced-motion){.wp-block-image img.hide{visibility:hidden}.wp-block-image img.show{animation:show-content-image .4s}}.wp-block-image[style*=border-radius] img,.wp-block-image[style*=border-radius]>a{border-radius:inherit}.wp-block-image.has-custom-border img{box-sizing:border-box}.wp-block-image.aligncenter{text-align:center}.wp-block-image.alignfull>a,.wp-block-image.alignwide>a{width:100%}.wp-block-image.alignfull img,.wp-block-image.alignwide img{height:auto;width:100%}.wp-block-image .aligncenter,.wp-block-image .alignleft,.wp-block-image .alignright,.wp-block-image.aligncenter,.wp-block-image.alignleft,.wp-block-image.alignright{display:table}.wp-block-image .aligncenter>figcaption,.wp-block-image .alignleft>figcaption,.wp-block-image .alignright>figcaption,.wp-block-image.aligncenter>figcaption,.wp-block-image.alignleft>figcaption,.wp-block-image.alignright>figcaption{caption-side:bottom;display:table-caption}.wp-block-image .alignleft{float:left;margin:.5em 1em .5em 0}.wp-block-image .alignright{float:right;margin:.5em 0 .5em 1em}.wp-block-image .aligncenter{margin-left:auto;margin-right:auto}.wp-block-image :where(figcaption){margin-bottom:1em;margin-top:.5em}.wp-block-image.is-style-circle-mask img{border-radius:9999px}@supports ((-webkit-mask-image:none) or (mask-image:none)) or (-webkit-mask-image:none){.wp-block-image.is-style-circle-mask img{border-radius:0;-webkit-mask-image:url('data:image/svg+xml;utf8,<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><circle cx="50" cy="50" r="50"/></svg>');mask-image:url('data:image/svg+xml;utf8,<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><circle cx="50" cy="50" r="50"/></svg>');mask-mode:alpha;-webkit-mask-position:center;mask-position:center;-webkit-mask-repeat:no-repeat;mask-repeat:no-repeat;-webkit-mask-size:contain;mask-size:contain}}:root :where(.wp-block-image.is-style-rounded img,.wp-block-image .is-style-rounded img){border-radius:9999px}.wp-block-image figure{margin:0}.wp-lightbox-container{display:flex;flex-direction:column;position:relative}.wp-lightbox-container img{cursor:zoom-in}.wp-lightbox-container img:hover+button{opacity:1}.wp-lightbox-container button{align-items:center;backdrop-filter:blur(16px) saturate(180%);background-color:#5a5a5a40;border:none;border-radius:4px;cursor:zoom-in;display:flex;height:20px;justify-content:center;opacity:0;padding:0;position:absolute;right:16px;text-align:center;top:16px;width:20px;z-index:100}@media not (prefers-reduced-motion){.wp-lightbox-container button{transition:opacity .2s ease}}.wp-lightbox-container button:focus-visible{outline:3px auto #5a5a5a40;outline:3px auto -webkit-focus-ring-color;outline-offset:3px}.wp-lightbox-container button:hover{cursor:pointer;opacity:1}.wp-lightbox-container button:focus{opacity:1}.wp-lightbox-container button:focus,.wp-lightbox-container button:hover,.wp-lightbox-container button:not(:hover):not(:active):not(.has-background){background-color:#5a5a5a40;border:none}.wp-lightbox-overlay{box-sizing:border-box;cursor:zoom-out;height:100vh;left:0;overflow:hidden;position:fixed;top:0;visibility:hidden;width:100%;z-index:100000}.wp-lightbox-overlay .close-button{align-items:center;cursor:pointer;display:flex;justify-content:center;min-height:40px;min-width:40px;padding:0;position:absolute;right:calc(env(safe-area-inset-right) + 16px);top:calc(env(safe-area-inset-top) + 16px);z-index:5000000}.wp-lightbox-overlay .close-button:focus,.wp-lightbox-overlay .close-button:hover,.wp-lightbox-overlay .close-button:not(:hover):not(:active):not(.has-background){background:none;border:none}.wp-lightbox-overlay .lightbox-image-container{height:var(--wp--lightbox-container-height);left:50%;overflow:hidden;position:absolute;top:50%;transform:translate(-50%,-50%);transform-origin:top left;width:var(--wp--lightbox-container-width);z-index:9999999999}.wp-lightbox-overlay .wp-block-image{align-items:center;box-sizing:border-box;display:flex;height:100%;justify-content:center;margin:0;position:relative;transform-origin:0 0;width:100%;z-index:3000000}.wp-lightbox-overlay .wp-block-image img{height:var(--wp--lightbox-image-height);min-height:var(--wp--lightbox-image-height);min-width:var(--wp--lightbox-image-width);width:var(--wp--lightbox-image-width)}.wp-lightbox-overlay .wp-block-image figcaption{display:none}.wp-lightbox-overlay button{background:none;border:none}.wp-lightbox-overlay .scrim{background-color:#fff;height:100%;opacity:.9;position:absolute;width:100%;z-index:2000000}.wp-lightbox-overlay.active{visibility:visible}@media not (prefers-reduced-motion){.wp-lightbox-overlay.active{animation:turn-on-visibility .25s both}.wp-lightbox-overlay.active img{animation:turn-on-visibility .35s both}.wp-lightbox-overlay.show-closing-animation:not(.active){animation:turn-off-visibility .35s both}.wp-lightbox-overlay.show-closing-animation:not(.active) img{animation:turn-off-visibility .25s both}.wp-lightbox-overlay.zoom.active{animation:none;opacity:1;visibility:visible}.wp-lightbox-overlay.zoom.active .lightbox-image-container{animation:lightbox-zoom-in .4s}.wp-lightbox-overlay.zoom.active .lightbox-image-container img{animation:none}.wp-lightbox-overlay.zoom.active .scrim{animation:turn-on-visibility .4s forwards}.wp-lightbox-overlay.zoom.show-closing-animation:not(.active){animation:none}.wp-lightbox-overlay.zoom.show-closing-animation:not(.active) .lightbox-image-container{animation:lightbox-zoom-out .4s}.wp-lightbox-overlay.zoom.show-closing-animation:not(.active) .lightbox-image-container img{animation:none}.wp-lightbox-overlay.zoom.show-closing-animation:not(.active) .scrim{animation:turn-off-visibility .4s forwards}}@keyframes show-content-image{0%{visibility:hidden}99%{visibility:hidden}to{visibility:visible}}@keyframes turn-on-visibility{0%{opacity:0}to{opacity:1}}@keyframes turn-off-visibility{0%{opacity:1;visibility:visible}99%{opacity:0;visibility:visible}to{opacity:0;visibility:hidden}}@keyframes lightbox-zoom-in{0%{transform:translate(calc((-100vw + var(--wp--lightbox-scrollbar-width))/2 + var(--wp--lightbox-initial-left-position)),calc(-50vh + var(--wp--lightbox-initial-top-position))) scale(var(--wp--lightbox-scale))}to{transform:translate(-50%,-50%) scale(1)}}@keyframes lightbox-zoom-out{0%{transform:translate(-50%,-50%) scale(1);visibility:visible}99%{visibility:visible}to{transform:translate(calc((-100vw + var(--wp--lightbox-scrollbar-width))/2 + var(--wp--lightbox-initial-left-position)),calc(-50vh + var(--wp--lightbox-initial-top-position))) scale(var(--wp--lightbox-scale));visibility:hidden}}
/*# sourceURL=https://www.dmitrymakarov.ru/wp-includes/blocks/image/style.min.css */
</style>
<style id='wp-block-list-inline-css' type='text/css'>
ol,ul{box-sizing:border-box}:root :where(.wp-block-list.has-background){padding:1.25em 2.375em}
/*# sourceURL=https://www.dmitrymakarov.ru/wp-includes/blocks/list/style.min.css */
</style>
<style id='wp-block-paragraph-inline-css' type='text/css'>
.is-small-text{font-size:.875em}.is-regular-text{font-size:1em}.is-large-text{font-size:2.25em}.is-larger-text{font-size:3em}.has-drop-cap:not(:focus):first-letter{float:left;font-size:8.4em;font-style:normal;font-weight:100;line-height:.68;margin:.05em .1em 0 0;text-transform:uppercase}body.rtl .has-drop-cap:not(:focus):first-letter{float:none;margin-left:.1em}p.has-drop-cap.has-background{overflow:hidden}:root :where(p.has-background){padding:1.25em 2.375em}:where(p.has-text-color:not(.has-link-color)) a{color:inherit}p.has-text-align-left[style*="writing-mode:vertical-lr"],p.has-text-align-right[style*="writing-mode:vertical-rl"]{rotate:180deg}
/*# sourceURL=https://www.dmitrymakarov.ru/wp-includes/blocks/paragraph/style.min.css */
</style>
<style id='global-styles-inline-css' type='text/css'>
:root{--wp--preset--aspect-ratio--square: 1;--wp--preset--aspect-ratio--4-3: 4/3;--wp--preset--aspect-ratio--3-4: 3/4;--wp--preset--aspect-ratio--3-2: 3/2;--wp--preset--aspect-ratio--2-3: 2/3;--wp--preset--aspect-ratio--16-9: 16/9;--wp--preset--aspect-ratio--9-16: 9/16;--wp--preset--color--black: #121212;--wp--preset--color--cyan-bluish-gray: #abb8c3;--wp--preset--color--white: #fff;--wp--preset--color--pale-pink: #f78da7;--wp--preset--color--vivid-red: #cf2e2e;--wp--preset--color--luminous-vivid-orange: #ff6900;--wp--preset--color--luminous-vivid-amber: #fcb900;--wp--preset--color--light-green-cyan: #7bdcb5;--wp--preset--color--vivid-green-cyan: #00d084;--wp--preset--color--pale-cyan-blue: #8ed1fc;--wp--preset--color--vivid-cyan-blue: #0693e3;--wp--preset--color--vivid-purple: #9b51e0;--wp--preset--color--dark-gray: #333;--wp--preset--color--medium-gray: #555;--wp--preset--color--light-gray: #777;--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple: linear-gradient(135deg,rgb(6,147,227) 0%,rgb(155,81,224) 100%);--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan: linear-gradient(135deg,rgb(122,220,180) 0%,rgb(0,208,130) 100%);--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange: linear-gradient(135deg,rgb(252,185,0) 0%,rgb(255,105,0) 100%);--wp--preset--gradient--luminous-vivid-orange-to-vivid-red: linear-gradient(135deg,rgb(255,105,0) 0%,rgb(207,46,46) 100%);--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray: linear-gradient(135deg,rgb(238,238,238) 0%,rgb(169,184,195) 100%);--wp--preset--gradient--cool-to-warm-spectrum: linear-gradient(135deg,rgb(74,234,220) 0%,rgb(151,120,209) 20%,rgb(207,42,186) 40%,rgb(238,44,130) 60%,rgb(251,105,98) 80%,rgb(254,248,76) 100%);--wp--preset--gradient--blush-light-purple: linear-gradient(135deg,rgb(255,206,236) 0%,rgb(152,150,240) 100%);--wp--preset--gradient--blush-bordeaux: linear-gradient(135deg,rgb(254,205,165) 0%,rgb(254,45,45) 50%,rgb(107,0,62) 100%);--wp--preset--gradient--luminous-dusk: linear-gradient(135deg,rgb(255,203,112) 0%,rgb(199,81,192) 50%,rgb(65,88,208) 100%);--wp--preset--gradient--pale-ocean: linear-gradient(135deg,rgb(255,245,203) 0%,rgb(182,227,212) 50%,rgb(51,167,181) 100%);--wp--preset--gradient--electric-grass: linear-gradient(135deg,rgb(202,248,128) 0%,rgb(113,206,126) 100%);--wp--preset--gradient--midnight: linear-gradient(135deg,rgb(2,3,129) 0%,rgb(40,116,252) 100%);--wp--preset--font-size--small: 16px;--wp--preset--font-size--medium: 20px;--wp--preset--font-size--large: 24px;--wp--preset--font-size--x-large: 42px;--wp--preset--font-size--normal: 18px;--wp--preset--font-size--larger: 28px;--wp--preset--spacing--20: 0.44rem;--wp--preset--spacing--30: 0.67rem;--wp--preset--spacing--40: 1rem;--wp--preset--spacing--50: 1.5rem;--wp--preset--spacing--60: 2.25rem;--wp--preset--spacing--70: 3.38rem;--wp--preset--spacing--80: 5.06rem;--wp--preset--shadow--natural: 6px 6px 9px rgba(0, 0, 0, 0.2);--wp--preset--shadow--deep: 12px 12px 50px rgba(0, 0, 0, 0.4);--wp--preset--shadow--sharp: 6px 6px 0px rgba(0, 0, 0, 0.2);--wp--preset--shadow--outlined: 6px 6px 0px -3px rgb(255, 255, 255), 6px 6px rgb(0, 0, 0);--wp--preset--shadow--crisp: 6px 6px 0px rgb(0, 0, 0);}:where(.is-layout-flex){gap: 0.5em;}:where(.is-layout-grid){gap: 0.5em;}body .is-layout-flex{display: flex;}.is-layout-flex{flex-wrap: wrap;align-items: center;}.is-layout-flex > :is(*, div){margin: 0;}body .is-layout-grid{display: grid;}.is-layout-grid > :is(*, div){margin: 0;}:where(.wp-block-columns.is-layout-flex){gap: 2em;}:where(.wp-block-columns.is-layout-grid){gap: 2em;}:where(.wp-block-post-template.is-layout-flex){gap: 1.25em;}:where(.wp-block-post-template.is-layout-grid){gap: 1.25em;}.has-black-color{color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-color{color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-color{color: var(--wp--preset--color--white) !important;}.has-pale-pink-color{color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-color{color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-color{color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-color{color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-color{color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-color{color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-color{color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-color{color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-color{color: var(--wp--preset--color--vivid-purple) !important;}.has-black-background-color{background-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-background-color{background-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-background-color{background-color: var(--wp--preset--color--white) !important;}.has-pale-pink-background-color{background-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-background-color{background-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-background-color{background-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-background-color{background-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-background-color{background-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-background-color{background-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-background-color{background-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-background-color{background-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-background-color{background-color: var(--wp--preset--color--vivid-purple) !important;}.has-black-border-color{border-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-border-color{border-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-border-color{border-color: var(--wp--preset--color--white) !important;}.has-pale-pink-border-color{border-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-border-color{border-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-border-color{border-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-border-color{border-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-border-color{border-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-border-color{border-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-border-color{border-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-border-color{border-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-border-color{border-color: var(--wp--preset--color--vivid-purple) !important;}.has-vivid-cyan-blue-to-vivid-purple-gradient-background{background: var(--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple) !important;}.has-light-green-cyan-to-vivid-green-cyan-gradient-background{background: var(--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan) !important;}.has-luminous-vivid-amber-to-luminous-vivid-orange-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange) !important;}.has-luminous-vivid-orange-to-vivid-red-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-orange-to-vivid-red) !important;}.has-very-light-gray-to-cyan-bluish-gray-gradient-background{background: var(--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray) !important;}.has-cool-to-warm-spectrum-gradient-background{background: var(--wp--preset--gradient--cool-to-warm-spectrum) !important;}.has-blush-light-purple-gradient-background{background: var(--wp--preset--gradient--blush-light-purple) !important;}.has-blush-bordeaux-gradient-background{background: var(--wp--preset--gradient--blush-bordeaux) !important;}.has-luminous-dusk-gradient-background{background: var(--wp--preset--gradient--luminous-dusk) !important;}.has-pale-ocean-gradient-background{background: var(--wp--preset--gradient--pale-ocean) !important;}.has-electric-grass-gradient-background{background: var(--wp--preset--gradient--electric-grass) !important;}.has-midnight-gradient-background{background: var(--wp--preset--gradient--midnight) !important;}.has-small-font-size{font-size: var(--wp--preset--font-size--small) !important;}.has-medium-font-size{font-size: var(--wp--preset--font-size--medium) !important;}.has-large-font-size{font-size: var(--wp--preset--font-size--large) !important;}.has-x-large-font-size{font-size: var(--wp--preset--font-size--x-large) !important;}
/*# sourceURL=global-styles-inline-css */
</style>

<style id='classic-theme-styles-inline-css' type='text/css'>
/*! This file is auto-generated */
.wp-block-button__link{color:#fff;background-color:#32373c;border-radius:9999px;box-shadow:none;text-decoration:none;padding:calc(.667em + 2px) calc(1.333em + 2px);font-size:1.125em}.wp-block-file__button{background:#32373c;color:#fff;text-decoration:none}
/*# sourceURL=/wp-includes/css/classic-themes.min.css */
</style>
<link rel='stylesheet' id='mcluhan-fonts-css' href='../../wp-content/themes/mcluhan/assets/css/fonts.css@ver=6.9.css' type='text/css' media='all' />
<link rel='stylesheet' id='fontawesome-css' href='../../wp-content/themes/mcluhan/assets/css/font-awesome.css@ver=6.9.css' type='text/css' media='all' />
<link rel='stylesheet' id='mcluhan-style-css' href='../../wp-content/themes/mcluhan/style.css@ver=2.1.1.css' type='text/css' media='all' />
<script type="text/javascript" src="../../wp-includes/js/jquery/jquery.min.js@ver=3.7.1" id="jquery-core-js"></script>
<script type="text/javascript" src="../../wp-includes/js/jquery/jquery-migrate.min.js@ver=3.4.1" id="jquery-migrate-js"></script>
<script type="text/javascript" id="urvanov_syntax_highlighter_js-js-extra">
/* <![CDATA[ */
var UrvanovSyntaxHighlighterSyntaxSettings = {"version":"2.9.0","is_admin":"0","ajaxurl":"https://www.dmitrymakarov.ru/wp-admin/admin-ajax.php","prefix":"urvanov-syntax-highlighter-","setting":"urvanov-syntax-highlighter-setting","selected":"urvanov-syntax-highlighter-setting-selected","changed":"urvanov-syntax-highlighter-setting-changed","special":"urvanov-syntax-highlighter-setting-special","orig_value":"data-orig-value","debug":""};
var UrvanovSyntaxHighlighterSyntaxStrings = {"copy":"Copied to the clipboard","minimize":"Click To Expand Code"};
//# sourceURL=urvanov_syntax_highlighter_js-js-extra
/* ]]> */
</script>
<script type="text/javascript" src="../../wp-content/plugins/urvanov-syntax-highlighter/js/min/urvanov_syntax_highlighter.min.js@ver=2.9.0" id="urvanov_syntax_highlighter_js-js"></script>

			<!-- Customizer CSS -->

			<style type="text/css">

				body .site-header { background-color:#004235; }.social-menu.desktop { background-color:#004235; }.social-menu a:hover { color:#004235; }.social-menu a.active { color:#004235; }.mobile-menu-wrapper { background-color:#004235; }.social-menu.mobile { background-color:#004235; }.mobile-search.active { background-color:#004235; }
			</style>

			<!-- /Customizer CSS -->

					<script>jQuery( 'html' ).removeClass( 'no-js' ).addClass( 'js' );</script>
		<style type="text/css" id="custom-background-css">
body.custom-background { background-color: #fff9ef; }
</style>
	<link rel="icon" href="../../wp-content/uploads/2021/08/cropped-wp-favicon-512-32x32.png" sizes="32x32" />
<link rel="icon" href="../../wp-content/uploads/2021/08/cropped-wp-favicon-512-192x192.png" sizes="192x192" />
<link rel="apple-touch-icon" href="../../wp-content/uploads/2021/08/cropped-wp-favicon-512-180x180.png" />
<meta name="msapplication-TileImage" content="https://www.dmitrymakarov.ru/wp-content/uploads/2021/08/cropped-wp-favicon-512-270x270.png" />

	</head>

	<body class="wp-singular page-template page-template-full-width-page-template page-template-full-width-page-template-php page page-id-12563 page-child parent-pageid-5658 custom-background wp-theme-mcluhan full-width-template">

		
		<a class="skip-link button" href="index.html#site-content">Перейти к содержимому</a>

		<header class="site-header group">

			
			<p class="site-title"><a href="../../index.html" class="site-name">Дмитрий Макаров</a></p>

			
			<div class="nav-toggle">
				<div class="bar"></div>
				<div class="bar"></div>
			</div>

			<div class="menu-wrapper">

				<ul class="main-menu desktop">

					<li id="menu-item-36690" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-home menu-item-36690"><a href="../../index.html">Материалы</a></li>
<li id="menu-item-36691" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-36691"><a href="../../about/index.html">Об авторе</a></li>
				</ul>

			</div><!-- .menu-wrapper -->

			
				<div class="social-menu desktop">

					<ul class="social-menu-inner">

						<li class="social-search-wrapper"><a href="../../index.html@s=.html"></a></li>

						
					</ul><!-- .social-menu-inner -->

				</div><!-- .social-menu -->

			
		</header><!-- header -->

		<div class="mobile-menu-wrapper">

			<ul class="main-menu mobile">
				<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-home menu-item-36690"><a href="../../index.html">Материалы</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-36691"><a href="../../about/index.html">Об авторе</a></li>
					<li class="toggle-mobile-search-wrapper"><a href="index.html#" class="toggle-mobile-search">Поиск</a></li>
							</ul><!-- .main-menu.mobile -->

			
		</div><!-- .mobile-menu-wrapper -->

		
			<div class="mobile-search">

				<div class="untoggle-mobile-search"></div>

				
<form role="search" method="get" class="search-form" action="../../index.html">
	<label class="screen-reader-text" for="search-form-6977026686d91">Поиск:</label>
	<input type="search" id="search-form-6977026686d91" class="search-field" placeholder="Введите запрос" value="" name="s" autocomplete="off" />
	</button>
</form>

				<div class="mobile-results">

					<div class="results-wrapper"></div>

				</div>

			</div><!-- .mobile-search -->

			<div class="search-overlay">

				
<form role="search" method="get" class="search-form" action="../../index.html">
	<label class="screen-reader-text" for="search-form-6977026686e0e">Поиск:</label>
	<input type="search" id="search-form-6977026686e0e" class="search-field" placeholder="Введите запрос" value="" name="s" autocomplete="off" />
	</button>
</form>

			</div><!-- .search-overlay -->

		
		<main class="site-content" id="site-content">
		<article class="post-12563 page type-page status-publish hentry missing-thumbnail">

			
			<header class="entry-header section-inner">

				<h1 class="entry-title">Регуляризация модели</h1>
			</header><!-- .entry-header -->

			<div class="entry-content section-inner">

				
<p class="has-light-gray-color has-text-color"><a href="../../index.html">Материалы</a> &gt; <a href="../index.html">Обучение модели</a></p>



<p>В рамках вводного курса мы обсудили вопрос разделения выборки на <a href="../../intro/train-test/index.html">обучающую и тестовую части</a>, а также затронули проблему переобучения и недообучения модели. Рассмотрим этот вопрос более подробно.</p>



<h2 class="wp-block-heading" id="0-pereobuchenie-i-nedoobuchenie-modeli">Переобучение и недообучение модели</h2>



<p><strong>Переобучение</strong> (overfitting) случается, когда модель показывает хороший результат на обучающей выборке и сильно &#171;проседает&#187; на тестовых данных. При <strong>недообучении</strong> (underfitting) наоборот у алгоритма не получается уловить зависимость на обучающих данных.</p>



<p>Вспомним график из вводного курса.</p>



<figure class="wp-block-image size-large"><img fetchpriority="high" decoding="async" width="1024" height="357" src="../../wp-content/uploads/2021/07/under-over-fitting-1024x357.jpg" alt="переобучение и недообучение модели" class="wp-image-3320" srcset="../../wp-content/uploads/2021/07/under-over-fitting-1024x357.jpg 1024w, ../../wp-content/uploads/2021/07/under-over-fitting-300x105.jpg 300w, ../../wp-content/uploads/2021/07/under-over-fitting-768x268.jpg 768w, ../../wp-content/uploads/2021/07/under-over-fitting-1536x535.jpg 1536w, ../../wp-content/uploads/2021/07/under-over-fitting-2048x714.jpg 2048w, ../../wp-content/uploads/2021/07/under-over-fitting-1200x418.jpg 1200w, ../../wp-content/uploads/2021/07/under-over-fitting-600x209.jpg 600w" sizes="(max-width: 1024px) 100vw, 1024px" /></figure>



<p>Дополним его для наглядности иллюстрацией того, как может повести себя переобученная модель на тестовых данных.</p>



<figure class="wp-block-image size-large is-resized"><img decoding="async" width="1024" height="526" src="../../wp-content/uploads/2022/12/test_overfit-1024x526.jpg" alt="переобученная модель" class="wp-image-16682" style="width:655px;height:336px" srcset="../../wp-content/uploads/2022/12/test_overfit-1024x526.jpg 1024w, ../../wp-content/uploads/2022/12/test_overfit-300x154.jpg 300w, ../../wp-content/uploads/2022/12/test_overfit-768x395.jpg 768w, ../../wp-content/uploads/2022/12/test_overfit-600x308.jpg 600w, ../../wp-content/uploads/2022/12/test_overfit.jpg 1193w" sizes="(max-width: 1024px) 100vw, 1024px" /></figure>



<p>Также рассмотрим пример переобучения и недообучения в задаче классификации.</p>



<figure class="wp-block-image size-large"><img decoding="async" width="1024" height="442" src="../../wp-content/uploads/2022/12/logreg_overfitting-1024x442.jpg" alt="переобучение и недообучение в задаче классификации" class="wp-image-16684" srcset="../../wp-content/uploads/2022/12/logreg_overfitting-1024x442.jpg 1024w, ../../wp-content/uploads/2022/12/logreg_overfitting-300x130.jpg 300w, ../../wp-content/uploads/2022/12/logreg_overfitting-768x332.jpg 768w, ../../wp-content/uploads/2022/12/logreg_overfitting-1200x519.jpg 1200w, ../../wp-content/uploads/2022/12/logreg_overfitting-600x259.jpg 600w, ../../wp-content/uploads/2022/12/logreg_overfitting.jpg 1259w" sizes="(max-width: 1024px) 100vw, 1024px" /></figure>



<p>Приведем еще один график. Предположим, что мы взяли полиномиальную регрессию и смотрим на значение функции потерь на обучающих и тестовых данных для различных степеней полинома.</p>



<figure class="wp-block-image size-large is-resized"><img loading="lazy" decoding="async" width="1024" height="527" src="../../wp-content/uploads/2022/12/poly_reg_loss-1024x527.jpg" alt="RMSE и степень полинома" class="wp-image-16683" style="width:513px;height:264px" srcset="../../wp-content/uploads/2022/12/poly_reg_loss-1024x527.jpg 1024w, ../../wp-content/uploads/2022/12/poly_reg_loss-300x155.jpg 300w, ../../wp-content/uploads/2022/12/poly_reg_loss-768x396.jpg 768w, ../../wp-content/uploads/2022/12/poly_reg_loss-600x309.jpg 600w, ../../wp-content/uploads/2022/12/poly_reg_loss.jpg 1066w" sizes="auto, (max-width: 1024px) 100vw, 1024px" /></figure>



<p>Как вы видите, после определенной границы <em>сложности модели</em> ошибка на тестовых данных начала расти. Рассмотрим этот вопрос под разными углами и введем несколько новых терминов.</p>



<h3 class="wp-block-heading" id="1-slozhnost-modeli">Сложность модели</h3>



<p>Причиной пере- и недообучения может быть степень сложности используемой модели (model complexity). Под сложностью в данном случае понимается тип или типы используемых алгоритмов, способность к выявлению линейных или нелинейных зависимостей, количество рассматриваемых признаков и другие факторы.</p>



<p class="has-background" style="background-color:#ffe8c4">В целом, можно сказать, что более простая модель склонна к недообучению, более сложная &#8212; к переобучению.</p>



<p>Например, полиномиальная модель (особенно с полиномом высокой степени) зачастую способна уловить более сложную зависимость, чем модель линейной регрессии. Если модель хорошо описывает исходные данные, говорят, что у нее низкое смещение.</p>



<h3 class="wp-block-heading" id="2-smeshchenie">Смещение</h3>



<p><strong>Cмещение</strong> (bias) представляет собой разность между истинным и прогнозным значением.</p>



<p>$$ Bias = \mathbb{E}[\hat{f}(x)-f(x)] $$</p>



<p>Иными словами, смещение показывает, насколько хорошо модель обучилась на имеющихся данных (настроилась на выборку). </p>



<p>Впрочем, как мы уже сказали в самом начале, идеально обученная (переобученная) модель может иметь минимальное смещение и при этом показать слабые результаты на тестовых данных. В этом случае говорят о большом разбросе.</p>



<h3 class="wp-block-heading" id="3-razbros">Разброс</h3>



<p><strong>Разброс</strong> (variance) показывает насколько результат модели на обучающей выборке отличается от результата модели на тестовой выборке.</p>



<p>Другими словами, предсказания на тесте (например, на нескольких выборках) имеют разброс, и нам важно, чтобы эти результаты не слишком отличались (тогда можно сказать, что у модели хорошая обобщающая способность).</p>



<p>Математически, речь идет о дисперсии прогнозных значений.</p>



<p>$$ Variance = Var(\hat{y}) = \mathbb{E} \left[ \left( \hat{f}(x)-\mathbb{E}[\hat{f}(x)] \right)^2 \right] $$</p>



<h3 class="wp-block-heading" id="4-kompromiss-smeshcheniya-i-razbrosa">Компромисс смещения и разброса</h3>



<p>На практике стремление к снижению смещения может привести к увеличению разброса, т.е. переобучению, и, наоборот, высокое смещение модели может способствовать низкому разбросу, но смысла в этом не будет, потому что модель будет недообучена.</p>



<p>Эту проблему принято называть компромиссом или дилеммой смещения и разброса (bias-variance tradeoff). Посмотрим на рисунок ниже.</p>


<div class="wp-block-image">
<figure class="aligncenter size-large is-resized"><img loading="lazy" decoding="async" width="1024" height="644" src="../../wp-content/uploads/2022/12/bias_variance_tradeoff-1024x644.png" alt="bias-variance tradeoff" class="wp-image-16687" style="width:732px;height:460px" srcset="../../wp-content/uploads/2022/12/bias_variance_tradeoff-1024x644.png 1024w, ../../wp-content/uploads/2022/12/bias_variance_tradeoff-300x189.png 300w, ../../wp-content/uploads/2022/12/bias_variance_tradeoff-768x483.png 768w, ../../wp-content/uploads/2022/12/bias_variance_tradeoff-1536x966.png 1536w, ../../wp-content/uploads/2022/12/bias_variance_tradeoff-1200x755.png 1200w, ../../wp-content/uploads/2022/12/bias_variance_tradeoff-600x378.png 600w, ../../wp-content/uploads/2022/12/bias_variance_tradeoff.png 1920w" sizes="auto, (max-width: 1024px) 100vw, 1024px" /><figcaption class="wp-element-caption"><em>Источник: <a href="https://en.wikipedia.org/wiki/Bias%E2%80%93variance_tradeoff" target="_blank" rel="noreferrer noopener">Wikipedia</a></em>⧉</figcaption></figure>
</div>


<p>Рассмотрим еще одну полезную для понимания смещения и разброса иллюстрацию. На <strong>левом графике</strong> изобразим модели (каждая точка на графике &#8212; это прогноз одной модели), которые не очень хорошо описывают данные. Например, представим, что мы пытаемся описать полиномом первой степени зависимость, которая гораздо лучше описывается с помощью квадратичной функции.</p>



<p>Оценим прогнозы этих моделей в условной точке $x = 5.$</p>



<figure class="wp-block-image size-large is-resized"><img loading="lazy" decoding="async" width="1024" height="546" src="../../wp-content/uploads/2022/12/reduce-bias-variance-1024x546.jpg" alt="разложение ошибки на смещение, разброс/дисперсию и шум" class="wp-image-16998" style="width:701px;height:373px" srcset="../../wp-content/uploads/2022/12/reduce-bias-variance-1024x546.jpg 1024w, ../../wp-content/uploads/2022/12/reduce-bias-variance-300x160.jpg 300w, ../../wp-content/uploads/2022/12/reduce-bias-variance-768x409.jpg 768w, ../../wp-content/uploads/2022/12/reduce-bias-variance-600x320.jpg 600w, ../../wp-content/uploads/2022/12/reduce-bias-variance.jpg 1030w" sizes="auto, (max-width: 1024px) 100vw, 1024px" /></figure>



<p>Коричневым цветом обозначены те &#171;правильные&#187; ответы, которые мы хотели бы получить. Свести их в одну точку мы не можем, потому что даже в идеальном случае мы можем получить прогноз с точностью до <strong>шума</strong> (случайных колебаний).</p>



<p><strong>Bias</strong> (фиолетовая стрелка) отражает ошибку, связанную с тем, что мы ошиблись с выбором модели (например, степенью полинома). <strong>Разброс</strong> (зеленый цвет) &#8212; прогнозы моделей на нескольких обучающих выборках.</p>



<p>На правом графике, благодаря правильно подобранным (например, полином второй степени, снижает bias) и хорошо настроенным (снижает variance) моделям мы смогли существенно улучшить качество ответов.</p>



<h3 class="wp-block-heading" id="5-shum">Шум</h3>



<p>Шум представляет собой дисперсию истинных значений.</p>



<p>$$ \sigma^2_{\varepsilon} = Var(y) = \mathbb{E} \left[ \left( f(x)-\mathbb{E}[f(x)] \right)^2 \right] $$</p>



<h3 class="wp-block-heading" id="6-razlozhenie-oshibki-na-kvadrat-smeshcheniya-razbros-i-shum">Разложение ошибки на квадрат смещения, разброс и шум</h3>



<p>Изначально мы хотим предсказать следующую зависимость.</p>



<p>$$ \hat{f}(X) = f(X) + \varepsilon, \varepsilon \sim N(0, \sigma^2_{\varepsilon}) $$</p>



<p>Ошибка в точке $x$ равна</p>



<p>$$ Err(x) = \mathbb{E}[(f(x)-\hat{f}(x))^2] $$</p>



<p>Эту ошибку можно разложить на</p>



<p>$$ Err(x) = Bias^2 + Variance + Noise $$</p>



<p>$$ = \left( \mathbb{E}[\hat{f}(x)-f(x)] \right)^2 + \mathbb{E} \left[ \left( \hat{f}(x)-\mathbb{E}[\hat{f}(x)] \right)^2 \right] + \sigma^2_{\varepsilon}, $$</p>



<p>Обоснуем это разложение. Прежде всего вспомним, что <a href="https://proofwiki.org/wiki/Variance_as_Expectation_of_Square_minus_Square_of_Expectation" target="_blank" rel="noreferrer noopener">дисперсия равна</a>⧉ матожиданию квадрата случайной величины минус квадрат ее матожидания.</p>



<p>$$ Var(X) = \mathbb{E}[(X-\mathbb{E}[X])^2] = \mathbb{E}[X^2]-\mathbb{E}[X]^2 $$</p>



<p>Обозначим истинные значения как $y,$ прогнозные как $\hat{y}$.</p>



<p>$$ Err(x) = \mathbb{E}(y-\hat{y})^2 = \mathbb{E}(y^2 + \hat{y}^2-2y\hat{y})$$</p>



<p>$$ = \mathbb{E}(y^2)+\mathbb{E}(\hat{y})^2-2(\mathbb{E}y\hat{y})$$</p>



<p>Введем новые слагаемые $(\mathbb{E}y)^2-(\mathbb{E}y)^2$ и $(\mathbb{E}\hat{y})^2-(\mathbb{E}\hat{y})^2$.</p>



<p>$$ Err(x) = \mathbb{E}(y^2)-(\mathbb{E}y)^2+(\mathbb{E}y)^2 + $$</p>



<p>$$ \mathbb{E}(\hat{y}^2)-(\mathbb{E}\hat{y})^2+(\mathbb{E}\hat{y})^2-2(\mathbb{E}y\hat{y}) $$</p>



<p>Заметим, что</p>



<p>$$ \mathbb{E}(y^2)-(\mathbb{E}y)^2 = Var(y)$$</p>



<p>$$ \mathbb{E}(\hat{y}^2)-(\mathbb{E}\hat{y})^2 = Var(\hat{y}) $$</p>



<p>$$ (\mathbb{E}y)^2-2(\mathbb{E}y\hat{y})+(\mathbb{E}\hat{y})^2 = \mathbb{E}(y-\hat{y})^2 $$</p>



<p>Тогда,</p>



<p>$$ Err(x) = \underbrace{\mathbb{E}(y-\hat{y})^2}_{Bias^2} + \underbrace{Var(\hat{y})}_{Variance} + \underbrace{Var(y)}_{Noise} $$</p>



<h3 class="wp-block-heading" id="7-kak-borotsya-s-pereobucheniem">Как бороться с переобучением?</h3>



<p>Сложная, переобученная модель может иметь очень много признаков (особенно если речь идёт о полиноме).</p>



<p>Очевидно, в большинстве случае визуальный подбор степени полинома (как мы это делали ранее для линейной и логистической полиномиальных регрессий) не представляется возможным. Более того, модели с таким количеством признаков в силу их высокой сложности (complexity) склонны к переобучению.</p>



<p>Бороться с этим можно тремя способами:</p>



<p><strong>Первый вариант</strong>. Увеличить размер обучающей выборки. Маленькая выборка снижает обобщающую способность модели, а значит повышает разброс.</p>



<p><strong>Второй вариант</strong>. Уменьшить количество признаков (вручную или через алгоритм, кроме того вводить наказание за новые признаки, как например, скорректированный коэффициент детерминации, adjusted R-square). Опасность здесь &#8212; выбросить нужные признаки.</p>



<p><strong>Третий вариант</strong>. Использовать регуляризацию, которая позволяет снижать параметр (вес, коэффициент) признака и, таким образом, снижать его значимость. Предположим, что мы хотим уменьшить влияние второго признака в модели ниже.</p>



<p>$$ y = 15x_1 + 10x_2 + 5 \rightarrow y = 15x_1 + 5x_2 + 5 $$</p>



<p>Подобное изменение, как правило, приводит к тому, что модель меньше настраивается на шум (излишнюю вариативность) в обучающих данных и, как следствие, показывает лучшие результаты на тестовой выборке.</p>



<p class="has-background" style="background-color:#ffe8c4">Другими словами, по сравнению с обычной линейной регрессией, у нее немного большее смещение (bias), но зато заметно меньший разброс (variance).</p>



<p>Три дополнительных соображения:</p>



<ul class="wp-block-list">
<li>очевидно, что если мы снизим параметр признака до нуля, то этот признак будет удален из модели;</li>



<li>как правило, не имеет смысла применять регуляризацию к свободному коэффициенту $ \theta_0; $</li>



<li>очень маленькие значения $\boldsymbol \theta$ также могут повышать ошибку.</li>
</ul>



<p class="has-text-align-center has-white-color has-text-color has-background" style="background-color:#004235"><a href="https://colab.research.google.com/drive/1p_aIzzwONKjVhDU0xnFO5dbYphzywTYv?usp=sharing" target="_blank" rel="noreferrer noopener">Откроем блокнот к этому занятию</a>⧉</p>



<div class="wp-block-file"><a id="wp-block-file--media-7c5c26d6-41c5-4071-8aab-9408c199ea3d" href="../../wp-content/uploads/2022/04/boston.csv">boston.csv</a><a href="../../wp-content/uploads/2022/04/boston.csv" class="wp-block-file__button wp-element-button" download aria-describedby="wp-block-file--media-7c5c26d6-41c5-4071-8aab-9408c199ea3d">Скачать</a></div>



<h2 class="wp-block-heading" id="8-regulyarizatsiya-lineynoy-regressii">Регуляризация линейной регрессии</h2>



<p>Рассмотрим несколько вариантов регуляризации линейной регрессии, Ridge, Lasso и Elastic Net, а также изучим байесовский подход к этой модели.</p>



<h3 class="wp-block-heading" id="9-podgotovka-dannykh">Подготовка данных</h3>



<p>Подгрузим данные о недвижимости в Бостоне, разделим на обучающую и тестовую части и выполним стандартизацию.</p>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.9.0 -->

		<div id="urvanov-syntax-highlighter-697702667dc36668150675" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dc36668150675-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dc36668150675-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dc36668150675-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dc36668150675-4">4</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dc36668150675-5">5</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dc36668150675-6">6</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dc36668150675-7">7</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dc36668150675-8">8</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dc36668150675-9">9</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dc36668150675-10">10</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dc36668150675-11">11</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dc36668150675-1"><span class="crayon-v">boston</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">pd</span><span class="crayon-sy">.</span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'/content/boston.csv'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dc36668150675-2">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dc36668150675-3"><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">boston</span><span class="crayon-sy">[</span><span class="crayon-sy">[</span><span class="crayon-s">'LSTAT'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'RM'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'PTRATIO'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'INDUS'</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dc36668150675-4"><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">boston</span><span class="crayon-sy">.</span><span class="crayon-e">MEDV</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dc36668150675-5">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dc36668150675-6"><span class="crayon-v">X_train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y_train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y_test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">train_test_split</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dc36668150675-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">test_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.3</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dc36668150675-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">random_state</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">42</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dc36668150675-9"><span class="crayon-v">scaler</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">StandardScaler</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dc36668150675-10"><span class="crayon-v">X_train</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">fit_transform</span><span class="crayon-sy">(</span><span class="crayon-v">X_train</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dc36668150675-11"><span class="crayon-v">X_test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">scaler</span><span class="crayon-sy">.</span><span class="crayon-e">transform</span><span class="crayon-sy">(</span><span class="crayon-v">X_test</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0006 seconds] -->
</div>



<h3 class="wp-block-heading" id="10-ordinary-least-squares">Ordinary Least Squares</h3>



<p>Построим регрессию без регуляризации методом наименьших квадратов и выведем RMSE на обучающей и тестовой выборках.</p>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.9.0 -->

		<div id="urvanov-syntax-highlighter-697702667dc88653375177" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dc88653375177-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dc88653375177-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dc88653375177-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dc88653375177-4">4</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dc88653375177-5">5</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dc88653375177-6">6</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dc88653375177-7">7</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dc88653375177-8">8</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dc88653375177-9">9</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dc88653375177-10">10</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dc88653375177-11">11</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dc88653375177-12">12</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dc88653375177-1"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">linear_model </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">LinearRegression</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dc88653375177-2">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dc88653375177-3"><span class="crayon-v">ols</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">LinearRegression</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dc88653375177-4"><span class="crayon-v">ols</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">X_train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y_train</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dc88653375177-5">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dc88653375177-6"><span class="crayon-v">y_pred_train</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">ols</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">X_train</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dc88653375177-7"><span class="crayon-v">y_pred_test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">ols</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">X_test</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dc88653375177-8">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dc88653375177-9"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">metrics </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">root_mean_squared_error</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dc88653375177-10">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dc88653375177-11"><span class="crayon-k ">print</span><span class="crayon-sy">(</span><span class="crayon-s">'train: '</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-k ">str</span><span class="crayon-sy">(</span><span class="crayon-e">root_mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">y_train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y_pred_train</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dc88653375177-12"><span class="crayon-k ">print</span><span class="crayon-sy">(</span><span class="crayon-s">'test: '</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-k ">str</span><span class="crayon-sy">(</span><span class="crayon-e">root_mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">y_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y_pred_test</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0005 seconds] -->
</div>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.9.0 -->

		<div id="urvanov-syntax-highlighter-697702667dc8c291616179" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dc8c291616179-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dc8c291616179-2">2</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dc8c291616179-1">train: 5.255700309296848</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dc8c291616179-2">test: 5.127682560624116</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0000 seconds] -->
</div>



<h3 class="wp-block-heading" id="11-ridge-regression">Ridge Regression</h3>



<h4 class="wp-block-heading" id="12-funktsiya-poter">Функция потерь</h4>



<p>Ридж-регрессия (ridge regression, гребневая регрессия) вводит наказание (penalty) за слишком большие коэффициенты. Это наказание представляет собой сумму коэффициентов $ \boldsymbol \theta $, возведенных в квадрат (чтобы положительные и отрицательные значения не взаимоудалялись).</p>



<p>$$ J_{Ridge}(\boldsymbol \theta) = MSE + \sum_{j=1}^{d} {\theta_j^2} $$</p>



<p>Опять же $\theta_0$ не учитывается, поэтому мы суммируем $d$ признаки $\theta_j$ с единицы, а не с нуля. В векторизованной форме,</p>



<p>$$ J_{Ridge}(\boldsymbol \theta) = MSE + \boldsymbol \theta^\top \boldsymbol \theta $$</p>



<p>Корень из скалярного произведения вектора на самого себя есть его длина. Так как в данном случае мы корень не извлекаем, то можем записать слагаемое регуляризации (regularization term) как </p>



<p>$$ J_{Ridge}(\theta) = MSE + || \theta ||^2_2 $$</p>



<p>Наконец, введем еще одно дополнение, параметр $\alpha,$ который позволит контролировать силу воздействия этого слагаемого на уровень ошибки.</p>



<p>$$ J_{Ridge}(\boldsymbol \theta) = MSE + \alpha \cdot || \boldsymbol \theta ||^2_2 $$</p>



<p>Заметим, что Ridge Regression также называют L2-регуляризацией, потому что она использует L2-норму в качестве соответствующего слагаемого.</p>



<p>Посмотрим на иллюстрацию регуляризации (параметры $\boldsymbol \theta$ заменены на $\boldsymbol \beta$).</p>



<figure class="wp-block-image size-full is-resized"><img loading="lazy" decoding="async" width="762" height="528" src="../../wp-content/uploads/2022/12/L2_constraint.jpg" alt="ridge regression" class="wp-image-17060" style="width:595px;height:412px" srcset="../../wp-content/uploads/2022/12/L2_constraint.jpg 762w, ../../wp-content/uploads/2022/12/L2_constraint-300x208.jpg 300w, ../../wp-content/uploads/2022/12/L2_constraint-600x416.jpg 600w" sizes="auto, (max-width: 762px) 100vw, 762px" /></figure>



<p>При регуляризации у нас появляется, по сути, две функции ошибки: основная (синяя), наказывающая за отклонение истинных значений от прогнозных, и дополнительная (оранжевая), наказывающая за отклонение коэффициентов от нуля. Их сумму и будет пытаться минимизировать алгоритм.</p>



<p>Источник картинки и подробности <a href="https://explained.ai/regularization/index.html" target="_blank" rel="noreferrer noopener">здесь</a>⧉.</p>



<h4 class="wp-block-heading" id="13-normalnye-uravneniya">Нормальные уравнения</h4>



<p>Вспомним аналитическое решение задачи линейной регрессии.</p>



<p>$$ \boldsymbol \theta = (\mathbf X^\top \mathbf X)^{-1} \mathbf X^\top \mathbf y $$</p>



<p>В случае нормальных уравнений с L2-регуляризацией оптимальное решение можно найти через</p>



<p>$$ \begin{split} \mathbf 0 =&amp; \: \nabla \frac{1}{2} \Vert \mathbf y-\mathbf X \boldsymbol \theta \Vert^2_2 + \nabla \frac{\lambda}{2} \Vert \boldsymbol \theta \Vert^2_2 \\ =&amp; \: \mathbf X^\top (\mathbf X \boldsymbol \theta-\mathbf y) + \lambda \boldsymbol \theta \\ \boldsymbol \theta =&amp; \: (\mathbf X^\top \mathbf X + \alpha \mathbf I)^{-1} \mathbf X^\top \mathbf y \end{split} $$</p>



<p>$I$ представляет собой единичную матрицу размером $ (d+1) \times (d+1) $ с нулевым значением первого столбца первой строки (сдвиг), где $d$ &#8212; количество признаков.</p>



<p>Что интересно, регуляризация решает проблему вырожденных или необратимых матриц. Матрица будет вырожденной в случае, если количество признаков больше количества объектов и может быть необратима, если оно равно количеству объектов. Выражение $X^\top X + \alpha I $ решает эту проблему.</p>



<p>Напишем собственный класс.</p>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.9.0 -->

		<div id="urvanov-syntax-highlighter-697702667dc8f912540505" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dc8f912540505-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dc8f912540505-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dc8f912540505-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dc8f912540505-4">4</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dc8f912540505-5">5</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dc8f912540505-6">6</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dc8f912540505-7">7</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dc8f912540505-8">8</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dc8f912540505-9">9</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dc8f912540505-10">10</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dc8f912540505-11">11</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dc8f912540505-12">12</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dc8f912540505-13">13</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dc8f912540505-14">14</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dc8f912540505-15">15</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dc8f912540505-16">16</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dc8f912540505-17">17</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dc8f912540505-18">18</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dc8f912540505-19">19</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dc8f912540505-20">20</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dc8f912540505-21">21</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dc8f912540505-22">22</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dc8f912540505-23">23</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dc8f912540505-24">24</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dc8f912540505-1"><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-e">RidgeReg</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dc8f912540505-2"><span class="crayon-h">&nbsp;&nbsp;</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dc8f912540505-3"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">__init__</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">alpha</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1.0</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dc8f912540505-4">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dc8f912540505-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">alpha</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">alpha</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dc8f912540505-6"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">thetas</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">None</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dc8f912540505-7">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dc8f912540505-8"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dc8f912540505-9">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dc8f912540505-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-sy">.</span><span class="crayon-k ">copy</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dc8f912540505-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">add_ones</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dc8f912540505-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">I</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">identity</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dc8f912540505-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">I</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dc8f912540505-14">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dc8f912540505-15"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">thetas</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-v">linalg</span><span class="crayon-sy">.</span><span class="crayon-e">inv</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">.</span><span class="crayon-v">T</span><span class="crayon-sy">.</span><span class="crayon-e">dot</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">alpha</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">I</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">dot</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">.</span><span class="crayon-v">T</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">dot</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dc8f912540505-16">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dc8f912540505-17"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dc8f912540505-18">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dc8f912540505-19"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-sy">.</span><span class="crayon-k ">copy</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dc8f912540505-20"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">add_ones</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dc8f912540505-21"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">dot</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">thetas</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dc8f912540505-22">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dc8f912540505-23"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">add_ones</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dc8f912540505-24"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-v">c_</span><span class="crayon-sy">[</span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">ones</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-k ">len</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-sy">]</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0011 seconds] -->
</div>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.9.0 -->

		<div id="urvanov-syntax-highlighter-697702667dc97663488048" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dc97663488048-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dc97663488048-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dc97663488048-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dc97663488048-4">4</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dc97663488048-5">5</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dc97663488048-6">6</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dc97663488048-7">7</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dc97663488048-8">8</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dc97663488048-9">9</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dc97663488048-1"><span class="crayon-v">ridge</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">RidgeReg</span><span class="crayon-sy">(</span><span class="crayon-v">alpha</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">10</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dc97663488048-2">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dc97663488048-3"><span class="crayon-v">ridge</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">X_train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y_train</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dc97663488048-4">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dc97663488048-5"><span class="crayon-v">y_pred_train</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">ridge</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">X_train</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dc97663488048-6"><span class="crayon-v">y_pred_test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">ridge</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">X_test</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dc97663488048-7">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dc97663488048-8"><span class="crayon-k ">print</span><span class="crayon-sy">(</span><span class="crayon-s">'train: '</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-k ">str</span><span class="crayon-sy">(</span><span class="crayon-e">root_mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">y_train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y_pred_train</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dc97663488048-9"><span class="crayon-k ">print</span><span class="crayon-sy">(</span><span class="crayon-s">'test: '</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-k ">str</span><span class="crayon-sy">(</span><span class="crayon-e">root_mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">y_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y_pred_test</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0004 seconds] -->
</div>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.9.0 -->

		<div id="urvanov-syntax-highlighter-697702667dc99047502683" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dc99047502683-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dc99047502683-2">2</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dc99047502683-1">train: 5.258077962476522</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dc99047502683-2">test: 5.104623428412015</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0000 seconds] -->
</div>



<p>Ошибка на обучающей выборке немного выросла, на тесте немного уменьшилась. Сравним с sklearn.</p>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.9.0 -->

		<div id="urvanov-syntax-highlighter-697702667dc9c818004328" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dc9c818004328-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dc9c818004328-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dc9c818004328-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dc9c818004328-4">4</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dc9c818004328-5">5</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dc9c818004328-6">6</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dc9c818004328-7">7</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dc9c818004328-8">8</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dc9c818004328-9">9</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dc9c818004328-10">10</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dc9c818004328-11">11</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dc9c818004328-1"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">linear_model </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">Ridge</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dc9c818004328-2">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dc9c818004328-3"><span class="crayon-v">ridge</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Ridge</span><span class="crayon-sy">(</span><span class="crayon-v">alpha</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">10</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dc9c818004328-4">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dc9c818004328-5"><span class="crayon-v">ridge</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">X_train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y_train</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dc9c818004328-6">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dc9c818004328-7"><span class="crayon-v">y_pred_train</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">ridge</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">X_train</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dc9c818004328-8"><span class="crayon-v">y_pred_test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">ridge</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">X_test</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dc9c818004328-9">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dc9c818004328-10"><span class="crayon-k ">print</span><span class="crayon-sy">(</span><span class="crayon-s">'train: '</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-k ">str</span><span class="crayon-sy">(</span><span class="crayon-e">root_mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">y_train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y_pred_train</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dc9c818004328-11"><span class="crayon-k ">print</span><span class="crayon-sy">(</span><span class="crayon-s">'test: '</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-k ">str</span><span class="crayon-sy">(</span><span class="crayon-e">root_mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">y_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y_pred_test</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0005 seconds] -->
</div>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.9.0 -->

		<div id="urvanov-syntax-highlighter-697702667dc9f763429642" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dc9f763429642-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dc9f763429642-2">2</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dc9f763429642-1">train: 5.258077962476521</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dc9f763429642-2">test: 5.104623428412015</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0000 seconds] -->
</div>



<p>Выведем изменение коэффициентов на графике.</p>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.9.0 -->

		<div id="urvanov-syntax-highlighter-697702667dca1872132083" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dca1872132083-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dca1872132083-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dca1872132083-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dca1872132083-4">4</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dca1872132083-5">5</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dca1872132083-6">6</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dca1872132083-7">7</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dca1872132083-8">8</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dca1872132083-1"><span class="crayon-v">features</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-e">columns</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dca1872132083-2">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dca1872132083-3"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">figure</span><span class="crayon-sy">(</span><span class="crayon-v">figsize</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">5</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dca1872132083-4"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">features</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ridge</span><span class="crayon-sy">.</span><span class="crayon-v">coef_</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">alpha</span><span class="crayon-o">=</span><span class="crayon-cn">0.7</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">linestyle</span><span class="crayon-o">=</span><span class="crayon-s">'none'</span><span class="crayon-h"> </span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">marker</span><span class="crayon-o">=</span><span class="crayon-s">'*'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">markersize</span><span class="crayon-o">=</span><span class="crayon-cn">5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">color</span><span class="crayon-o">=</span><span class="crayon-s">'red'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">label</span><span class="crayon-o">=</span><span class="crayon-i">r</span><span class="crayon-s">'Ridge; $\alpha = 10$'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">zorder</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">7</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dca1872132083-5"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">features</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ols</span><span class="crayon-sy">.</span><span class="crayon-v">coef_</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">alpha</span><span class="crayon-o">=</span><span class="crayon-cn">0.4</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">linestyle</span><span class="crayon-o">=</span><span class="crayon-s">'none'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">marker</span><span class="crayon-o">=</span><span class="crayon-s">'o'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">markersize</span><span class="crayon-o">=</span><span class="crayon-cn">7</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">color</span><span class="crayon-o">=</span><span class="crayon-s">'green'</span><span class="crayon-sy">,</span><span class="crayon-v">label</span><span class="crayon-o">=</span><span class="crayon-s">'Linear Regression'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dca1872132083-6"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">xticks</span><span class="crayon-sy">(</span><span class="crayon-v">rotation</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dca1872132083-7"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">legend</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dca1872132083-8"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0007 seconds] -->
</div>



<figure class="wp-block-image size-full"><img loading="lazy" decoding="async" width="318" height="303" src="../../wp-content/uploads/2022/12/ridge_coefs.png" alt="изменение коэффициентов в ridge regression" class="wp-image-17066" srcset="../../wp-content/uploads/2022/12/ridge_coefs.png 318w, ../../wp-content/uploads/2022/12/ridge_coefs-300x286.png 300w" sizes="auto, (max-width: 318px) 100vw, 318px" /></figure>



<h4 class="wp-block-heading" id="14-metod-gradientnogo-spuska">Метод градиентного спуска</h4>



<p>Эту же задачу можно решить методом градиентного спуска. Функция потерь в этом случае будет иметь вид</p>



<p>$$&nbsp;J({\theta_j})&nbsp;=&nbsp;\frac{1}{2n}&nbsp;\sum&nbsp;(\mathbf y-\boldsymbol \theta&nbsp;\mathbf X)^2&nbsp;+ \frac{1}{2n} \lambda \boldsymbol \theta^\top \boldsymbol \theta $$</p>



<p>Для градиентного спуска, чтобы не запутаться, обозначим коэффициент скорости обучения через $\alpha,$ а параметр регуляризации через $\lambda.$ При этом градиент будет равен</p>



<p>$$&nbsp;\frac{\partial}{\partial&nbsp;\theta_j}&nbsp;J(\boldsymbol \theta)&nbsp;=&nbsp;\left( -x_j(\mathbf y-\mathbf X \boldsymbol \theta)&nbsp;+ \lambda \boldsymbol \theta&nbsp;\right) \times&nbsp;\frac{1}{n} $$</p>



<p>Нормализовывать сдвиг не обязательно (в первую очередь имеют значения наклоны). Здесь мы это делаем, чтобы упростить код. Перейдем к практике. Начнем с собственного класса.</p>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.9.0 -->

		<div id="urvanov-syntax-highlighter-697702667dca6264199367" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dca6264199367-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dca6264199367-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dca6264199367-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dca6264199367-4">4</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dca6264199367-5">5</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dca6264199367-6">6</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dca6264199367-7">7</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dca6264199367-8">8</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dca6264199367-9">9</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dca6264199367-10">10</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dca6264199367-11">11</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dca6264199367-12">12</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dca6264199367-13">13</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dca6264199367-14">14</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dca6264199367-15">15</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dca6264199367-16">16</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dca6264199367-17">17</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dca6264199367-18">18</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dca6264199367-19">19</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dca6264199367-20">20</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dca6264199367-21">21</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dca6264199367-22">22</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dca6264199367-23">23</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dca6264199367-24">24</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dca6264199367-25">25</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dca6264199367-26">26</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dca6264199367-27">27</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dca6264199367-28">28</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dca6264199367-29">29</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dca6264199367-30">30</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dca6264199367-31">31</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dca6264199367-32">32</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dca6264199367-33">33</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dca6264199367-34">34</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dca6264199367-35">35</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dca6264199367-36">36</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dca6264199367-37">37</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dca6264199367-38">38</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dca6264199367-1"><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-e">RidgeGD</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dca6264199367-2"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">__init__</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">alpha</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.0001</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dca6264199367-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">thetas</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">None</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dca6264199367-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">loss_history</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dca6264199367-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">alpha</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">alpha</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dca6264199367-6">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dca6264199367-7"><span class="crayon-e">&nbsp;&nbsp;</span><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">add_ones</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dca6264199367-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-v">c_</span><span class="crayon-sy">[</span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">ones</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-k ">len</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dca6264199367-9">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dca6264199367-10"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">objective</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">thetas</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dca6264199367-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-k ">sum</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">h</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">thetas</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">alpha</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">dot</span><span class="crayon-sy">(</span><span class="crayon-v">thetas</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">thetas</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">2</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">n</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dca6264199367-12">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dca6264199367-13"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">h</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">thetas</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dca6264199367-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">dot</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">thetas</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dca6264199367-15">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dca6264199367-16"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">gradient</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">thetas</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dca6264199367-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">dot</span><span class="crayon-sy">(</span><span class="crayon-o">-</span><span class="crayon-v">x</span><span class="crayon-sy">.</span><span class="crayon-v">T</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">h</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">thetas</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">alpha</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">thetas</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-i">n</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dca6264199367-18">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dca6264199367-19"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-k ">iter</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">20000</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">learning_rate</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.05</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dca6264199367-20"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-sy">.</span><span class="crayon-k ">copy</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-k ">copy</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dca6264199367-21"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">add_ones</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dca6264199367-22">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dca6264199367-23"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">thetas</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">zeros</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dca6264199367-24">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dca6264199367-25"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">loss_history</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dca6264199367-26">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dca6264199367-27"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-k ">range</span><span class="crayon-sy">(</span><span class="crayon-k ">iter</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dca6264199367-28"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">loss_history</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">objective</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">thetas</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dca6264199367-29"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">grad</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">gradient</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">thetas</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dca6264199367-30"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">thetas</span><span class="crayon-h"> </span><span class="crayon-o">-=</span><span class="crayon-h"> </span><span class="crayon-v">learning_rate</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-e">grad</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dca6264199367-31">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dca6264199367-32"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">thetas</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">thetas</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dca6264199367-33"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">loss_history</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">loss_history</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dca6264199367-34">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dca6264199367-35"><span class="crayon-e">&nbsp;&nbsp;</span><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dca6264199367-36"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-sy">.</span><span class="crayon-k ">copy</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dca6264199367-37"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">add_ones</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dca6264199367-38"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">dot</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">thetas</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0022 seconds] -->
</div>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.9.0 -->

		<div id="urvanov-syntax-highlighter-697702667dca9409672747" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dca9409672747-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dca9409672747-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dca9409672747-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dca9409672747-4">4</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dca9409672747-5">5</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dca9409672747-6">6</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dca9409672747-7">7</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dca9409672747-8">8</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dca9409672747-9">9</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dca9409672747-1"><span class="crayon-v">ridge_gd</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">RidgeGD</span><span class="crayon-sy">(</span><span class="crayon-v">alpha</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.0001</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dca9409672747-2">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dca9409672747-3"><span class="crayon-v">ridge_gd</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">X_train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y_train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-k ">iter</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">50000</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">learning_rate</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.01</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dca9409672747-4">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dca9409672747-5"><span class="crayon-v">y_pred_train</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">ridge_gd</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">X_train</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dca9409672747-6"><span class="crayon-v">y_pred_test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">ridge_gd</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">X_test</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dca9409672747-7">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dca9409672747-8"><span class="crayon-k ">print</span><span class="crayon-sy">(</span><span class="crayon-s">'train: '</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-k ">str</span><span class="crayon-sy">(</span><span class="crayon-e">root_mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">y_train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y_pred_train</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dca9409672747-9"><span class="crayon-k ">print</span><span class="crayon-sy">(</span><span class="crayon-s">'test: '</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-k ">str</span><span class="crayon-sy">(</span><span class="crayon-e">root_mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">y_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y_pred_test</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0005 seconds] -->
</div>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.9.0 -->

		<div id="urvanov-syntax-highlighter-697702667dcab252651432" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dcab252651432-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dcab252651432-2">2</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dcab252651432-1">train: 5.255700309301131</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dcab252651432-2">test: 5.127682311863072</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0000 seconds] -->
</div>



<p>Сравним с sklearn. Для того чтобы оптимизировать Ridge регрессию методом градиентного спуска, используем класс SGDRegressor с параметром penalty = &#8216;l2&#8217;. Кроме того, укажем другие параметры для того, чтобы применяемый алгоритм был максимально близок к написанному вручную коду.</p>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.9.0 -->

		<div id="urvanov-syntax-highlighter-697702667dcb0667668696" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dcb0667668696-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dcb0667668696-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dcb0667668696-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dcb0667668696-4">4</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dcb0667668696-5">5</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dcb0667668696-6">6</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dcb0667668696-7">7</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dcb0667668696-8">8</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dcb0667668696-9">9</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dcb0667668696-10">10</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dcb0667668696-11">11</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dcb0667668696-12">12</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dcb0667668696-13">13</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dcb0667668696-14">14</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dcb0667668696-15">15</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dcb0667668696-16">16</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dcb0667668696-17">17</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dcb0667668696-1"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">linear_model </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">SGDRegressor</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dcb0667668696-2">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dcb0667668696-3"><span class="crayon-v">ridge_gd</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">SGDRegressor</span><span class="crayon-sy">(</span><span class="crayon-v">loss</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'squared_error'</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dcb0667668696-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">penalty</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'l2'</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dcb0667668696-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">alpha</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.0001</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dcb0667668696-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">max_iter</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">50000</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dcb0667668696-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">learning_rate</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'constant'</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dcb0667668696-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">eta0</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.001</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dcb0667668696-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">random_state</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">42</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dcb0667668696-10">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dcb0667668696-11"><span class="crayon-v">ridge_gd</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">X_train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y_train</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dcb0667668696-12">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dcb0667668696-13"><span class="crayon-v">y_pred_train</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">ridge_gd</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">X_train</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dcb0667668696-14"><span class="crayon-v">y_pred_test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">ridge_gd</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">X_test</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dcb0667668696-15">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dcb0667668696-16"><span class="crayon-k ">print</span><span class="crayon-sy">(</span><span class="crayon-s">'train: '</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-k ">str</span><span class="crayon-sy">(</span><span class="crayon-e">root_mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">y_train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y_pred_train</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dcb0667668696-17"><span class="crayon-k ">print</span><span class="crayon-sy">(</span><span class="crayon-s">'test: '</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-k ">str</span><span class="crayon-sy">(</span><span class="crayon-e">root_mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">y_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y_pred_test</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0006 seconds] -->
</div>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.9.0 -->

		<div id="urvanov-syntax-highlighter-697702667dcb2235943174" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dcb2235943174-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dcb2235943174-2">2</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dcb2235943174-1">train: 5.25595467395471</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dcb2235943174-2">test: 5.120506389637218</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0000 seconds] -->
</div>



<h4 class="wp-block-heading" id="15-vybor-alpha">Выбор $\alpha$</h4>



<p>Подобрать оптимальный гиперпараметр регуляризации можно, в частности, с помощью класса RidgeCV, который одновременно выполнит оценку качества модели с помощью перекрестной валидации.</p>



<p>Приведем пример.</p>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.9.0 -->

		<div id="urvanov-syntax-highlighter-697702667dcb5681721211" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dcb5681721211-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dcb5681721211-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dcb5681721211-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dcb5681721211-4">4</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dcb5681721211-5">5</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dcb5681721211-6">6</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dcb5681721211-7">7</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dcb5681721211-8">8</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dcb5681721211-9">9</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dcb5681721211-10">10</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dcb5681721211-1"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">linear_model </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-i">RidgeCV</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dcb5681721211-2">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dcb5681721211-3"><span class="crayon-c"># укажем параметры регуляризации alpha, которые хотим протестировать</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dcb5681721211-4"><span class="crayon-c"># дополнительно укажем количество частей (folds), параметр cv,</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dcb5681721211-5"><span class="crayon-c"># на которое нужно разбить данные при оценке качества модели</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dcb5681721211-6"><span class="crayon-v">ridge_cv</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">RidgeCV</span><span class="crayon-sy">(</span><span class="crayon-v">alphas</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-cn">0.1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1.0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">10</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cv</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">10</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dcb5681721211-7"><span class="crayon-v">ridge_cv</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">X_train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y_train</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dcb5681721211-8">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dcb5681721211-9"><span class="crayon-c"># выведем оптимальный параметр и достигнутое качество</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dcb5681721211-10"><span class="crayon-v">ridge_cv</span><span class="crayon-sy">.</span><span class="crayon-v">alpha_</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ridge_cv</span><span class="crayon-sy">.</span><span class="crayon-v">best_score_</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0004 seconds] -->
</div>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.9.0 -->

		<div id="urvanov-syntax-highlighter-697702667dcb8437338220" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dcb8437338220-1">1</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dcb8437338220-1">(10.0, 0.6482859868459572)</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0000 seconds] -->
</div>



<h3 class="wp-block-heading">Байесовская линейная регрессия</h3>



<p>В обычной линейной регрессии мы стремимся получить точечную оценку (point estimate) параметров $ \boldsymbol \theta $ модели</p>



<p>$$ y = \mathbf x^\top \boldsymbol \theta + \varepsilon, \varepsilon \sim \mathcal{N}(0, \sigma^2), $$</p>



<p>используя аналитическое решение, метод градиентного спуска или метод максимального правдоподобия.</p>



<p>В последнем случае мы выбираем такие $\boldsymbol \theta,$ которые, с учётом имеющихся данных $\mathbf x,$ максимизируют вероятность $y.$</p>



<p>$$ \max P(y \mid \mathbf x, \boldsymbol \theta) $$</p>



<p><strong>Байесовская линейная регрессия</strong> (Bayesian linear regression) позволяет учесть априорное знание о параметрах $\boldsymbol \theta,$ рассматривая каждый параметр не как точечную оценку, а как вероятностное распределение $P(\boldsymbol \theta).$</p>



<p>Апостериорную вероятность параметров можно найти по формуле Байеса.</p>



<p>$$ P(\boldsymbol \theta \mid \mathbf x, y) = \frac{P(y \mid \mathbf x, \boldsymbol \theta) \; P(\boldsymbol \theta)}{P(\mathbf x, y)} $$</p>



<p>Предположим для простоты, что значение каждого из параметров $\theta$ следует нормальному закону с нулевым средним,</p>



<p>$$ P(\boldsymbol \theta) \sim \mathcal{N} (\mathbf 0, \mathbf T), $$</p>



<p>где $\boldsymbol \theta \in \mathbb{R}^d$ и $\mathbf T = \tau \mathbf I_d \in \mathbb{R}^{d \times d} $ для некоторого числа $\tau.$ Правдоподобие <em>всех</em> данных также нормально распределено,</p>



<p>$$ P(\mathbf y \mid \mathbf x, \boldsymbol \theta) \sim \mathcal{N} (\mathbf y \mid \mathbf X \boldsymbol \theta, \sigma^2 \mathbf I), $$</p>



<p>при этом $\mathbf y \in \mathbb{R}^n$ и $\sigma^2 \mathbf I_n \in \mathbb{R}^{n \times n}$ для некоторого числа $\sigma^2.$</p>



<p>Найдем апостериорное распределение $\log P(\boldsymbol \theta \mid \mathbf X, \mathbf y).$</p>



<p>$$ \begin{align} &amp; \propto \: \log P (\mathbf y \mid \mathbf X, \boldsymbol \theta) + \log P(\boldsymbol \theta) \\ &amp; = \: \log \prod^n_{i=1} \frac{1}{\sqrt{2 \pi \sigma^2}} \exp \left( -\frac{(y_i-(\theta_0x_{i0}+\theta_1x_{i1}+\ldots+\theta_d x_{id}))^2}{2\sigma^2} \right) \\ &amp; + \: \log \prod^d_{j=0} \frac{1}{\sqrt{2\pi T_j}} \exp \left( -\frac{\theta_j^2}{2 T_j} \right) \\ &amp; = \: -\sum^n_{i=1} \frac{(y_i-(\theta_0x_{i0}+\theta_1x_{i1}+\ldots+\theta_d x_{id}))^2}{2\sigma^2}-\sum^d_{j=0} \frac{\theta^2_j}{2T_j} + const \\ &amp; = -\frac{1}{2\sigma^2} || \mathbf y-\mathbf X \boldsymbol \theta ||^2_2-\frac{1}{2} \boldsymbol \theta^\top \mathbf T^{-1} \boldsymbol \theta + const \\ &amp; = -\frac{1}{2\sigma^2} (\mathbf y^\top \mathbf y-\mathbf X^\top \mathbf y \boldsymbol \theta-\boldsymbol \theta^\top \mathbf X^\top \mathbf y+\boldsymbol \theta^\top \mathbf X^\top \mathbf X \boldsymbol \theta)-\frac{1}{2} \boldsymbol \theta^T \mathbf T^{-1} \boldsymbol \theta + const \\ &amp; = -\frac{1}{2} \left( \boldsymbol \theta^\top \mathbf T^{-1} \boldsymbol \theta + \frac{1}{\sigma^2} \boldsymbol \theta^\top \mathbf X^\top \mathbf X \boldsymbol \theta-\frac{2}{\sigma^2} \mathbf X^\top \mathbf y \boldsymbol \theta \right) + const \\ &amp; =-\frac{1}{2} \left( \boldsymbol \theta^\top \left( \frac{1}{\sigma^2} \mathbf X^\top \mathbf X + \mathbf T^{-1} \right) \boldsymbol \theta-\frac{2}{\sigma^2} \mathbf X^\top \mathbf y \boldsymbol \theta \right) + const \end{align} $$</p>



<p>Положим $\boldsymbol \Sigma^{-1} = \frac{1}{\sigma^2} \mathbf X^\top \mathbf X + \mathbf T^{-1},$ $\boldsymbol \mu = \frac{1}{\sigma^2} \boldsymbol \Sigma \mathbf X^\top \mathbf y. $ Тогда,</p>



<p>$$ \log P(\boldsymbol \theta \mid \mathbf X, \mathbf y) = -\frac{1}{2} (\boldsymbol \theta-\boldsymbol \mu)^\top \boldsymbol \Sigma^{-1} (\boldsymbol \theta-\boldsymbol \mu) + const $$</p>



<p>Таким образом, апостериорное распределение определяется нормальным законом</p>



<p>$$ \begin{split} P (\boldsymbol \theta \mid \mathbf X, \mathbf y) \sim &amp; \; \mathcal{N}(\boldsymbol \theta \mid \boldsymbol \mu, \boldsymbol \Sigma), \quad \text{где} \\ \boldsymbol \mu = &amp; \; \boldsymbol \Sigma \left( \frac{1}{\sigma^2} \mathbf X^\top \mathbf y \right) \\ \boldsymbol \Sigma = &amp; \; \left( \frac{1}{\sigma^2} \mathbf X^\top \mathbf X + \mathbf T^{-1} \right)^{-1} \end{split} $$</p>



<p>В случае если априорное нормальное распределение имеет среднее $\boldsymbol \mu_0,$ отличное от нуля, то среднее апостериорного нормального распределения можно найти по формуле</p>



<p>$$ \boldsymbol \mu = \boldsymbol \Sigma \left( \mathbf T^{-1} \boldsymbol \mu_0 + \frac{1}{\sigma^2} \mathbf X^\top \mathbf y \right) $$</p>



<p>Интересно, что задача поиска апостериорного максимума (с нормальным априорным распределением и нулевым средним значением)</p>



<p>$$ \underset{\theta}{\operatorname{argmax}} P(\boldsymbol \theta \mid \mathbf X, \mathbf y) = -\frac{1}{2} || \mathbf y-\mathbf X \boldsymbol \theta ||^2_2-\frac{1}{2\tau} \boldsymbol \theta^\top \boldsymbol \theta $$</p>



<p>аналогична, положив $\alpha = \frac{1}{\tau},$ задаче минимизации линейной регрессии с L2 регуляризацией</p>



<p>$$ \begin{split} \underset{\theta}{\operatorname{argmin}} J (\boldsymbol \theta) =&amp; \: \frac{1}{2} || \mathbf y-\mathbf X \boldsymbol \theta ||^2_2+\frac{\alpha}{2} \boldsymbol \theta^\top \boldsymbol \theta \\ =&amp; \: \frac{1}{2} || \mathbf y-\mathbf X \boldsymbol \theta ||^2_2 + \frac{\alpha}{2} \sum^d_{j=0} \theta_j^2 \end{split} $$</p>



<p>с тем отличием, что в данном случае регуляризация также затрагивает сдвиг $\theta_0.$ Остается найти MAP-оценку. Вначале найдем производную.</p>



<p>$$ \begin{split}  \log P(\boldsymbol \theta \mid \mathbf X, \mathbf y) &amp;= -\frac{1}{2}(\mathbf y-\mathbf X \theta)^\top \boldsymbol \Sigma^{-1}(\mathbf y-\mathbf X \boldsymbol \theta)-\frac{1}{2} \boldsymbol  \theta^\top \mathbf T^{-1} \boldsymbol \theta \\ \frac{\partial}{\partial \theta} \log P(\boldsymbol \theta \mid \mathbf X, \mathbf y) &amp;= \mathbf X^\top \boldsymbol \Sigma^{-1}(\mathbf y-\mathbf X \boldsymbol \theta)-\mathbf T^{-1} \boldsymbol \theta \end{split} $$</p>



<p>Приравняв производную к нулю, получим</p>



<p>\begin{split} \hat{ \boldsymbol \theta}_{MAP} &amp;= \left(\mathbf X^\top \boldsymbol \Sigma^{-1} \mathbf X + \mathbf T^{-1} \right)^{-1} \mathbf X^\top \boldsymbol \Sigma^{-1} \mathbf y \\ &amp;= \left( \frac{1}{\sigma^2} \mathbf X^\top \mathbf X + \frac{1}{\tau} \mathbf I \right)^{-1} \frac{1}{\sigma^2} \mathbf X^\top \mathbf y. \end{split}</p>



<p>Приведем код на Питоне.</p>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.9.0 -->

		<div id="urvanov-syntax-highlighter-697702667dcbb266570952" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dcbb266570952-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dcbb266570952-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dcbb266570952-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dcbb266570952-4">4</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dcbb266570952-5">5</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dcbb266570952-6">6</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dcbb266570952-7">7</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dcbb266570952-8">8</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dcbb266570952-9">9</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dcbb266570952-10">10</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dcbb266570952-11">11</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dcbb266570952-12">12</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dcbb266570952-13">13</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dcbb266570952-14">14</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dcbb266570952-15">15</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dcbb266570952-16">16</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dcbb266570952-17">17</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dcbb266570952-18">18</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dcbb266570952-19">19</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dcbb266570952-20">20</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dcbb266570952-21">21</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dcbb266570952-22">22</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dcbb266570952-23">23</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dcbb266570952-24">24</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dcbb266570952-1"><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-v">BayesianRidgeRegression</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dcbb266570952-2">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dcbb266570952-3"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">__init__</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dcbb266570952-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">thetas</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">None</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dcbb266570952-5">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dcbb266570952-6"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">sigma_squared</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">tau</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dcbb266570952-7">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dcbb266570952-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-k ">copy</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dcbb266570952-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">add_ones</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dcbb266570952-10">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dcbb266570952-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">XtX</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">dot</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">T</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">)</span><span class="crayon-o">/</span><span class="crayon-v">sigma</span><span class="crayon-sy">_</span>squared</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dcbb266570952-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">I</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">eye</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-o">/</span><span class="crayon-e">tau</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dcbb266570952-13"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">inverse</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-v">linalg</span><span class="crayon-sy">.</span><span class="crayon-e">inv</span><span class="crayon-sy">(</span><span class="crayon-v">XtX</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">I</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dcbb266570952-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">Xty</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">dot</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">T</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">)</span><span class="crayon-o">/</span><span class="crayon-e">sigma_squared</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dcbb266570952-15"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">thetas</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">dot</span><span class="crayon-sy">(</span><span class="crayon-i">inverse</span><span class="crayon-h"> </span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">Xty</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dcbb266570952-16">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dcbb266570952-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-r">self</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dcbb266570952-18">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dcbb266570952-19"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dcbb266570952-20"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">add_ones</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dcbb266570952-21"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">dot</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">thetas</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dcbb266570952-22">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dcbb266570952-23"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">add_ones</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dcbb266570952-24"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-v">c_</span><span class="crayon-sy">[</span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">ones</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-k ">len</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-sy">]</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0012 seconds] -->
</div>



<p>Оценим $\sigma^2$ <a href="../mlr-add/index.html">методом наименьших квадратов</a>.</p>



<p>$$ \hat{\sigma}^2 = \frac{1}{n} (\mathbf y-\mathbf X\hat{\boldsymbol \theta})^\top (\mathbf y-\mathbf X\hat{\boldsymbol \theta}) $$</p>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.9.0 -->

		<div id="urvanov-syntax-highlighter-697702667dce2033808621" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dce2033808621-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dce2033808621-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dce2033808621-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dce2033808621-4">4</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dce2033808621-5">5</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dce2033808621-6">6</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dce2033808621-7">7</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dce2033808621-8">8</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dce2033808621-9">9</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dce2033808621-10">10</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dce2033808621-11">11</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dce2033808621-12">12</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dce2033808621-1"><span class="crayon-v">ols</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">LinearRegression</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dce2033808621-2"><span class="crayon-v">ols</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">X_train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y_train</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dce2033808621-3">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dce2033808621-4"><span class="crayon-c"># объединим коэффициенты в один вектор</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dce2033808621-5"><span class="crayon-v">thetas</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">insert</span><span class="crayon-sy">(</span><span class="crayon-v">ols</span><span class="crayon-sy">.</span><span class="crayon-v">coef_</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ols</span><span class="crayon-sy">.</span><span class="crayon-v">intercept_</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dce2033808621-6"><span class="crayon-c"># добавим столбец из единиц</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dce2033808621-7"><span class="crayon-v">X_ones</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-v">c_</span><span class="crayon-sy">[</span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">ones</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-k ">len</span><span class="crayon-sy">(</span><span class="crayon-v">X_train</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X_train</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dce2033808621-8"><span class="crayon-c"># найдем остатки модели и</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dce2033808621-9"><span class="crayon-v">error</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">y_train</span><span class="crayon-o">-</span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">dot</span><span class="crayon-sy">(</span><span class="crayon-v">X_ones</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">thetas</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dce2033808621-10"><span class="crayon-c"># среднюю сумму квадратов остатков (MSE)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dce2033808621-11"><span class="crayon-v">sigma_squared</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">dot</span><span class="crayon-sy">(</span><span class="crayon-v">error</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">error</span><span class="crayon-sy">.</span><span class="crayon-v">T</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-o">/</span><span class="crayon-k ">len</span><span class="crayon-sy">(</span><span class="crayon-v">X_ones</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dce2033808621-12"><span class="crayon-v">sigma_squared</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0007 seconds] -->
</div>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.9.0 -->

		<div id="urvanov-syntax-highlighter-697702667dce5398192278" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dce5398192278-1">1</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dce5398192278-1">np.float64(27.622385741142978)</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0000 seconds] -->
</div>



<p>Обучим модель байесовской линейной регрессии.</p>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.9.0 -->

		<div id="urvanov-syntax-highlighter-697702667dce8611598452" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dce8611598452-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dce8611598452-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dce8611598452-3">3</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dce8611598452-1"><span class="crayon-v">tau</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">10</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dce8611598452-2"><span class="crayon-v">br</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">BayesianRidgeRegression</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dce8611598452-3"><span class="crayon-v">y_pred</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">br</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">X_train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y_train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">sigma_squared</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">tau</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">X_test</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0003 seconds] -->
</div>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.9.0 -->

		<div id="urvanov-syntax-highlighter-697702667dcea756899569" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dcea756899569-1">1</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dcea756899569-1"><span class="crayon-e">root_mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">y_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y_pred</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
</div>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.9.0 -->

		<div id="urvanov-syntax-highlighter-697702667dced611973297" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dced611973297-1">1</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dced611973297-1">5.123898119576303</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0000 seconds] -->
</div>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.9.0 -->

		<div id="urvanov-syntax-highlighter-697702667dcef025957200" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dcef025957200-1">1</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dcef025957200-1"><span class="crayon-v">br</span><span class="crayon-sy">.</span><span class="crayon-v">thetas</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-o">:</span><span class="crayon-sy">]</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
</div>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.9.0 -->

		<div id="urvanov-syntax-highlighter-697702667dcf4911297825" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dcf4911297825-1">1</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dcf4911297825-1">array([-4.428,&nbsp;&nbsp;3.212, -1.99 ,&nbsp;&nbsp;0.283])</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0000 seconds] -->
</div>



<p>Сравним с классом BayesianRidge библиотеки sklearn. Особенность реализации этого алгоритма заключается в том, что гиперпараметры $\sigma^2$ и $\tau$ определяются моделью на основе переданных ей данных.</p>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.9.0 -->

		<div id="urvanov-syntax-highlighter-697702667dcf6209169315" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dcf6209169315-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dcf6209169315-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dcf6209169315-3">3</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dcf6209169315-1"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">linear_model </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">BayesianRidge</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dcf6209169315-2"><span class="crayon-v">bayes_ridge</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">BayesianRidge</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dcf6209169315-3"><span class="crayon-v">bayes_ridge</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">X_train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y_train</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0002 seconds] -->
</div>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.9.0 -->

		<div id="urvanov-syntax-highlighter-697702667dcf9334713903" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dcf9334713903-1">1</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dcf9334713903-1"><span class="crayon-v">bayes_ridge</span><span class="crayon-sy">.</span><span class="crayon-v">coef_</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
</div>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.9.0 -->

		<div id="urvanov-syntax-highlighter-697702667dcfc012438726" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dcfc012438726-1">1</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dcfc012438726-1">array([-4.41933248,&nbsp;&nbsp;3.21064175, -1.98855016,&nbsp;&nbsp;0.27704705])</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0000 seconds] -->
</div>



<h3 class="wp-block-heading" id="16-lasso-regression">Lasso Regression</h3>



<p>Регрессия Lasso для регуляризации использует сумму весов по модулю, то есть L1-норму.</p>



<p>$$ J_{Lasso}(\boldsymbol \theta) = MSE + \alpha \cdot || \boldsymbol \theta ||_1 $$</p>



<h4 class="wp-block-heading" id="17-sravnenie-l1-i-l2-regulyarizatsii">Сравнение L1 и L2 регуляризации</h4>



<p>Различие двух подходов заключается в том, что Ridge-регрессия при возведении $\theta$ в квадрат сильнее &#171;наказывает&#187; за большие коэффициенты, Lasso &#171;наказывает&#187; все коэффициенты одинаково. Например, если $\boldsymbol \theta$ равен $ \begin{bmatrix} 10&nbsp;&amp; 5 \end{bmatrix}^\top $, то в случае L2-регрессии penalty составит $ 10^2 + 5^2 = 125 $, а в случае L1, только 15. При увеличении первого коэффициента на единицу L2-penalty составит $ 11^2 + 5^2 = 146 $, L1 увеличится до 16.</p>



<p>Одновременно этот пример показывает особую важность масштабирования признаков при использовании алгоритма с регуляризацией.</p>



<h4 class="wp-block-heading" id="18-obnulenie-koeffitsientov">Обнуление коэффициентов</h4>



<p>L1 регуляризация может полностью обнулить часть коэффициентов и, таким образом, исключить соответствующие признаки из модели. Эта особенность Lasso регрессии называется parameter sparcity.</p>



<h5 class="wp-block-heading" id="19-matematika">Математика</h5>



<p>Вначале рассмотрим модель с L2-регуляризацией с одним признаком и одним коэффициентом $\theta$.</p>



<p>$$ L_2 = (y-x\theta)^2+\alpha\theta^2 = y^2-2xy\theta+x^2\theta^2+\alpha\theta^2 $$</p>



<p>Найдем производную относительно $\theta$, приравняем ее к нулю и решим для $\theta$.</p>



<p>$$ \frac{\partial L_2}{\partial \theta} = -2xy + 2x^2\theta + 2\alpha\theta $$</p>



<p>$$ -2xy + 2x^2\theta + 2\alpha\theta = 0 $$</p>



<p>$$ \theta(x^2 + \alpha ) = xy $$</p>



<p>$$ \theta = \frac{xy}{(x^2 + \alpha)} $$</p>



<p>Коэффициент $\theta$ превратится в ноль для ненулевых значений $x$ и $y$ при $\alpha \rightarrow \inf$. Сравним с L1-регуляризацией. Найдем производную относительно $\theta,$ приравняем к нулю и решим для $\theta$ для случаев $\theta &gt; 0$ (в точке ноль производная функции не определена).</p>



<p>$$ \frac{\partial L_1}{\partial \theta} = -2xy + 2x^2\theta + \alpha $$</p>



<p>$$ -2xy + 2x^2\theta + \alpha = 0 $$</p>



<p>$$ 2x^2\theta = 2xy-\alpha $$</p>



<p>$$ \theta = \frac{2xy-\alpha}{2x^2} $$</p>



<p>Сдалаем то же самое для случая, когда $\theta &lt; 0$.</p>



<p>$$ \frac{\partial L_1}{\partial \theta} = -2xy + 2x^2\theta-\alpha $$</p>



<p>$$ -2xy + 2x^2\theta-\alpha = 0 $$</p>



<p>$$ 2x^2\theta = (\alpha + 2xy) $$</p>



<p>$$ \theta = \frac{\alpha + 2xy}{2x^2} $$</p>



<p>В обоих случаях при определенных $x$, $y$ и $\alpha$ параметр $\theta$ может быть равен нулю.</p>



<p>Дополнительно сравним L2 и L1 нормы двух векторов $ \begin{bmatrix} 1&nbsp;\\ 0 \end{bmatrix} $ и $ \begin{bmatrix} \frac{1}{\sqrt{2}}&nbsp;\\ \frac{1}{\sqrt{2}} \end{bmatrix} $.</p>



<p>В случае L2-нормы, их длина будет равна единице. В случае L1-нормы длина первого вектора будет равна единице, а второго $\sqrt{2} \approx 1,41$. Таким образом, L1 регуляризация не только допускает, но и способствует обнулению коэффициентов.</p>



<h5 class="wp-block-heading" id="20-vizualizatsiya">Визуализация</h5>



<p>Приведем визуализацию границ двух видов регуляризации из книги T. Hastie <em>The Elements of Statistical Learning</em>.</p>



<figure class="wp-block-image size-full is-resized"><img loading="lazy" decoding="async" width="951" height="530" src="../../wp-content/uploads/2022/12/reg_compare.jpg" alt="границы Ridge и Lasso регуляризации" class="wp-image-17058" style="width:650px;height:362px" srcset="../../wp-content/uploads/2022/12/reg_compare.jpg 951w, ../../wp-content/uploads/2022/12/reg_compare-300x167.jpg 300w, ../../wp-content/uploads/2022/12/reg_compare-768x428.jpg 768w, ../../wp-content/uploads/2022/12/reg_compare-600x334.jpg 600w" sizes="auto, (max-width: 951px) 100vw, 951px" /></figure>



<p>Изолинии отображают уровни ошибки при определенных параметрах $\theta$. Синий ромб и круг задают соответственно границу L1 и L2 регуляризации.</p>



<h4 class="wp-block-heading" id="21-koordinatnyy-spusk">Метод координатного спуска</h4>



<p>Как уже было замечено, производная функции абсолютной величины не определена в точке $x = 0$ и, как следствие, мы не можем использовать обычный алгоритм градиентного спуска.</p>



<p>При этом мы можем на каждой итерации двигаться вниз вдоль одной из координат и остановиться, если этот шаг окажется меньше, чем некоторое заданное нами пороговое значение. Такой метод называется <strong>методом координатного спуска</strong> (coordinate descent method).</p>



<p>Приведем иллюстрацию из <a href="https://en.wikipedia.org/wiki/Coordinate_descent" target="_blank" rel="noreferrer noopener">Википедии</a>⧉.</p>



<figure class="wp-block-image size-full is-resized"><img loading="lazy" decoding="async" width="750" height="750" src="../../wp-content/uploads/2022/12/coordinate_descent.png" alt="алгоритм координатного спуска" class="wp-image-17081" style="width:560px;height:560px" srcset="../../wp-content/uploads/2022/12/coordinate_descent.png 750w, ../../wp-content/uploads/2022/12/coordinate_descent-300x300.png 300w, ../../wp-content/uploads/2022/12/coordinate_descent-150x150.png 150w, ../../wp-content/uploads/2022/12/coordinate_descent-600x600.png 600w" sizes="auto, (max-width: 750px) 100vw, 750px" /></figure>



<p>Примечание. Обратим внимание, что в данном случае $x$ и $y$ обозначают веса или коэффициенты, а не данные. Такая нотация принята в литературе по оптимизации.</p>



<p>Выбрать, по какой координате спускаться можно разными способами, в частности, можно:</p>



<ul class="wp-block-list">
<li>выбирать признак (координату) случайным образом; или</li>



<li>просто идти от признака 0 до $j$ (далее признаки мы будем обозначать именно так).</li>
</ul>



<p>Рассмотрим, как координатный спуск выглядит с точки зрения математики.</p>



<h4 class="wp-block-heading" id="22-matematika">Математика</h4>



<p>Итак, напомню, функция потерь будет иметь вид</p>



<p>$$ J_{Lasso}(\boldsymbol \theta) = MSE + \alpha \cdot || \boldsymbol \theta ||_1 $$</p>



<p>Вначале обратимся к первому компоненту, а именно MSE. Вспомним, чему равен градиент MSE.</p>



<p>$$ \frac{\partial J}{\partial \theta_j} = \frac{1}{n} \cdot \left( -x_j(\mathbf y-\mathbf X\boldsymbol \theta) \right) $$</p>



<p>Перепишем $\mathbf y-\mathbf X\boldsymbol \theta$ как $y-(\theta_kX_k+\theta_jx_j)$.</p>



<p>$$ \frac{1}{n} \cdot \left( -x_j(y-(\theta_kX_k+\theta_jx_j)) \right) $$</p>



<p>Другими словами, выделим ту координату $j$ (признак), по которой мы будем спускаться на конкретной итерации. $\theta_kX_k$ &#8212; это прогноз модели без коордианты $j$. Раскроем, а затем реорганизуем скобки.</p>



<p>$$ \frac{1}{n} \cdot \left( -x_j((y-\theta_kX_k)-\theta_jx_j) \right) $$</p>



<p>Умножим $-x_j$ на каждое из слагаемых.</p>



<p>$$ \frac{1}{n} \cdot \left( -x_j(y-\theta_kX_k) + \theta_j x_j^2 \right) $$</p>



<p>Обозначим компоненты через новые переменные $\rho$ (&#171;ро&#187;) и $z$.</p>



<p>$$ \rho_j = x_j(y-\theta_kX_k) $$</p>



<p>Примечание. Минус перед $x_j$ появится в окончательной формуле ниже.</p>



<p>$$ z_j = x_j^2 $$</p>



<p class="has-background" style="background-color:#ffe8c4">Переменная $\rho$ показывает, насколько признак $x_j$ коррелирует с остатками модели $y-\theta_kX_k,$ построенной без $j.$ Если $\rho$ (т.е. корреляция) растет, значит этот признак важен для модели, и его вес стоит увеличить.</p>



<p>Тогда выражение будет иметь вид</p>



<p>$$ \frac{\partial L}{\partial \theta_j} = -\frac{1}{n}\rho_j + \frac{1}{n} \theta_jz_j $$</p>



<p>Приравняв производную к нулю, найдем решение относительно $\theta_j.$</p>



<p>$$ \theta_j = \frac{\rho_j}{z_j} $$</p>



<p>Замечу, что $z_j,$ то есть скалярное произведение вектора признака $x_j$ на самого себя, будет равно единице, если признаки будут предварительно нормализованы (приведены к единичной L2 норме).</p>



<p>Обратимся ко второму компоненту &#8212; слагаемому регуляризации. Так как производная в точке $|\theta_j| = 0$ не определена, воспользуемся таким понятием как <strong>субградиент</strong> (subgradient). По сути, субградиентом является множество возможных градиентов в определенной точке. Приведем иллюстрацию для субградиентов в точке $|\theta_j| = 0$.</p>



<figure class="wp-block-image size-large is-resized"><img loading="lazy" decoding="async" width="1024" height="678" src="../../wp-content/uploads/2023/01/subgradients-1024x678.jpg" alt="субградиенты" class="wp-image-17091" style="width:648px;height:429px" srcset="../../wp-content/uploads/2023/01/subgradients-1024x678.jpg 1024w, ../../wp-content/uploads/2023/01/subgradients-300x199.jpg 300w, ../../wp-content/uploads/2023/01/subgradients-768x509.jpg 768w, ../../wp-content/uploads/2023/01/subgradients-1200x795.jpg 1200w, ../../wp-content/uploads/2023/01/subgradients-600x397.jpg 600w, ../../wp-content/uploads/2023/01/subgradients.jpg 1309w" sizes="auto, (max-width: 1024px) 100vw, 1024px" /></figure>



<p>Как видно, субградиенты могут принимать значения $[-1, 1]$ (градиенты функции абсолютного значения) или вернее от $[-\alpha, \alpha]$, то есть параметра, на который мы умножаем слагаемое регуляризации.</p>



<p>$$ \alpha \frac{\partial |\theta_j|}{\partial \theta_j} = \left\{ \begin{matrix} -\alpha &amp; \text{when } \theta_j &lt; 0 \\ [-\alpha, \alpha] &amp; \text{when } \theta_j = 0 \\ \alpha &amp; \text{when } \theta_j &lt; 0 \end{matrix} \right. ​$$</p>



<p>Объединим две производные.</p>



<p>$$ \frac{\partial L(\theta)}{\partial \theta_j} = -\frac{1}{n} \rho_j + \frac{1}{n} \theta_j z_j + \left\{ \begin{matrix} -\alpha &amp; \text{when } \theta_j &lt; 0 \\ [-\alpha, \alpha] &amp; \text{when } \theta_j = 0 \\ \alpha &amp; \text{when } \theta_j &lt; 0 \end{matrix} \right. ​$$</p>



<p>Рассмотрим каждый из трех случаев по отдельности.</p>



<p><strong>Вариант 1</strong>. $\theta_j &lt; 0$</p>



<p>$$ -\frac{1}{n}\rho_j + \frac{1}{n} \theta_jz_j-\alpha = 0 $$</p>



<p>$$ \theta_j = \frac{\rho_j + n\alpha}{z_j} $$</p>



<p>Для того чтобы $\theta_j &lt; 0$, необходимо чтобы $\rho_j &lt; n\alpha. $</p>



<p><strong>Вариант 2</strong>. $\theta_j = 0$</p>



<p>$$ -\frac{1}{n}\rho_j + \frac{1}{n} \theta_jz_j + [-\alpha, \alpha] = 0 $$</p>



<p>$$ \theta_j = \left[ \frac{\rho_j-n\alpha}{z_j}, \frac{\rho_j + n\alpha}{z_j} \right] $$</p>



<p>Для того чтобы $ \theta_j = 0 $, $ -n\alpha\ \leq \rho_j \leq n\alpha. $</p>



<p><strong>Вариант 3</strong>. $\theta_j &gt; 0$</p>



<p>$$ -\frac{1}{n}\rho_j + \frac{1}{n} \theta_jz_j + \alpha = 0 $$</p>



<p>$$ \theta_j = \frac{\rho_j-n\alpha}{z_j} $$</p>



<p>Для того чтобы $\theta_j &gt; 0$, $\rho_j &gt; n\alpha. $</p>



<p>Сдвиг $\theta_0$ не регуляризуется и изменяется с помощью частной производной MSE (первое слагаемое).</p>



<p>$$ \theta_0 = \frac{\rho_0}{z_0} $$</p>



<p>Таким образом, шаги алгоритма координатного спуска будут следующими:</p>



<p><strong>Шаг 1</strong>. Добавить первый (!) столбец из единиц для коэффициента $\theta_0$. Инициализировать веса $\theta$;</p>



<p><strong>Шаг 2</strong>. Рассчитать $z_j$;</p>



<p>$$&nbsp;z_j&nbsp;=&nbsp;\sum&nbsp;x_j^2 $$</p>



<p><strong>Шаг 3</strong>. Задать начальный максимальный размер шага (max_step) и пороговое значение (tolerance);</p>



<p><strong>Шаг 4</strong>. Пока максимальный размер шага больше порогового значения проходиться в цикле по каждой из координат (признаку), рассчитывать $&nbsp;\rho_j = \sum x_j((y-\theta_kX_k) $ и обновлять вес $\theta$ этого признака в соответствии со следующими правилами.</p>



<p>Если $j = 0,$ то есть речь идет о первом по счету коэффициенте $\theta_0,$ то $\theta_j&nbsp;=&nbsp;\frac{ρ_j}{z_j}.$ В остальных случаях:</p>



<p>$$ \theta_j = \left\{ \begin{array}{ll} \frac{\rho_j + n \alpha}{z_j} &amp; \text{if} &amp; \rho_j &lt; -n \alpha \\ 0 &amp; \text{if} &amp; -n \alpha ≤ \rho_j ≤ n \alpha \\ \frac{\rho_j-n \alpha}{z_j} &amp; \text{if} &amp; \rho_j &gt; n \alpha \end{array} \right. $$</p>



<p>Обратите внимание, если $ -n\alpha\ \leq \rho_j \leq n\alpha $ (то есть корреляция признака очень мала по модулю), то коэффициент будет обнулен и исключен из модели. В двух других случаях (варианты 1 и 3), мы будем увеличивать коэффициент при большом отрицательном $\rho_j$ и уменьшать при большом положительном (т.е. выполнять регуляризацию).</p>



<p>Посмотрим на график ниже.</p>



<figure class="wp-block-image size-large is-resized"><img loading="lazy" decoding="async" width="1024" height="567" src="../../wp-content/uploads/2023/01/comp_MSE_ridge_lasso-1024x567.jpg" alt="сравнение моделей без регуляризации и с Ridge и Lasso регуляризацией" class="wp-image-17103" style="width:798px;height:442px" srcset="../../wp-content/uploads/2023/01/comp_MSE_ridge_lasso-1024x567.jpg 1024w, ../../wp-content/uploads/2023/01/comp_MSE_ridge_lasso-300x166.jpg 300w, ../../wp-content/uploads/2023/01/comp_MSE_ridge_lasso-768x425.jpg 768w, ../../wp-content/uploads/2023/01/comp_MSE_ridge_lasso-1200x664.jpg 1200w, ../../wp-content/uploads/2023/01/comp_MSE_ridge_lasso-600x332.jpg 600w, ../../wp-content/uploads/2023/01/comp_MSE_ridge_lasso.jpg 1239w" sizes="auto, (max-width: 1024px) 100vw, 1024px" /></figure>



<p>Такое ограничение называется мягким порогом (soft thresholding). Для сравнения приведем Ridge регрессию, которая сокращает коэффициенты на всем диапазоне $\theta$, но не приводит их к нулевым значениям.</p>



<h4 class="wp-block-heading" id="23-realizatsiya-na-pitone">Реализация на Питоне</h4>



<p>Объявим вспомогательные функции.</p>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.9.0 -->

		<div id="urvanov-syntax-highlighter-697702667dd00615774803" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd00615774803-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd00615774803-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd00615774803-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd00615774803-4">4</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd00615774803-5">5</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd00615774803-6">6</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd00615774803-7">7</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd00615774803-8">8</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd00615774803-9">9</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd00615774803-10">10</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd00615774803-11">11</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd00615774803-12">12</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd00615774803-13">13</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd00615774803-14">14</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd00615774803-15">15</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd00615774803-16">16</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd00615774803-17">17</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd00615774803-18">18</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd00615774803-19">19</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd00615774803-20">20</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd00615774803-21">21</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd00615774803-22">22</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd00615774803-23">23</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd00615774803-24">24</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd00615774803-25">25</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd00615774803-26">26</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd00615774803-27">27</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd00615774803-1"><span class="crayon-c"># добавим столбец из единиц в матрицу признаков</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd00615774803-2"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">add_ones</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd00615774803-3"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-v">c_</span><span class="crayon-sy">[</span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">ones</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-k ">len</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd00615774803-4">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd00615774803-5"><span class="crayon-c"># объявим функцию гипотезы</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd00615774803-6"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">h</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">theta</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd00615774803-7"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c"># 506 х (4 + 1) на (4 + 1) х 1</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd00615774803-8"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">dot</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">theta</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-c"># 506 x 1</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd00615774803-9">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd00615774803-10"><span class="crayon-c"># рассчитаем rho_j</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd00615774803-11"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">rho</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">theta</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">j</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd00615774803-12"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c"># удалим признак (координату) j из матрицы признаков и вектора весов</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd00615774803-13"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">x_k</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">delete</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">j</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd00615774803-14"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">theta_k</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">delete</span><span class="crayon-sy">(</span><span class="crayon-i">theta</span><span class="crayon-h"> </span><span class="crayon-sy">,</span><span class="crayon-v">j</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd00615774803-15"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c"># сделаем прогноз без j</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd00615774803-16"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">y_pred_k</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">h</span><span class="crayon-sy">(</span><span class="crayon-v">x_k</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">theta_k</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd00615774803-17"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c"># найдем остатки при прогнозе без j</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd00615774803-18"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">residuals_k</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">y_pred</span><span class="crayon-sy">_</span>k</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd00615774803-19"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c"># вычислим rho_j</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd00615774803-20"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">rho_j</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-k ">sum</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">[</span><span class="crayon-o">:</span><span class="crayon-sy">,</span><span class="crayon-v">j</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">residuals_k</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd00615774803-21"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">rho</span><span class="crayon-sy">_</span>j</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd00615774803-22">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd00615774803-23"><span class="crayon-c"># рассчитаем z</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd00615774803-24"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">compute_z</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd00615774803-25"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c"># рассчитаем z (т.е. L2 норму) для каждого столбца (axis = 0)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd00615774803-26"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">z_vector</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-k ">sum</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">axis</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd00615774803-27"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">z_vector</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0010 seconds] -->
</div>



<p>Объявим функцию координатного спуска.</p>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.9.0 -->

		<div id="urvanov-syntax-highlighter-697702667dd10427480034" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd10427480034-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd10427480034-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd10427480034-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd10427480034-4">4</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd10427480034-5">5</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd10427480034-6">6</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd10427480034-7">7</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd10427480034-8">8</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd10427480034-9">9</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd10427480034-10">10</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd10427480034-11">11</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd10427480034-12">12</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd10427480034-13">13</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd10427480034-14">14</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd10427480034-15">15</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd10427480034-16">16</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd10427480034-17">17</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd10427480034-18">18</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd10427480034-19">19</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd10427480034-20">20</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd10427480034-21">21</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd10427480034-22">22</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd10427480034-23">23</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd10427480034-24">24</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd10427480034-25">25</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd10427480034-26">26</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd10427480034-27">27</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd10427480034-28">28</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd10427480034-29">29</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd10427480034-30">30</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd10427480034-31">31</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd10427480034-32">32</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd10427480034-33">33</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd10427480034-34">34</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd10427480034-35">35</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd10427480034-36">36</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd10427480034-37">37</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd10427480034-38">38</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd10427480034-39">39</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd10427480034-40">40</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd10427480034-41">41</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd10427480034-1"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">coordinate_descent</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">alpha</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">tolerance</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.0001</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd10427480034-2">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd10427480034-3"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">add_ones</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd10427480034-4"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">theta</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">zeros</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">dtype</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">float</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd10427480034-5"><span class="crayon-h">&nbsp;&nbsp;</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd10427480034-6"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">z</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">compute_z</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd10427480034-7">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd10427480034-8"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">max_step</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">100.</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd10427480034-9"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">iterations</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd10427480034-10">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd10427480034-11"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c"># tolerance - пороговое значение, если шаг меньше, остановимся</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd10427480034-12"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-st">while</span><span class="crayon-sy">(</span><span class="crayon-v">max_step</span><span class="crayon-h"> </span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-v">tolerance</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd10427480034-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">iterations</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd10427480034-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">old_theta</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-k ">copy</span><span class="crayon-sy">(</span><span class="crayon-v">theta</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd10427480034-15">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd10427480034-16"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c"># поочередно выберем каждый из признаков</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd10427480034-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">j</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-k ">range</span><span class="crayon-sy">(</span><span class="crayon-k ">len</span><span class="crayon-sy">(</span><span class="crayon-v">theta</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd10427480034-18">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd10427480034-19"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c"># рассчитаем rho_j</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd10427480034-20"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">rho_j</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">rho</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">theta</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">j</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd10427480034-21">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd10427480034-22"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c"># пропишем обновление для сдвига (первый по счету коэффициент)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd10427480034-23"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">j</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd10427480034-24"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">theta</span><span class="crayon-sy">[</span><span class="crayon-v">j</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">rho_j</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-v">z</span><span class="crayon-sy">[</span><span class="crayon-v">j</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd10427480034-25"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd10427480034-26"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c"># пропишем обновления для остальных признаков</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd10427480034-27"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">elif</span><span class="crayon-h"> </span><span class="crayon-v">rho_j</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-v">alpha</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-k ">len</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd10427480034-28"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">theta</span><span class="crayon-sy">[</span><span class="crayon-v">j</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">rho_j</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">alpha</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-k ">len</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-v">z</span><span class="crayon-sy">[</span><span class="crayon-v">j</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd10427480034-29">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd10427480034-30"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">elif</span><span class="crayon-h"> </span><span class="crayon-v">rho_j</span><span class="crayon-h"> </span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-v">alpha</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-k ">len</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">and</span><span class="crayon-h"> </span><span class="crayon-v">rho_j</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-h"> </span><span class="crayon-v">alpha</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-k ">len</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd10427480034-31"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">theta</span><span class="crayon-sy">[</span><span class="crayon-v">j</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd10427480034-32">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd10427480034-33"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">elif</span><span class="crayon-h"> </span><span class="crayon-v">rho_j</span><span class="crayon-h"> </span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-v">alpha</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-k ">len</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd10427480034-34"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">theta</span><span class="crayon-sy">[</span><span class="crayon-v">j</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">rho_j</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">alpha</span><span class="crayon-o">*</span><span class="crayon-k ">len</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-v">z</span><span class="crayon-sy">[</span><span class="crayon-v">j</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd10427480034-35">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd10427480034-36"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c"># запишем текущий максимальный для всех координат (!!!) размер шага</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd10427480034-37"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c"># (обратите внимание, код ниже выполняется после цикла for)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd10427480034-38"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">step_sizes</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">abs</span><span class="crayon-sy">(</span><span class="crayon-v">old_theta</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">theta</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd10427480034-39"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">max_step</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">step_sizes</span><span class="crayon-sy">.</span><span class="crayon-k ">max</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd10427480034-40">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd10427480034-41"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">theta</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">iterations</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">max_step</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0015 seconds] -->
</div>



<p>Протестируем алгоритм.</p>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.9.0 -->

		<div id="urvanov-syntax-highlighter-697702667dd15459880818" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd15459880818-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd15459880818-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd15459880818-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd15459880818-4">4</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd15459880818-5">5</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd15459880818-6">6</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd15459880818-7">7</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd15459880818-8">8</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd15459880818-9">9</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd15459880818-1"><span class="crayon-v">theta_opt</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">iterations</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">max_step</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">coordinate_descent</span><span class="crayon-sy">(</span><span class="crayon-v">X_train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y_train</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd15459880818-2"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-v">alpha</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.2</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd15459880818-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-v">tolerance</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.0001</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd15459880818-4">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd15459880818-5"><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">set_printoptions</span><span class="crayon-sy">(</span><span class="crayon-v">precision</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">suppress</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd15459880818-6">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd15459880818-7"><span class="crayon-k ">print</span><span class="crayon-sy">(</span><span class="crayon-s">"Intercept is:"</span><span class="crayon-sy">,</span><span class="crayon-v">theta_opt</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd15459880818-8"><span class="crayon-k ">print</span><span class="crayon-sy">(</span><span class="crayon-s">"\nCoefficients are:\n"</span><span class="crayon-sy">,</span><span class="crayon-v">theta_opt</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-o">:</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd15459880818-9"><span class="crayon-k ">print</span><span class="crayon-sy">(</span><span class="crayon-s">"\nNumber of iterations is:"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">iterations</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0004 seconds] -->
</div>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.9.0 -->

		<div id="urvanov-syntax-highlighter-697702667dd17052272995" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd17052272995-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd17052272995-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd17052272995-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd17052272995-4">4</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd17052272995-5">5</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd17052272995-6">6</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd17052272995-1">Intercept is: 23.01581920903955</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd17052272995-2">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd17052272995-3">Coefficients are:</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd17052272995-4"> [-4.228&nbsp;&nbsp;3.107 -1.811&nbsp;&nbsp;0.&nbsp;&nbsp; ]</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd17052272995-5">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd17052272995-6">Number of iterations is: 11</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0000 seconds] -->
</div>



<p>Мы видим, что модель сочла признак INDUS не имеющим значения для данной модели и обнулила соответствующий коэффициент. Сравним с классом Lasso библиотеки sklearn.</p>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.9.0 -->

		<div id="urvanov-syntax-highlighter-697702667dd1a504368625" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd1a504368625-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd1a504368625-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd1a504368625-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd1a504368625-4">4</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd1a504368625-5">5</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd1a504368625-6">6</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd1a504368625-7">7</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd1a504368625-1"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">linear_model </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">Lasso</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd1a504368625-2"><span class="crayon-v">lasso</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Lasso</span><span class="crayon-sy">(</span><span class="crayon-v">alpha</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">tol</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.0001</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd1a504368625-3"><span class="crayon-v">lasso</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">X_train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y_train</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd1a504368625-4">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd1a504368625-5"><span class="crayon-k ">print</span><span class="crayon-sy">(</span><span class="crayon-s">"sklearn Lasso intercept :"</span><span class="crayon-sy">,</span><span class="crayon-v">lasso</span><span class="crayon-sy">.</span><span class="crayon-v">intercept_</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd1a504368625-6"><span class="crayon-k ">print</span><span class="crayon-sy">(</span><span class="crayon-s">"\nsklearn Lasso coefficients :\n"</span><span class="crayon-sy">,</span><span class="crayon-v">lasso</span><span class="crayon-sy">.</span><span class="crayon-v">coef_</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd1a504368625-7"><span class="crayon-k ">print</span><span class="crayon-sy">(</span><span class="crayon-s">"\nsklearn Lasso number of iterations :"</span><span class="crayon-sy">,</span><span class="crayon-v">lasso</span><span class="crayon-sy">.</span><span class="crayon-v">n_iter_</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0003 seconds] -->
</div>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.9.0 -->

		<div id="urvanov-syntax-highlighter-697702667dd1c941820090" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd1c941820090-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd1c941820090-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd1c941820090-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd1c941820090-4">4</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd1c941820090-5">5</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd1c941820090-6">6</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd1c941820090-1">sklearn Lasso intercept : 23.01581920903955</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd1c941820090-2">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd1c941820090-3">sklearn Lasso coefficients :</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd1c941820090-4"> [-4.228&nbsp;&nbsp;3.107 -1.811&nbsp;&nbsp;0.&nbsp;&nbsp; ]</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd1c941820090-5">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd1c941820090-6">sklearn Lasso number of iterations : 10</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0000 seconds] -->
</div>



<h4 class="wp-block-heading">Байесовская Lasso регрессия</h4>



<p>Выше мы показали, что L2 регуляризация линейной регрессии практически идентична апостериорному распределению $ P(\boldsymbol \theta \mid \mathbf X, \mathbf y) $ с нормальным априорным распределением параметров с нулевым средним значением.</p>



<p>Интересно, что L1 регуляризация аналогична вероятностной модели, в которой априорное распределение параметров подчиняется распределению Лапласа (Laplace distribution).</p>



<p>$$ P(\boldsymbol \theta) \sim Laplace (\mu, b) = \frac{1}{2b} \exp \left( -\frac{\boldsymbol \theta-\mu}{b} \right), \; \mu=0$$</p>



<p>Посмотрим на плотность вероятности.</p>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.9.0 -->

		<div id="urvanov-syntax-highlighter-697702667dd1f765515327" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd1f765515327-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd1f765515327-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd1f765515327-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd1f765515327-4">4</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd1f765515327-5">5</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd1f765515327-6">6</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd1f765515327-7">7</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd1f765515327-8">8</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd1f765515327-9">9</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd1f765515327-10">10</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd1f765515327-11">11</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd1f765515327-12">12</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd1f765515327-1"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-v">scipy</span><span class="crayon-sy">.</span><span class="crayon-e">stats </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">laplace</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd1f765515327-2"><span class="crayon-v">loc_param</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd1f765515327-3"><span class="crayon-v">scale_param</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd1f765515327-4">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd1f765515327-5"><span class="crayon-v">x_values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">linspace</span><span class="crayon-sy">(</span><span class="crayon-o">-</span><span class="crayon-cn">5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd1f765515327-6"><span class="crayon-v">pdf_values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">laplace</span><span class="crayon-sy">.</span><span class="crayon-e">pdf</span><span class="crayon-sy">(</span><span class="crayon-v">x_values</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">loc</span><span class="crayon-o">=</span><span class="crayon-v">loc_param</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">scale</span><span class="crayon-o">=</span><span class="crayon-v">scale_param</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd1f765515327-7">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd1f765515327-8"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">plot</span><span class="crayon-sy">(</span><span class="crayon-v">x_values</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">pdf_values</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd1f765515327-9"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">title</span><span class="crayon-sy">(</span><span class="crayon-s">'Laplace Distribution PDF'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd1f765515327-10"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">xlabel</span><span class="crayon-sy">(</span><span class="crayon-s">'x'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd1f765515327-11"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">ylabel</span><span class="crayon-sy">(</span><span class="crayon-s">'Probability Density'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd1f765515327-12"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0004 seconds] -->
</div>



<figure class="wp-block-image size-full is-resized"><img loading="lazy" decoding="async" width="567" height="455" src="../../wp-content/uploads/2025/06/laplace.png" alt="распределение Лапласа" class="wp-image-40299" style="width:440px;height:auto" srcset="../../wp-content/uploads/2025/06/laplace.png 567w, ../../wp-content/uploads/2025/06/laplace-300x241.png 300w" sizes="auto, (max-width: 567px) 100vw, 567px" /></figure>



<p>Найдем апостериорный максимум $\hat{\boldsymbol \theta}_{MAP}.$</p>



<p>$$ \begin{split} =&amp; \: \underset{\theta}{\operatorname{argmax}} \log P (\mathbf y \mid \mathbf X, \boldsymbol \theta) + \log P(\boldsymbol \theta) \\ =&amp; \: \underset{\theta}{\operatorname{argmax}} \bigg( \log \prod^n_{i=1} \frac{1}{\sqrt{2\pi\sigma^2}} \exp\left( -\frac{(y_i-(\theta_0x_{io}+\theta_1x_{i1}+\ldots+\theta_dx_{id}))^2}{2\sigma^2} \right) \\ &amp;\hspace{2.3cm} + \log\prod^d_{j=0} \frac{1}{2b} \exp\left(-\frac{\theta_j}{b}\right) \bigg) \\ =&amp; \: \underset{\theta}{\operatorname{argmax}} \bigg( -\frac{n}{2}\log(2\pi\sigma^2)-\frac{1}{2\sigma^2} \sum^n_{i=1}(y_i-(\theta_0x_{io}+\theta_1x_{i1}+\ldots+\theta_dx_{id}))^2  \\ &amp;\hspace{2.3cm} + d \log \frac{1}{2b}-\sum^d_{j=0} \frac{|\theta_j|}{b} \bigg) \\ =&amp; \: \underset{\theta}{\operatorname{argmin}} \frac{1}{2\sigma^2} \bigg( \sum^n_{i=1} (y_i-(\theta_0x_{io}+\theta_1x_{i1}+\ldots+\theta_dx_{id}))^2 \\ &amp;\hspace{2.3cm} + \frac{2\sigma^2}{b} \sum{d}{j=0}|\theta_j| \bigg)  \\ =&amp; \: \underset{\theta}{\operatorname{argmin}} \left( \Vert y-\mathbf X\boldsymbol \theta \Vert^2_2+\alpha\Vert\boldsymbol \theta \Vert_1 \right) \end{split} $$</p>



<p>Как и в случае с нормальным априорным распределением, MAP-оценка с априорным распределением Лапласа предполагает регуляризацию сдвига $\theta_0.$</p>



<p>На Питоне байесовскую Lasso регрессию можно реализовать с помощью библиотеки вероятностного программирования (probabilistic programming, PP) <strong>PyMC</strong>.</p>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.9.0 -->

		<div id="urvanov-syntax-highlighter-697702667dd23605108284" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd23605108284-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd23605108284-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd23605108284-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd23605108284-4">4</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd23605108284-5">5</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd23605108284-6">6</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd23605108284-7">7</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd23605108284-8">8</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd23605108284-9">9</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd23605108284-10">10</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd23605108284-11">11</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd23605108284-12">12</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd23605108284-13">13</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd23605108284-14">14</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd23605108284-15">15</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd23605108284-16">16</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd23605108284-17">17</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd23605108284-18">18</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd23605108284-19">19</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd23605108284-20">20</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd23605108284-21">21</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd23605108284-1"><span class="crayon-c"># создадим объект класса Model</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd23605108284-2"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">pm</span><span class="crayon-sy">.</span><span class="crayon-e">Model</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd23605108284-3">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd23605108284-4"><span class="crayon-c"># внутри этого объекта зададим</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd23605108284-5"><span class="crayon-st">with</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd23605108284-6"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c"># априорное нормальное распределение для сдвига и</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd23605108284-7"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">intercept</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">pm</span><span class="crayon-sy">.</span><span class="crayon-e">Normal</span><span class="crayon-sy">(</span><span class="crayon-s">'intercept'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">mu</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">sigma</span><span class="crayon-o">=</span><span class="crayon-cn">10</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd23605108284-8"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c"># априорное распределение Лапласа для остальных коэффициентов</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd23605108284-9"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">thetas</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">pm</span><span class="crayon-sy">.</span><span class="crayon-e">Laplace</span><span class="crayon-sy">(</span><span class="crayon-s">'thetas'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">mu</span><span class="crayon-o">=</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">b</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">shape</span><span class="crayon-o">=</span><span class="crayon-v">X_train</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd23605108284-10">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd23605108284-11"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c"># пропишем линейную модель</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd23605108284-12"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">mu</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">intercept</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">pm</span><span class="crayon-sy">.</span><span class="crayon-k ">math</span><span class="crayon-sy">.</span><span class="crayon-e">dot</span><span class="crayon-sy">(</span><span class="crayon-v">X_train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">thetas</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd23605108284-13">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd23605108284-14"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c"># зададим правдоподобие, в котором</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd23605108284-15"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c"># априорное распределение СКО ошибки следует полнормальному закону</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd23605108284-16"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c"># (случайная величина принимает только положительные значения)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd23605108284-17"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">sigma</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">pm</span><span class="crayon-sy">.</span><span class="crayon-e">HalfNormal</span><span class="crayon-sy">(</span><span class="crayon-s">'sigma'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">sigma</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd23605108284-18"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">likelihood</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">pm</span><span class="crayon-sy">.</span><span class="crayon-e">Normal</span><span class="crayon-sy">(</span><span class="crayon-s">'y_obs'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">mu</span><span class="crayon-o">=</span><span class="crayon-v">mu</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">sigma</span><span class="crayon-o">=</span><span class="crayon-v">sigma</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">observed</span><span class="crayon-o">=</span><span class="crayon-v">y_train</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd23605108284-19">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd23605108284-20"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c"># проведем сэмплирование из апостериорного распределения</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd23605108284-21"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-k ">trace</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">pm</span><span class="crayon-sy">.</span><span class="crayon-e">sample</span><span class="crayon-sy">(</span><span class="crayon-cn">2000</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">tune</span><span class="crayon-o">=</span><span class="crayon-cn">1000</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">chains</span><span class="crayon-o">=</span><span class="crayon-cn">2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cores</span><span class="crayon-o">=</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">random_seed</span><span class="crayon-o">=</span><span class="crayon-cn">42</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0008 seconds] -->
</div>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.9.0 -->

		<div id="urvanov-syntax-highlighter-697702667dd28024742088" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd28024742088-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd28024742088-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd28024742088-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd28024742088-4">4</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd28024742088-1">&nbsp;&nbsp;Progress&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Draws&nbsp;&nbsp; Divergences&nbsp;&nbsp; Step size&nbsp;&nbsp; Grad evals&nbsp;&nbsp; Sampling Speed&nbsp;&nbsp;&nbsp;&nbsp;Elapsed&nbsp;&nbsp; Remaining&nbsp;&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd28024742088-2"> ───────────────────────────────────────────────────────────────────────────────────────────────────────────────── </div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd28024742088-3">&nbsp;&nbsp;━━━━━━━━━━━━━━━━━━━━━━━━&nbsp;&nbsp; 3000&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.66&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1081.45 draws/s&nbsp;&nbsp; 0:00:02&nbsp;&nbsp; 0:00:00&nbsp;&nbsp;&nbsp;&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd28024742088-4">&nbsp;&nbsp;━━━━━━━━━━━━━━━━━━━━━━━━&nbsp;&nbsp; 3000&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.61&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;553.27 draws/s&nbsp;&nbsp;&nbsp;&nbsp;0:00:05&nbsp;&nbsp; 0:00:00&nbsp;&nbsp;&nbsp;&nbsp;</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0000 seconds] -->
</div>



<p>Апостериорное распределение параметров можно посмотреть с помощью библиотеки Arviz.</p>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.9.0 -->

		<div id="urvanov-syntax-highlighter-697702667dd2b162684710" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd2b162684710-1">1</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd2b162684710-1"><span class="crayon-v">az</span><span class="crayon-sy">.</span><span class="crayon-e">summary</span><span class="crayon-sy">(</span><span class="crayon-k ">trace</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">var_names</span><span class="crayon-o">=</span><span class="crayon-sy">[</span><span class="crayon-s">'thetas'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'intercept'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'sigma'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
</div>



<figure class="wp-block-image size-large"><img loading="lazy" decoding="async" width="1024" height="335" src="../../wp-content/uploads/2025/06/arviz_summary-1024x335.png" alt="описание параметров апостериорного распределения" class="wp-image-40346" srcset="../../wp-content/uploads/2025/06/arviz_summary-1024x335.png 1024w, ../../wp-content/uploads/2025/06/arviz_summary-300x98.png 300w, ../../wp-content/uploads/2025/06/arviz_summary-768x252.png 768w, ../../wp-content/uploads/2025/06/arviz_summary-600x197.png 600w, ../../wp-content/uploads/2025/06/arviz_summary.png 1087w" sizes="auto, (max-width: 1024px) 100vw, 1024px" /></figure>



<p>Поясним, что столбец mean содержит матожидание каждого из оцениваемых параметров.</p>



<p>Столбцы hdi_3% и hdi_97% содержат соответственно левую и правую границы 94% <strong>интервала наибольшей плотности</strong> (highest density interval, HDI) апостериорного распределения, т.е. наиболее узкий байесовский доверительный интервал (credible interval), содержащий заданную плотность распределения.</p>



<p>Другими словами, это наименьший интервал, в котором с вероятностью (в данном случае) 94% содержится истинное значение параметра.</p>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.9.0 -->

		<div id="urvanov-syntax-highlighter-697702667dd2e427552297" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd2e427552297-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd2e427552297-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd2e427552297-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd2e427552297-4">4</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd2e427552297-1"><span class="crayon-v">axes</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">az</span><span class="crayon-sy">.</span><span class="crayon-e">plot_trace</span><span class="crayon-sy">(</span><span class="crayon-k ">trace</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd2e427552297-2"><span class="crayon-v">fig</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">gcf</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd2e427552297-3"><span class="crayon-v">fig</span><span class="crayon-sy">.</span><span class="crayon-e">tight_layout</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd2e427552297-4"><span class="crayon-v">plt</span><span class="crayon-sy">.</span><span class="crayon-e">show</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0002 seconds] -->
</div>



<figure class="wp-block-image size-large"><img loading="lazy" decoding="async" width="1024" height="509" src="../../wp-content/uploads/2025/06/arviz_plot-1024x509.png" alt="визуализация апостериорного распределения в библиотеке PyMC" class="wp-image-40349" srcset="../../wp-content/uploads/2025/06/arviz_plot-1024x509.png 1024w, ../../wp-content/uploads/2025/06/arviz_plot-300x149.png 300w, ../../wp-content/uploads/2025/06/arviz_plot-768x381.png 768w, ../../wp-content/uploads/2025/06/arviz_plot-600x298.png 600w, ../../wp-content/uploads/2025/06/arviz_plot.png 1188w" sizes="auto, (max-width: 1024px) 100vw, 1024px" /></figure>



<p>Мы также можем посмотреть граф созданной нами модели.</p>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.9.0 -->

		<div id="urvanov-syntax-highlighter-697702667dd32067167225" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd32067167225-1">1</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd32067167225-1"><span class="crayon-v">pm</span><span class="crayon-sy">.</span><span class="crayon-e">model_to_graphviz</span><span class="crayon-sy">(</span><span class="crayon-v">model</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
</div>



<figure class="wp-block-image size-full is-resized"><img loading="lazy" decoding="async" width="946" height="740" src="../../wp-content/uploads/2025/06/model_graph.png" alt="граф модели в библиотеке PyMC" class="wp-image-40356" style="width:555px;height:auto" srcset="../../wp-content/uploads/2025/06/model_graph.png 946w, ../../wp-content/uploads/2025/06/model_graph-300x235.png 300w, ../../wp-content/uploads/2025/06/model_graph-768x601.png 768w, ../../wp-content/uploads/2025/06/model_graph-600x469.png 600w" sizes="auto, (max-width: 946px) 100vw, 946px" /></figure>



<p>При изучении байесовской Ridge регрессии мы нашли оптимальные $\hat{\boldsymbol \theta}$ с помощью MAP-оценки и после этого получили прогнозные значения для тестовых данных через $\mathbf X_{test} \hat{\boldsymbol \theta}_{MAP}.$</p>



<p>Одновременно, имея апостериорное распределение параметров $\boldsymbol \theta,$ мы могли бы сделать прогноз через <strong>прогнозное апостериорное распределение</strong> (posterior predictive distribution)</p>



<p>$$ P(y&#8217; \mid \mathbf x, y, \mathbf x&#8217;) = \int_{\theta \in \Theta} P(y&#8217; \mid \mathbf x&#8217;, \boldsymbol \theta ) P(\boldsymbol \theta \mid \mathbf x, y) d \boldsymbol \theta $$</p>



<p>то есть распределение новых, еще не знакомых нам данных $\mathbf x&#8217;, y&#8217;.$</p>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.9.0 -->

		<div id="urvanov-syntax-highlighter-697702667dd35043355542" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd35043355542-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd35043355542-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd35043355542-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd35043355542-4">4</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd35043355542-5">5</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd35043355542-6">6</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd35043355542-7">7</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd35043355542-8">8</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd35043355542-9">9</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd35043355542-10">10</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd35043355542-11">11</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd35043355542-1"><span class="crayon-c"># в том же классе</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd35043355542-2"><span class="crayon-st">with</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-o">:</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd35043355542-3"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c"># создадим еще одну линейную модель с уже известным распределением параметров thetas и</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd35043355542-4"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c"># новыми данными X_test</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd35043355542-5"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">new_mu</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">intercept</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">pm</span><span class="crayon-sy">.</span><span class="crayon-k ">math</span><span class="crayon-sy">.</span><span class="crayon-e">dot</span><span class="crayon-sy">(</span><span class="crayon-v">X_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">thetas</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd35043355542-6"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c"># распределение СКО ошибки будет тем же</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd35043355542-7"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">new_sigma</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-i">sigma</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd35043355542-8"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c"># зададим правдоподобие с учетом новых данных y_test и</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd35043355542-9"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">new_likelihood</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">pm</span><span class="crayon-sy">.</span><span class="crayon-e">Normal</span><span class="crayon-sy">(</span><span class="crayon-s">'new_y_obs'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">mu</span><span class="crayon-o">=</span><span class="crayon-v">new_mu</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">sigma</span><span class="crayon-o">=</span><span class="crayon-v">new_sigma</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">observed</span><span class="crayon-o">=</span><span class="crayon-v">y_test</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd35043355542-10"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c"># проведем сэмплирование из апостериорного распределения</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd35043355542-11"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">new_trace</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">pm</span><span class="crayon-sy">.</span><span class="crayon-e">sample_posterior_predictive</span><span class="crayon-sy">(</span><span class="crayon-k ">trace</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0004 seconds] -->
</div>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.9.0 -->

		<div id="urvanov-syntax-highlighter-697702667dd37290584034" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd37290584034-1">1</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd37290584034-1">Sampling ... ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 100% 0:00:00 / 0:00:01</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0000 seconds] -->
</div>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.9.0 -->

		<div id="urvanov-syntax-highlighter-697702667dd3c490225504" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd3c490225504-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd3c490225504-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd3c490225504-3">3</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd3c490225504-1"><span class="crayon-c"># для каждого наблюдения мы сформировали апостериорное прогнозное распределение,</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd3c490225504-2"><span class="crayon-c"># матожидание каждого из этих распределений и будет прогнозным значением</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd3c490225504-3"><span class="crayon-v">y_pred</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">new_trace</span><span class="crayon-sy">.</span><span class="crayon-v">posterior_predictive</span><span class="crayon-sy">[</span><span class="crayon-s">'new_y_obs'</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-e">mean</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-s">'chain'</span><span class="crayon-sy">,</span><span class="crayon-s">'draw'</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
</div>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.9.0 -->

		<div id="urvanov-syntax-highlighter-697702667dd3e798578198" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd3e798578198-1">1</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd3e798578198-1"><span class="crayon-e">root_mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">y_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y_pred</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
</div>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.9.0 -->

		<div id="urvanov-syntax-highlighter-697702667dd41838519833" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd41838519833-1">1</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd41838519833-1">5.109150145191861</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0000 seconds] -->
</div>



<p>Подробное рассмотрение библиотеки PyMC выходит за рамки этого занятия, однако заметим, что аналогичным образом мы могли бы задать модель байесовской Ridge регрессии, изменив априорное распределение $\boldsymbol \theta.$</p>



<h3 class="wp-block-heading" id="24-elastic-net-regression">Elastic Net Regression</h3>



<p>Регрессия Elastic Net использует как L1, так и L2 регуляризацию.</p>



<p>$$ J_{ElasticNet}(\boldsymbol \theta) = MSE + \alpha_1 \cdot || \boldsymbol \theta ||_1 + \alpha_2 \cdot || \boldsymbol \theta ||_2^2 $$</p>



<p>Так как в этой модели есть компонент L1, для которого в точке $|\theta_j| = 0$ производная не определена, используем один из возможных субградиентов, а именно нулевой субградиент (красная пунктирная линия $g_3$ на рисунке выше).</p>



<p>Другими словами, субградиент для компонента будет выглядеть следующим образом</p>



<p>$$ \frac{\partial J_{L1}}{\partial_{sub} \theta} = \left\{ \begin{matrix} 1 &amp; \text{if } \theta &gt; 0 \\ 0 &amp; \text{if } \theta = 0 \\ -1 &amp; \text{if } \theta &lt; 0 \end{matrix} \right. ​$$</p>



<p>Это условие соответствует сигнум-функции или функции знака (<a href="https://en.wikipedia.org/wiki/Sign_function" target="_blank" rel="noreferrer noopener">sign function</a>⧉). На Питоне можно использовать <strong>np.sign()</strong>.</p>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.9.0 -->

		<div id="urvanov-syntax-highlighter-697702667dd43793565724" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd43793565724-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd43793565724-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd43793565724-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd43793565724-4">4</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd43793565724-5">5</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd43793565724-6">6</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd43793565724-7">7</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd43793565724-8">8</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd43793565724-9">9</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd43793565724-10">10</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd43793565724-11">11</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd43793565724-12">12</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd43793565724-13">13</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd43793565724-14">14</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd43793565724-15">15</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd43793565724-16">16</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd43793565724-17">17</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd43793565724-18">18</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd43793565724-19">19</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd43793565724-20">20</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd43793565724-21">21</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd43793565724-22">22</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd43793565724-23">23</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd43793565724-24">24</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd43793565724-25">25</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd43793565724-26">26</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd43793565724-27">27</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd43793565724-28">28</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd43793565724-29">29</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd43793565724-30">30</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd43793565724-31">31</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd43793565724-32">32</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd43793565724-33">33</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd43793565724-34">34</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd43793565724-35">35</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd43793565724-36">36</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd43793565724-37">37</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd43793565724-38">38</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd43793565724-39">39</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd43793565724-1"><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-e">ElasticNet</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd43793565724-2"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">__init__</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">a1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">a2</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd43793565724-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">thetas</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">None</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd43793565724-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">loss_history</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd43793565724-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">a1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">a1</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd43793565724-6"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">a2</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">a2</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd43793565724-7">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd43793565724-8"><span class="crayon-e">&nbsp;&nbsp;</span><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">add_ones</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd43793565724-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-v">c_</span><span class="crayon-sy">[</span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">ones</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-k ">len</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd43793565724-10">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd43793565724-11"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">objective</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">thetas</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd43793565724-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-k ">sum</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">h</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">thetas</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">a1</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-k ">sum</span><span class="crayon-sy">(</span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-k ">abs</span><span class="crayon-sy">(</span><span class="crayon-v">thetas</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">a2</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">dot</span><span class="crayon-sy">(</span><span class="crayon-v">thetas</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">thetas</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">2</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">n</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd43793565724-13">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd43793565724-14"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">h</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">thetas</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd43793565724-15"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">dot</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">thetas</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd43793565724-16">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd43793565724-17"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">gradient</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">thetas</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd43793565724-18"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">dot</span><span class="crayon-sy">(</span><span class="crayon-o">-</span><span class="crayon-v">x</span><span class="crayon-sy">.</span><span class="crayon-v">T</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">h</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">thetas</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">a1</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">sign</span><span class="crayon-sy">(</span><span class="crayon-v">thetas</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">a2</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">thetas</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-i">n</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd43793565724-19">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd43793565724-20"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-k ">iter</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">20000</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">learning_rate</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.05</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd43793565724-21"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-sy">.</span><span class="crayon-k ">copy</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-k ">copy</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd43793565724-22"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">add_ones</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd43793565724-23">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd43793565724-24"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">thetas</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">zeros</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd43793565724-25">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd43793565724-26"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">loss_history</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd43793565724-27">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd43793565724-28"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-k ">range</span><span class="crayon-sy">(</span><span class="crayon-k ">iter</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd43793565724-29"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">loss_history</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">objective</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">thetas</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd43793565724-30"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">grad</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">gradient</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">thetas</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd43793565724-31"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">thetas</span><span class="crayon-h"> </span><span class="crayon-o">-=</span><span class="crayon-h"> </span><span class="crayon-v">learning_rate</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-e">grad</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd43793565724-32">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd43793565724-33"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">thetas</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">thetas</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd43793565724-34"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">loss_history</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">loss_history</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd43793565724-35">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd43793565724-36"><span class="crayon-e">&nbsp;&nbsp;</span><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd43793565724-37"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-sy">.</span><span class="crayon-k ">copy</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd43793565724-38"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">add_ones</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd43793565724-39"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">dot</span><span class="crayon-sy">(</span><span class="crayon-v">x</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">thetas</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0025 seconds] -->
</div>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.9.0 -->

		<div id="urvanov-syntax-highlighter-697702667dd46518248549" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd46518248549-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd46518248549-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd46518248549-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd46518248549-4">4</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd46518248549-5">5</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd46518248549-6">6</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd46518248549-7">7</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd46518248549-8">8</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd46518248549-9">9</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd46518248549-1"><span class="crayon-v">elastic</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">ElasticNet</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd46518248549-2">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd46518248549-3"><span class="crayon-v">elastic</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">X_train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y_train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-k ">iter</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">50000</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">learning_rate</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.01</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd46518248549-4">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd46518248549-5"><span class="crayon-v">y_pred_train</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">elastic</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">X_train</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd46518248549-6"><span class="crayon-v">y_pred_test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">elastic</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">X_test</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd46518248549-7">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd46518248549-8"><span class="crayon-k ">print</span><span class="crayon-sy">(</span><span class="crayon-s">'train: '</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-k ">str</span><span class="crayon-sy">(</span><span class="crayon-e">root_mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">y_train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y_pred_train</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd46518248549-9"><span class="crayon-k ">print</span><span class="crayon-sy">(</span><span class="crayon-s">'test: '</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-k ">str</span><span class="crayon-sy">(</span><span class="crayon-e">root_mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">y_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y_pred_test</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0004 seconds] -->
</div>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.9.0 -->

		<div id="urvanov-syntax-highlighter-697702667dd4b010041408" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd4b010041408-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd4b010041408-2">2</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd4b010041408-1">train: 5.255705191138267</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd4b010041408-2">test: 5.127348870379186</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0000 seconds] -->
</div>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.9.0 -->

		<div id="urvanov-syntax-highlighter-697702667dd4d005757786" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd4d005757786-1">1</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd4d005757786-1"><span class="crayon-v">elastic</span><span class="crayon-sy">.</span><span class="crayon-v">thetas</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
</div>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.9.0 -->

		<div id="urvanov-syntax-highlighter-697702667dd50468365896" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd50468365896-1">1</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd50468365896-1">array([23.009, -4.473,&nbsp;&nbsp;3.219, -1.998,&nbsp;&nbsp;0.317])</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0000 seconds] -->
</div>



<p>Сравним с классом ElasticNet библиотеки sklearn.</p>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.9.0 -->

		<div id="urvanov-syntax-highlighter-697702667dd52333044703" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd52333044703-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd52333044703-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd52333044703-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd52333044703-4">4</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd52333044703-5">5</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd52333044703-6">6</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd52333044703-7">7</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd52333044703-8">8</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd52333044703-9">9</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd52333044703-10">10</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd52333044703-11">11</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd52333044703-12">12</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd52333044703-1"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">linear_model </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">ElasticNet</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd52333044703-2">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd52333044703-3"><span class="crayon-v">elastic</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">ElasticNet</span><span class="crayon-sy">(</span><span class="crayon-v">alpha</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.05</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd52333044703-4"><span class="crayon-v">elastic</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">X_train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y_train</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd52333044703-5">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd52333044703-6"><span class="crayon-v">elastic</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">X_train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y_train</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd52333044703-7">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd52333044703-8"><span class="crayon-v">y_pred_train</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">elastic</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">X_train</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd52333044703-9"><span class="crayon-v">y_pred_test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">elastic</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">X_test</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd52333044703-10">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd52333044703-11"><span class="crayon-k ">print</span><span class="crayon-sy">(</span><span class="crayon-s">'train: '</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-k ">str</span><span class="crayon-sy">(</span><span class="crayon-e">root_mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">y_train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y_pred_train</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd52333044703-12"><span class="crayon-k ">print</span><span class="crayon-sy">(</span><span class="crayon-s">'test: '</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-k ">str</span><span class="crayon-sy">(</span><span class="crayon-e">root_mean_squared_error</span><span class="crayon-sy">(</span><span class="crayon-v">y_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y_pred_test</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0005 seconds] -->
</div>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.9.0 -->

		<div id="urvanov-syntax-highlighter-697702667dd55652709563" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd55652709563-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd55652709563-2">2</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd55652709563-1">train: 5.259317264886122</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd55652709563-2">test: 5.100827371724984</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0000 seconds] -->
</div>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.9.0 -->

		<div id="urvanov-syntax-highlighter-697702667dd57631522921" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd57631522921-1">1</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd57631522921-1"><span class="crayon-v">elastic</span><span class="crayon-sy">.</span><span class="crayon-v">intercept_</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">elastic</span><span class="crayon-sy">.</span><span class="crayon-v">coef_</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
</div>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.9.0 -->

		<div id="urvanov-syntax-highlighter-697702667dd5a356289622" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd5a356289622-1">1</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd5a356289622-1">(23.01581920903955, array([-4.287,&nbsp;&nbsp;3.179, -1.944,&nbsp;&nbsp;0.146]))</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0000 seconds] -->
</div>



<p>Замечу, что класс ElasticNet библиотеки sklearn использует координатный спуск для минимизации функции потерь. Кроме того, в документации можно посмотреть, как единственный параметр $\alpha$ регулирует значимость L1 и L2 компонентов.</p>



<h2 class="wp-block-heading" id="25-regulyarizatsiya-neyroseti">Регуляризация нейросети</h2>



<p>В качестве иллюстрации приведем примеры L2 регуляризации нейронной сети. Реализуем эту модель на основе <a href="../neural/index.html">уже созданного алгоритма</a> бинарной классификации со смещением с двумя признаками и одним скрытым слоем (три нейрона) и сравним результаты обучения.</p>



<h3 class="wp-block-heading" id="26-funktsiya-poter-s-regulyarizatsiey">Функция потерь с регуляризацией</h3>



<p>Посмотрим на функцию потерь с учетом регуляризации (бинарная классификация)</p>



<p>$$ J(W) = J_{\text{nn}}(W) + J_{\text{reg}} (W) = $$</p>



<p>$$ -\frac{1}{n} \sum y \cdot log(a^{(L)}) + (1-y) \cdot log(1-a^{(L)}) + $$</p>



<p>$$ + \frac{\lambda}{2n} \sum \sum \sum W^{(l)2} $$</p>



<p>Мы находим уровень ошибки на основе значений выходного слоя $a^{(L)}$. Кроме того, мы добавляем значение регуляризации, которое рассчитывается как сумма сумм весов слоев (1) и (2) и контролируется коэффициентом $\lambda.$</p>



<p>Приведем код.</p>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.9.0 -->

		<div id="urvanov-syntax-highlighter-697702667dd5c573094502" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd5c573094502-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd5c573094502-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd5c573094502-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd5c573094502-4">4</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd5c573094502-5">5</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd5c573094502-6">6</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd5c573094502-7">7</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd5c573094502-8">8</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd5c573094502-9">9</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd5c573094502-10">10</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd5c573094502-11">11</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd5c573094502-1"><span class="crayon-c"># в коде обозначим коэффициент lambda как reg</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd5c573094502-2"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">objective</span><span class="crayon-sy">(</span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y_pred</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">reg</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd5c573094502-3">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd5c573094502-4"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">y_one_loss</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">log</span><span class="crayon-sy">(</span><span class="crayon-v">y_pred</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1e</span><span class="crayon-o">-</span><span class="crayon-cn">9</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd5c573094502-5"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">y_zero_loss</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">log</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">y_pred</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">1e</span><span class="crayon-o">-</span><span class="crayon-cn">9</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd5c573094502-6"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">log_loss</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-k ">sum</span><span class="crayon-sy">(</span><span class="crayon-v">y_zero_loss</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">y_one_loss</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-i">n</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd5c573094502-7">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd5c573094502-8"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c"># по умолчанию np.sum() складывает по всем измерениям</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd5c573094502-9"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">reg_loss</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-k ">sum</span><span class="crayon-sy">(</span><span class="crayon-v">W1</span><span class="crayon-o">*</span><span class="crayon-o">*</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-k ">sum</span><span class="crayon-sy">(</span><span class="crayon-v">W2</span><span class="crayon-o">*</span><span class="crayon-o">*</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">reg</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">2</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">n</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd5c573094502-10">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd5c573094502-11"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">log_loss</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">reg_loss</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0007 seconds] -->
</div>



<p>Градиент компонента регуляризации для слоя $l$ будет иметь вид</p>



<p>$$ \frac{ \partial J_{\text{reg}} }{ \partial W^{(l)} } \left( \frac{\lambda}{2n} W^{(l)2} \right) = \frac{\lambda}{n} W^{(l)}, $$</p>



<p>и обновление будет происходить согласно</p>



<p>$$ W^{(l)} := W^{(l)}-\frac{\alpha}{n} \left( \frac{\partial J_{\text{nn}} }{\partial W^{(l)}} + \lambda \frac{\partial J_{\text{reg}} }{\partial W^{(l)}} \right), $$</p>



<p>где $\alpha$ &#8212; коэффициент скорости обучения и $\lambda$ &#8212; коэффициент регуляризации. Регуляризация смещения не проводится.</p>



<h3 class="wp-block-heading" id="27-podgotovka-dannykh">Подготовка данных</h3>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.9.0 -->

		<div id="urvanov-syntax-highlighter-697702667dd62183716389" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd62183716389-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd62183716389-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd62183716389-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd62183716389-4">4</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd62183716389-5">5</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd62183716389-6">6</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd62183716389-7">7</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd62183716389-8">8</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd62183716389-9">9</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd62183716389-10">10</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd62183716389-11">11</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd62183716389-12">12</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd62183716389-13">13</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd62183716389-14">14</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd62183716389-15">15</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd62183716389-1"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-e">sklearn </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">datasets</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd62183716389-2"><span class="crayon-v">data</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">datasets</span><span class="crayon-sy">.</span><span class="crayon-e">load_wine</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd62183716389-3">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd62183716389-4"><span class="crayon-v">df</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">pd</span><span class="crayon-sy">.</span><span class="crayon-e">DataFrame</span><span class="crayon-sy">(</span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-v">data</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">columns</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-v">feature_names</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd62183716389-5"><span class="crayon-v">df</span><span class="crayon-sy">[</span><span class="crayon-s">'target'</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-sy">.</span><span class="crayon-e">target</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd62183716389-6">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd62183716389-7"><span class="crayon-v">df</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">df</span><span class="crayon-sy">[</span><span class="crayon-v">df</span><span class="crayon-sy">.</span><span class="crayon-v">target</span><span class="crayon-h"> </span><span class="crayon-o">!=</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd62183716389-8">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd62183716389-9"><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">df</span><span class="crayon-sy">[</span><span class="crayon-sy">[</span><span class="crayon-s">'alcohol'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'proline'</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd62183716389-10"><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">df</span><span class="crayon-sy">[</span><span class="crayon-s">'target'</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd62183716389-11">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd62183716389-12"><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-e">mean</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-e">std</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd62183716389-13">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd62183716389-14"><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-e">to_numpy</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-i">T</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd62183716389-15"><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-e">to_numpy</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">reshape</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0007 seconds] -->
</div>



<h3 class="wp-block-heading" id="28-obuchenie-modeli">Обучение модели</h3>



<p>Обучим модель.</p>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.9.0 -->

		<div id="urvanov-syntax-highlighter-697702667dd66257898778" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd66257898778-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd66257898778-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd66257898778-3">3</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd66257898778-1"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">sigmoid</span><span class="crayon-sy">(</span><span class="crayon-v">z</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd66257898778-2"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">s</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">exp</span><span class="crayon-sy">(</span><span class="crayon-o">-</span><span class="crayon-v">z</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd66257898778-3"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">s</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0002 seconds] -->
</div>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.9.0 -->

		<div id="urvanov-syntax-highlighter-697702667dd69473942603" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd69473942603-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd69473942603-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd69473942603-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd69473942603-4">4</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd69473942603-5">5</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd69473942603-6">6</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd69473942603-7">7</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd69473942603-8">8</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd69473942603-9">9</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd69473942603-10">10</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd69473942603-11">11</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd69473942603-12">12</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd69473942603-13">13</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd69473942603-14">14</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd69473942603-15">15</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd69473942603-16">16</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd69473942603-17">17</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd69473942603-18">18</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd69473942603-19">19</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd69473942603-20">20</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd69473942603-21">21</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd69473942603-22">22</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd69473942603-23">23</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd69473942603-24">24</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd69473942603-25">25</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd69473942603-26">26</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd69473942603-27">27</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd69473942603-28">28</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd69473942603-29">29</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd69473942603-30">30</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd69473942603-31">31</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd69473942603-32">32</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd69473942603-33">33</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd69473942603-34">34</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd69473942603-35">35</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd69473942603-36">36</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd69473942603-37">37</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd69473942603-38">38</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd69473942603-39">39</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd69473942603-40">40</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd69473942603-41">41</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd69473942603-42">42</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd69473942603-43">43</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd69473942603-44">44</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd69473942603-45">45</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd69473942603-46">46</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd69473942603-47">47</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd69473942603-48">48</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd69473942603-49">49</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd69473942603-50">50</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd69473942603-51">51</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd69473942603-1"><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-k ">random</span><span class="crayon-sy">.</span><span class="crayon-e">seed</span><span class="crayon-sy">(</span><span class="crayon-cn">33</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd69473942603-2">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd69473942603-3"><span class="crayon-v">W1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-k ">random</span><span class="crayon-sy">.</span><span class="crayon-e">randn</span><span class="crayon-sy">(</span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">2</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd69473942603-4"><span class="crayon-v">b1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">zeros</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd69473942603-5">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd69473942603-6"><span class="crayon-v">W2</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-k ">random</span><span class="crayon-sy">.</span><span class="crayon-e">randn</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">3</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd69473942603-7"><span class="crayon-v">b2</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">zeros</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd69473942603-8">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd69473942603-9"><span class="crayon-v">n</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">shape</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd69473942603-10">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd69473942603-11"><span class="crayon-v">epochs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">100000</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd69473942603-12"><span class="crayon-v">learning_rate</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.1</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd69473942603-13"><span class="crayon-v">reg</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.01</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd69473942603-14">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd69473942603-15"><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-k ">range</span><span class="crayon-sy">(</span><span class="crayon-v">epochs</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd69473942603-16"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c"># 3 х 2 на 2 х 130</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd69473942603-17"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">Z1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">dot</span><span class="crayon-sy">(</span><span class="crayon-v">W1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-e">b1</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd69473942603-18"><span class="crayon-e">&nbsp;&nbsp;</span><span class="crayon-v">A1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sigmoid</span><span class="crayon-sy">(</span><span class="crayon-v">Z1</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-c"># (3 x 130)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd69473942603-19">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd69473942603-20"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c"># 1 х 3 на 3 х 130</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd69473942603-21"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">Z2</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">dot</span><span class="crayon-sy">(</span><span class="crayon-v">W2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">A1</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-e">b2</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd69473942603-22"><span class="crayon-e">&nbsp;&nbsp;</span><span class="crayon-v">A2</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sigmoid</span><span class="crayon-sy">(</span><span class="crayon-v">Z2</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-c"># (1 x 130)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd69473942603-23">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd69473942603-24"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">loss</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">objective</span><span class="crayon-sy">(</span><span class="crayon-v">A2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">reg</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd69473942603-25">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd69473942603-26"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">W2_delta</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">A2</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-i">y</span><span class="crayon-h"> </span><span class="crayon-c"># (1 x 130)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd69473942603-27"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">W1_delta</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">dot</span><span class="crayon-sy">(</span><span class="crayon-v">W2</span><span class="crayon-sy">.</span><span class="crayon-v">T</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">W2_delta</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">A1</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">A1</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-c"># (3 x 130)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd69473942603-28">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd69473942603-29"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c"># 1 х 130 на 130 х 3</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd69473942603-30"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c"># значение градиента с учетом регуляризации</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd69473942603-31"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">W2_derivative</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">dot</span><span class="crayon-sy">(</span><span class="crayon-v">W2_delta</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">A1</span><span class="crayon-sy">.</span><span class="crayon-v">T</span><span class="crayon-sy">)</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">reg</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">W2</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-i">n</span><span class="crayon-h"> </span><span class="crayon-c"># (1 x 3)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd69473942603-32"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">b2_derivative</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-k ">sum</span><span class="crayon-sy">(</span><span class="crayon-v">W2_delta</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">axis</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">keepdims</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-i">n</span><span class="crayon-h"> </span><span class="crayon-c"># (1 x 1)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd69473942603-33">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd69473942603-34"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c"># 3 х 130 на 130 х 2</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd69473942603-35"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c"># значение градиента с учетом регуляризации</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd69473942603-36"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">W1_derivative</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">dot</span><span class="crayon-sy">(</span><span class="crayon-v">W1_delta</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">T</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">reg</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-v">W1</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-i">n</span><span class="crayon-h"> </span><span class="crayon-c"># (3 x 2)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd69473942603-37"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">b1_derivative</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-k ">sum</span><span class="crayon-sy">(</span><span class="crayon-v">W1_delta</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">axis</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">keepdims</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-i">n</span><span class="crayon-h"> </span><span class="crayon-c"># (3 x 1)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd69473942603-38">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd69473942603-39"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">W2</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">W2</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">learning_rate</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-e">W2_derivative</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd69473942603-40"><span class="crayon-e">&nbsp;&nbsp;</span><span class="crayon-v">b2</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">b2</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">learning_rate</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-e">b2_derivative</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd69473942603-41"><span class="crayon-e">&nbsp;&nbsp;</span><span class="crayon-v">W1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">W1</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">learning_rate</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-e">W1_derivative</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd69473942603-42"><span class="crayon-e">&nbsp;&nbsp;</span><span class="crayon-v">b1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">b1</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-v">learning_rate</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-e">b1_derivative</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd69473942603-43">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd69473942603-44"><span class="crayon-e">&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">epochs</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-h"> </span><span class="crayon-cn">5</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-o">:</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd69473942603-45"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k ">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Эпоха:'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd69473942603-46"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k ">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Ошибка:'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">loss</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd69473942603-47"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k ">print</span><span class="crayon-sy">(</span><span class="crayon-s">'-----------------------'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd69473942603-48"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k ">time</span><span class="crayon-sy">.</span><span class="crayon-e">sleep</span><span class="crayon-sy">(</span><span class="crayon-cn">0.5</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd69473942603-49">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd69473942603-50"><span class="crayon-k ">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Итоговая ошибка'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">loss</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd69473942603-51"><span class="crayon-k ">print</span><span class="crayon-sy">(</span><span class="crayon-s">'Нейросеть успешно обучена'</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0023 seconds] -->
</div>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.9.0 -->

		<div id="urvanov-syntax-highlighter-697702667dd6c566702788" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd6c566702788-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd6c566702788-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd6c566702788-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd6c566702788-4">4</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd6c566702788-5">5</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd6c566702788-6">6</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd6c566702788-7">7</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd6c566702788-8">8</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd6c566702788-9">9</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd6c566702788-10">10</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd6c566702788-11">11</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd6c566702788-12">12</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd6c566702788-13">13</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd6c566702788-14">14</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd6c566702788-15">15</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd6c566702788-16">16</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd6c566702788-17">17</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd6c566702788-1">Эпоха: 0</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd6c566702788-2">Ошибка: 7.5226588714475175</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd6c566702788-3">-----------------------</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd6c566702788-4">Эпоха: 20000</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd6c566702788-5">Ошибка: 0.9993308610419742</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd6c566702788-6">-----------------------</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd6c566702788-7">Эпоха: 40000</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd6c566702788-8">Ошибка: 0.7671328827231176</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd6c566702788-9">-----------------------</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd6c566702788-10">Эпоха: 60000</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd6c566702788-11">Ошибка: 0.719050078989783</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd6c566702788-12">-----------------------</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd6c566702788-13">Эпоха: 80000</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd6c566702788-14">Ошибка: 0.6941113685192719</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd6c566702788-15">-----------------------</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd6c566702788-16">Итоговая ошибка 0.6773298143590253</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd6c566702788-17">Нейросеть успешно обучена</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
</div>



<p>Сделаем прогноз.</p>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.9.0 -->

		<div id="urvanov-syntax-highlighter-697702667dd6e541850681" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd6e541850681-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd6e541850681-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd6e541850681-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd6e541850681-4">4</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd6e541850681-5">5</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd6e541850681-6">6</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd6e541850681-7">7</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd6e541850681-8">8</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd6e541850681-9">9</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd6e541850681-10">10</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd6e541850681-1"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">metrics </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">accuracy_score</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd6e541850681-2">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd6e541850681-3"><span class="crayon-v">Z1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">dot</span><span class="crayon-sy">(</span><span class="crayon-v">W1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-e">b1</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd6e541850681-4"><span class="crayon-v">A1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sigmoid</span><span class="crayon-sy">(</span><span class="crayon-v">Z1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd6e541850681-5"><span class="crayon-v">Z2</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-e">dot</span><span class="crayon-sy">(</span><span class="crayon-v">W2</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">A1</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-e">b2</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd6e541850681-6"><span class="crayon-v">A2</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">sigmoid</span><span class="crayon-sy">(</span><span class="crayon-v">Z2</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd6e541850681-7">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd6e541850681-8"><span class="crayon-v">y_pred</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y_true</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">A2</span><span class="crayon-sy">.</span><span class="crayon-e">flatten</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-cn">0.5</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-e">flatten</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd6e541850681-9">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd6e541850681-10"><span class="crayon-e">accuracy_score</span><span class="crayon-sy">(</span><span class="crayon-v">y_true</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y_pred</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0005 seconds] -->
</div>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.9.0 -->

		<div id="urvanov-syntax-highlighter-697702667dd71557229504" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd71557229504-1">1</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd71557229504-1">0.9846153846153847</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0000 seconds] -->
</div>



<h3 class="wp-block-heading" id="29-regulyarizatsiya-v-biblioteke-keras">Регуляризация в библиотеке Keras</h3>



<p>Приведем регуляризацию модели в библиотеке Keras.</p>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.9.0 -->

		<div id="urvanov-syntax-highlighter-697702667dd75983767603" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd75983767603-1">1</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd75983767603-1"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">tensorflow </span><span class="crayon-st">as</span><span class="crayon-h"> </span><span class="crayon-v">tf</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
</div>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.9.0 -->

		<div id="urvanov-syntax-highlighter-697702667dd78581880427" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd78581880427-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd78581880427-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd78581880427-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd78581880427-4">4</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd78581880427-5">5</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd78581880427-6">6</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd78581880427-7">7</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd78581880427-8">8</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd78581880427-9">9</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd78581880427-10">10</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd78581880427-11">11</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd78581880427-12">12</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd78581880427-13">13</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd78581880427-14">14</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd78581880427-15">15</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd78581880427-16">16</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd78581880427-17">17</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd78581880427-18">18</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd78581880427-19">19</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd78581880427-20">20</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd78581880427-21">21</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd78581880427-22">22</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd78581880427-23">23</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd78581880427-24">24</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd78581880427-25">25</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd78581880427-26">26</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd78581880427-27">27</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd78581880427-28">28</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd78581880427-1"><span class="crayon-v">np</span><span class="crayon-sy">.</span><span class="crayon-k ">random</span><span class="crayon-sy">.</span><span class="crayon-e">seed</span><span class="crayon-sy">(</span><span class="crayon-cn">42</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd78581880427-2"><span class="crayon-v">tf</span><span class="crayon-sy">.</span><span class="crayon-k ">random</span><span class="crayon-sy">.</span><span class="crayon-e">set_seed</span><span class="crayon-sy">(</span><span class="crayon-cn">42</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd78581880427-3">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd78581880427-4"><span class="crayon-c"># регуляризация добавляется на каждый слой</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd78581880427-5"><span class="crayon-v">l2_reg</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">tf</span><span class="crayon-sy">.</span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">regularizers</span><span class="crayon-sy">.</span><span class="crayon-e">l2</span><span class="crayon-sy">(</span><span class="crayon-cn">0.01</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd78581880427-6">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd78581880427-7"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">tf</span><span class="crayon-sy">.</span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">models</span><span class="crayon-sy">.</span><span class="crayon-e">Sequential</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd78581880427-8"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">tf</span><span class="crayon-sy">.</span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">layers</span><span class="crayon-sy">.</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'sigmoid'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">use_bias</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd78581880427-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">kernel_regularizer</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">l2_reg</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd78581880427-10">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd78581880427-11"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">tf</span><span class="crayon-sy">.</span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">layers</span><span class="crayon-sy">.</span><span class="crayon-e">Dense</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">activation</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'sigmoid'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">use_bias</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd78581880427-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">kernel_regularizer</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">l2_reg</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd78581880427-13"><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd78581880427-14">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd78581880427-15"><span class="crayon-v">sgd</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">tf</span><span class="crayon-sy">.</span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">optimizers</span><span class="crayon-sy">.</span><span class="crayon-e">SGD</span><span class="crayon-sy">(</span><span class="crayon-v">learning_rate</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.1</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd78581880427-16"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">momentum</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd78581880427-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">nesterov</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">False</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd78581880427-18">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd78581880427-19"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-k ">compile</span><span class="crayon-sy">(</span><span class="crayon-v">optimizer</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">sgd</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd78581880427-20"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">loss</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'binary_crossentropy'</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd78581880427-21"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">metrics</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-s">'accuracy'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd78581880427-22">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd78581880427-23"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">.</span><span class="crayon-v">T</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">.</span><span class="crayon-v">T</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd78581880427-24"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">epochs</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1000</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd78581880427-25"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">batch_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">130</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd78581880427-26"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">verbose</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd78581880427-27">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd78581880427-28"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">summary</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0010 seconds] -->
</div>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.9.0 -->

		<div id="urvanov-syntax-highlighter-697702667dd7a680012723" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd7a680012723-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd7a680012723-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd7a680012723-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd7a680012723-4">4</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd7a680012723-5">5</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd7a680012723-6">6</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd7a680012723-7">7</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd7a680012723-8">8</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd7a680012723-9">9</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd7a680012723-10">10</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd7a680012723-11">11</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd7a680012723-12">12</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd7a680012723-1">Model: "sequential_2"</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd7a680012723-2">┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━┓</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd7a680012723-3">┃ Layer (type)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ┃ Output Shape&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;┃&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Param # ┃</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd7a680012723-4">┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━┩</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd7a680012723-5">│ dense_4 (Dense)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;│ (130, 3)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;│&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 9 │</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd7a680012723-6">├──────────────────────────────────────┼─────────────────────────────┼─────────────────┤</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd7a680012723-7">│ dense_5 (Dense)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;│ (130, 1)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;│&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4 │</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd7a680012723-8">└──────────────────────────────────────┴─────────────────────────────┴─────────────────┘</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd7a680012723-9"> Total params: 15 (64.00 B)</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd7a680012723-10"> Trainable params: 13 (52.00 B)</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd7a680012723-11"> Non-trainable params: 0 (0.00 B)</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd7a680012723-12"> Optimizer params: 2 (12.00 B)</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
</div>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.9.0 -->

		<div id="urvanov-syntax-highlighter-697702667dd7d064667872" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd7d064667872-1">1</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd7d064667872-1"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-v">history</span><span class="crayon-sy">.</span><span class="crayon-v">history</span><span class="crayon-sy">[</span><span class="crayon-s">'accuracy'</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-o">-</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
</div>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.9.0 -->

		<div id="urvanov-syntax-highlighter-697702667dd80695305342" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd80695305342-1">1</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd80695305342-1">0.9538461565971375</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0000 seconds] -->
</div>



<p>В целом регуляризаторы в Keras можно задавать следующим образом.</p>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.9.0 -->

		<div id="urvanov-syntax-highlighter-697702667dd82137953098" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd82137953098-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd82137953098-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd82137953098-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd82137953098-4">4</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd82137953098-1"><span class="crayon-c"># l1, l2 и ElasticNet</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd82137953098-2"><span class="crayon-v">tf</span><span class="crayon-sy">.</span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">regularizers</span><span class="crayon-sy">.</span><span class="crayon-e">l1</span><span class="crayon-sy">(</span><span class="crayon-cn">0.</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd82137953098-3"><span class="crayon-v">tf</span><span class="crayon-sy">.</span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">regularizers</span><span class="crayon-sy">.</span><span class="crayon-e">l2</span><span class="crayon-sy">(</span><span class="crayon-cn">0.</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd82137953098-4"><span class="crayon-v">tf</span><span class="crayon-sy">.</span><span class="crayon-v">keras</span><span class="crayon-sy">.</span><span class="crayon-v">regularizers</span><span class="crayon-sy">.</span><span class="crayon-e">l1_l2</span><span class="crayon-sy">(</span><span class="crayon-v">l1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.01</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">l2</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.01</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0003 seconds] -->
</div>



<h2 class="wp-block-heading" id="31-dopolnitelnye-materialy">Дополнительные материалы</h2>



<h3 class="wp-block-heading" id="32-begging-dlya-snizheniya-razbrosa">Бэггинг для снижения разброса</h3>



<p>Нам не обязательно использовать прогноз только одной модели. Можно взять группу или ансамбль (от франц. ensemble &#8212; &#171;вместе&#187;) моделей. Рассмотрим один из способов ансамблирования, <strong>бэггинг</strong> (bagging), и постараемся с его помощью снизить разброс модели.</p>



<h4 class="wp-block-heading" id="33-pro-begging">Про бэггинг</h4>



<p>Бэггинг (bagging) или <strong>b</strong>ootstrap <strong>agg</strong>regat<strong>ing</strong> предполагает три основных шага:</p>



<ol class="wp-block-list">
<li><strong>Bootstrapping</strong>. За счет случайных выборок с возвращением (random samples with replacement) создается несколько датасетов на основе исходных данных (subsets). Это означает, что в каждом датасете могут быть как повторяющиеся объекты, так и объекты из других датасетов;</li>



<li><strong>Parallel training</strong>. Затем модели (их называют базовыми моделями, base estimators, или weak learners) обучаются параллельно и независимо друг от друга;</li>



<li><strong>Aggregation</strong>. Наконец, в зависимости от типа задачи, т.е. регрессии или классификации, рассчитывается, соответственно, среднее значение (soft voting) или класс, предсказанный большинством (hard/majority voting).</li>
</ol>



<h4 class="wp-block-heading" id="34-algoritm-reshayushchego-dereva">Алгоритм решающего дерева</h4>



<p>Одним из недостатков алгоритма <strong>решающих деревьев</strong> (decision trees) как раз является склонность к переобучению и высокий разброс модели. Посмотрим, сможет ли бэггинг исправить ситуацию.</p>



<h4 class="wp-block-heading" id="35-podgotovka-dannykh">Подготовка данных</h4>



<p>Используем данные о пациентах с диабетом.</p>



<div class="wp-block-file"><a id="wp-block-file--media-8c33ccf6-a018-436d-b81f-db497c90bb29" href="../../wp-content/uploads/2023/01/diabetes.csv">diabetes.csv</a><a href="../../wp-content/uploads/2023/01/diabetes.csv" class="wp-block-file__button wp-element-button" download aria-describedby="wp-block-file--media-8c33ccf6-a018-436d-b81f-db497c90bb29">Скачать</a></div>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.9.0 -->

		<div id="urvanov-syntax-highlighter-697702667dd87982159438" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd87982159438-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd87982159438-2">2</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd87982159438-1"><span class="crayon-v">diabetes</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">pd</span><span class="crayon-sy">.</span><span class="crayon-e">read_csv</span><span class="crayon-sy">(</span><span class="crayon-s">'/content/diabetes.csv'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd87982159438-2"><span class="crayon-v">diabetes</span><span class="crayon-sy">.</span><span class="crayon-e">head</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
</div>



<figure class="wp-block-image size-large"><img loading="lazy" decoding="async" width="1024" height="236" src="../../wp-content/uploads/2023/01/diabetes_head-1024x236.jpg" alt="данные о диабете" class="wp-image-18258" srcset="../../wp-content/uploads/2023/01/diabetes_head-1024x236.jpg 1024w, ../../wp-content/uploads/2023/01/diabetes_head-300x69.jpg 300w, ../../wp-content/uploads/2023/01/diabetes_head-768x177.jpg 768w, ../../wp-content/uploads/2023/01/diabetes_head-1200x277.jpg 1200w, ../../wp-content/uploads/2023/01/diabetes_head-600x138.jpg 600w, ../../wp-content/uploads/2023/01/diabetes_head.jpg 1370w" sizes="auto, (max-width: 1024px) 100vw, 1024px" /></figure>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.9.0 -->

		<div id="urvanov-syntax-highlighter-697702667dd8d566617407" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd8d566617407-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd8d566617407-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd8d566617407-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd8d566617407-4">4</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd8d566617407-5">5</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd8d566617407-6">6</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd8d566617407-1"><span class="crayon-v">X</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">diabetes</span><span class="crayon-sy">.</span><span class="crayon-e">drop</span><span class="crayon-sy">(</span><span class="crayon-v">columns</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'Outcome'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd8d566617407-2"><span class="crayon-v">y</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">diabetes</span><span class="crayon-sy">.</span><span class="crayon-e">Outcome</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd8d566617407-3">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd8d566617407-4"><span class="crayon-v">X_train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">X_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y_train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y_test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">train_test_split</span><span class="crayon-sy">(</span><span class="crayon-v">X</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y</span><span class="crayon-sy">,</span><span class="crayon-h"> </span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd8d566617407-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">test_size</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0.3</span><span class="crayon-sy">,</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd8d566617407-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">random_state</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">42</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0003 seconds] -->
</div>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.9.0 -->

		<div id="urvanov-syntax-highlighter-697702667dd8f202218930" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd8f202218930-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd8f202218930-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd8f202218930-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd8f202218930-4">4</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd8f202218930-5">5</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd8f202218930-6">6</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd8f202218930-7">7</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd8f202218930-8">8</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd8f202218930-9">9</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd8f202218930-10">10</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd8f202218930-1"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">tree </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">DecisionTreeClassifier</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd8f202218930-2">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd8f202218930-3"><span class="crayon-v">model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">DecisionTreeClassifier</span><span class="crayon-sy">(</span><span class="crayon-v">max_depth</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">10</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">random_state</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">42</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd8f202218930-4"><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">X_train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y_train</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd8f202218930-5">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd8f202218930-6"><span class="crayon-v">y_pred_train</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">X_train</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd8f202218930-7"><span class="crayon-v">y_pred_test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">X_test</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd8f202218930-8">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd8f202218930-9"><span class="crayon-k ">print</span><span class="crayon-sy">(</span><span class="crayon-s">'train: '</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-k ">str</span><span class="crayon-sy">(</span><span class="crayon-e">accuracy_score</span><span class="crayon-sy">(</span><span class="crayon-v">y_train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y_pred_train</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd8f202218930-10"><span class="crayon-k ">print</span><span class="crayon-sy">(</span><span class="crayon-s">'test: '</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-k ">str</span><span class="crayon-sy">(</span><span class="crayon-e">accuracy_score</span><span class="crayon-sy">(</span><span class="crayon-v">y_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y_pred_test</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0005 seconds] -->
</div>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.9.0 -->

		<div id="urvanov-syntax-highlighter-697702667dd92061860994" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd92061860994-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd92061860994-2">2</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd92061860994-1">train: 0.9795158286778398</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd92061860994-2">test: 0.696969696969697</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0000 seconds] -->
</div>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.9.0 -->

		<div id="urvanov-syntax-highlighter-697702667dd94272403094" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd94272403094-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd94272403094-2">2</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd94272403094-3">3</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd94272403094-4">4</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd94272403094-5">5</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd94272403094-6">6</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd94272403094-7">7</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd94272403094-8">8</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd94272403094-9">9</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd94272403094-10">10</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd94272403094-11">11</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd94272403094-12">12</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd94272403094-13">13</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd94272403094-14">14</div><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd94272403094-15">15</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd94272403094-1"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-v">sklearn</span><span class="crayon-sy">.</span><span class="crayon-e">ensemble </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">BaggingClassifier</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd94272403094-2">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd94272403094-3"><span class="crayon-v">bag_model</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">BaggingClassifier</span><span class="crayon-sy">(</span><span class="crayon-v">estimator</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">model</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd94272403094-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">n_estimators</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">100</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd94272403094-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c"># выборка с возвращением</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd94272403094-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">bootstrap</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">True</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd94272403094-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">random_state</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">42</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd94272403094-8">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd94272403094-9"><span class="crayon-v">bag_model</span><span class="crayon-sy">.</span><span class="crayon-e">fit</span><span class="crayon-sy">(</span><span class="crayon-v">X_train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y_train</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd94272403094-10">&nbsp;</div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd94272403094-11"><span class="crayon-v">y_pred_train</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">bag_model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">X_train</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd94272403094-12"><span class="crayon-v">y_pred_test</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">bag_model</span><span class="crayon-sy">.</span><span class="crayon-e">predict</span><span class="crayon-sy">(</span><span class="crayon-v">X_test</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd94272403094-13">&nbsp;</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd94272403094-14"><span class="crayon-k ">print</span><span class="crayon-sy">(</span><span class="crayon-s">'train: '</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-k ">str</span><span class="crayon-sy">(</span><span class="crayon-e">accuracy_score</span><span class="crayon-sy">(</span><span class="crayon-v">y_train</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y_pred_train</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd94272403094-15"><span class="crayon-k ">print</span><span class="crayon-sy">(</span><span class="crayon-s">'test: '</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-k ">str</span><span class="crayon-sy">(</span><span class="crayon-e">accuracy_score</span><span class="crayon-sy">(</span><span class="crayon-v">y_test</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">y_pred_test</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0006 seconds] -->
</div>



<div class="wp-block-urvanov-syntax-highlighter-code-block"><!-- Urvanov Syntax Highlighter v2.9.0 -->

		<div id="urvanov-syntax-highlighter-697702667dd97790420887" class="urvanov-syntax-highlighter-syntax crayon-theme-familiar-my-copy urvanov-syntax-highlighter-font-consolas urvanov-syntax-highlighter-os-pc print-yes notranslate" data-settings=" minimize scroll-always" style=" margin-top: 15px; margin-bottom: 15px; margin-left: 15px; margin-right: 15px; font-size: 16px !important; line-height: 22px !important;">
		
			<div class="urvanov-syntax-highlighter-plain-wrap"></div>
			<div class="urvanov-syntax-highlighter-main" style="">
				<table class="crayon-table">
					<tr class="urvanov-syntax-highlighter-row">
				<td class="crayon-nums " data-settings="show">
					<div class="urvanov-syntax-highlighter-nums-content" style="font-size: 16px !important; line-height: 22px !important;"><div class="crayon-num" data-line="urvanov-syntax-highlighter-697702667dd97790420887-1">1</div><div class="crayon-num crayon-striped-num" data-line="urvanov-syntax-highlighter-697702667dd97790420887-2">2</div></div>
				</td>
						<td class="urvanov-syntax-highlighter-code"><div class="crayon-pre" style="font-size: 16px !important; line-height: 22px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="urvanov-syntax-highlighter-697702667dd97790420887-1">train: 1.0</div><div class="crayon-line crayon-striped-line" id="urvanov-syntax-highlighter-697702667dd97790420887-2">test: 0.7532467532467533</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0000 seconds] -->
</div>

			</div> <!-- .content -->

			
		</div> <!-- .post -->

					<footer class="site-footer section-inner">

				<p class="copyright">&copy; 2026 <a href="../../index.html" class="site-name"><!--Дмитрий Макаров-->Дмитрий Макаров</a></p>

			</footer> <!-- footer -->

		</main>
		
<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
   (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
   m[i].l=1*new Date();
   for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
   k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
   (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

   ym(100123342, "init", {
        clickmap:true,
        trackLinks:true,
        accurateTrackBounce:true
   });
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/100123342" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->

		<script type="speculationrules">
{"prefetch":[{"source":"document","where":{"and":[{"href_matches":"/*"},{"not":{"href_matches":["/wp-*.php","/wp-admin/*","/wp-content/uploads/*","/wp-content/*","/wp-content/plugins/*","/wp-content/themes/mcluhan/*","/*\\?(.+)"]}},{"not":{"selector_matches":"a[rel~=\"nofollow\"]"}},{"not":{"selector_matches":".no-prefetch, .no-prefetch a"}}]},"eagerness":"conservative"}]}
</script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js?ver=6.9" id="mathjax-js"></script>
<script type="text/javascript" src="../../wp-includes/js/imagesloaded.min.js@ver=5.0.0" id="imagesloaded-js"></script>
<script type="text/javascript" src="../../wp-includes/js/masonry.min.js@ver=4.2.2" id="masonry-js"></script>
<script type="text/javascript" id="mcluhan_global-js-extra">
/* <![CDATA[ */
var mcluhan_ajaxpagination = {"ajaxurl":"https://www.dmitrymakarov.ru/wp-admin/admin-ajax.php","query_vars":"{\"page\":\"\",\"pagename\":\"learning\\/reg\"}"};
//# sourceURL=mcluhan_global-js-extra
/* ]]> */
</script>
<script type="text/javascript" src="../../wp-content/themes/mcluhan/assets/js/global.js@ver=2.1.1" id="mcluhan_global-js"></script>
<script id="wp-emoji-settings" type="application/json">
{"baseUrl":"https://s.w.org/images/core/emoji/17.0.2/72x72/","ext":".png","svgUrl":"https://s.w.org/images/core/emoji/17.0.2/svg/","svgExt":".svg","source":{"concatemoji":"https://www.dmitrymakarov.ru/wp-includes/js/wp-emoji-release.min.js?ver=6.9"}}
</script>
<script type="module">
/* <![CDATA[ */
/*! This file is auto-generated */
const a=JSON.parse(document.getElementById("wp-emoji-settings").textContent),o=(window._wpemojiSettings=a,"wpEmojiSettingsSupports"),s=["flag","emoji"];function i(e){try{var t={supportTests:e,timestamp:(new Date).valueOf()};sessionStorage.setItem(o,JSON.stringify(t))}catch(e){}}function c(e,t,n){e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillText(t,0,0);t=new Uint32Array(e.getImageData(0,0,e.canvas.width,e.canvas.height).data);e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillText(n,0,0);const a=new Uint32Array(e.getImageData(0,0,e.canvas.width,e.canvas.height).data);return t.every((e,t)=>e===a[t])}function p(e,t){e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillText(t,0,0);var n=e.getImageData(16,16,1,1);for(let e=0;e<n.data.length;e++)if(0!==n.data[e])return!1;return!0}function u(e,t,n,a){switch(t){case"flag":return n(e,"\ud83c\udff3\ufe0f\u200d\u26a7\ufe0f","\ud83c\udff3\ufe0f\u200b\u26a7\ufe0f")?!1:!n(e,"\ud83c\udde8\ud83c\uddf6","\ud83c\udde8\u200b\ud83c\uddf6")&&!n(e,"\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc65\udb40\udc6e\udb40\udc67\udb40\udc7f","\ud83c\udff4\u200b\udb40\udc67\u200b\udb40\udc62\u200b\udb40\udc65\u200b\udb40\udc6e\u200b\udb40\udc67\u200b\udb40\udc7f");case"emoji":return!a(e,"\ud83e\u1fac8")}return!1}function f(e,t,n,a){let r;const o=(r="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope?new OffscreenCanvas(300,150):document.createElement("canvas")).getContext("2d",{willReadFrequently:!0}),s=(o.textBaseline="top",o.font="600 32px Arial",{});return e.forEach(e=>{s[e]=t(o,e,n,a)}),s}function r(e){var t=document.createElement("script");t.src=e,t.defer=!0,document.head.appendChild(t)}a.supports={everything:!0,everythingExceptFlag:!0},new Promise(t=>{let n=function(){try{var e=JSON.parse(sessionStorage.getItem(o));if("object"==typeof e&&"number"==typeof e.timestamp&&(new Date).valueOf()<e.timestamp+604800&&"object"==typeof e.supportTests)return e.supportTests}catch(e){}return null}();if(!n){if("undefined"!=typeof Worker&&"undefined"!=typeof OffscreenCanvas&&"undefined"!=typeof URL&&URL.createObjectURL&&"undefined"!=typeof Blob)try{var e="postMessage("+f.toString()+"("+[JSON.stringify(s),u.toString(),c.toString(),p.toString()].join(",")+"));",a=new Blob([e],{type:"text/javascript"});const r=new Worker(URL.createObjectURL(a),{name:"wpTestEmojiSupports"});return void(r.onmessage=e=>{i(n=e.data),r.terminate(),t(n)})}catch(e){}i(n=f(s,u,c,p))}t(n)}).then(e=>{for(const n in e)a.supports[n]=e[n],a.supports.everything=a.supports.everything&&a.supports[n],"flag"!==n&&(a.supports.everythingExceptFlag=a.supports.everythingExceptFlag&&a.supports[n]);var t;a.supports.everythingExceptFlag=a.supports.everythingExceptFlag&&!a.supports.flag,a.supports.everything||((t=a.source||{}).concatemoji?r(t.concatemoji):t.wpemoji&&t.twemoji&&(r(t.twemoji),r(t.wpemoji)))});
//# sourceURL=https://www.dmitrymakarov.ru/wp-includes/js/wp-emoji-loader.min.js
/* ]]> */
</script>
			
	</body>
</html>


<!-- Page supported by LiteSpeed Cache 7.7 on 2026-01-26 08:57:58 -->